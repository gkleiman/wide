bespin.tiki.register("::text_editor",{name:"text_editor",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"}});
bespin.tiki.module("text_editor:utils/rect",function(y,t){t._distanceFromBounds=function(v,s,g){if(v<s)return v-s;if(v>=g)return v-g;return 0};t.merge=function(v){var s;do{s=false;for(var g=[],e=0;e<v.length;e++){var b=v[e];g.push(b);for(var d=e+1;d<v.length;d++){var k=v[d];if(t.rectsSideBySide(b,k)||t.rectsIntersect(b,k)){v.splice(d,1);g[g.length-1]=t.unionRects(b,k);s=true;break}}}v=g}while(s);return v};t.offsetFromRect=function(v,s){return{x:t._distanceFromBounds(s.x,v.x,t.maxX(v)),y:t._distanceFromBounds(s.y,
v.y,t.maxY(v))}};t.rectsIntersect=function(v,s){v=t.intersectRects(v,s);return v.width!==0&&v.height!==0};t.rectsSideBySide=function(v,s){if(v.x==s.x&&v.width==s.width)return v.y<s.y?v.y+v.height==s.y:s.y+s.height==v.y;else if(v.y==s.y&&v.height==s.height)return v.x<s.x?v.x+v.width==s.x:s.x+s.width==v.x;return false};t.intersectRects=function(v,s){v={x:Math.max(t.minX(v),t.minX(s)),y:Math.max(t.minY(v),t.minY(s)),width:Math.min(t.maxX(v),t.maxX(s)),height:Math.min(t.maxY(v),t.maxY(s))};v.width=Math.max(0,
v.width-v.x);v.height=Math.max(0,v.height-v.y);return v};t.minX=function(v){return v.x||0};t.maxX=function(v){return(v.x||0)+(v.width||0)};t.minY=function(v){return v.y||0};t.maxY=function(v){return(v.y||0)+(v.height||0)};t.pointInRect=function(v,s){return v.x>=t.minX(s)&&v.y>=t.minY(s)&&v.x<=t.maxX(s)&&v.y<=t.maxY(s)};t.unionRects=function(v,s){v={x:Math.min(t.minX(v),t.minX(s)),y:Math.min(t.minY(v),t.minY(s)),width:Math.max(t.maxX(v),t.maxX(s)),height:Math.max(t.maxY(v),t.maxY(s))};v.width=Math.max(0,
v.width-v.x);v.height=Math.max(0,v.height-v.y);return v};t.rectsEqual=function(v,s,g){if(!v||!s)return v==s;if(!g&&g!==0)g=0.1;if(v.y!=s.y&&Math.abs(v.y-s.y)>g)return false;if(v.x!=s.x&&Math.abs(v.x-s.x)>g)return false;if(v.width!=s.width&&Math.abs(v.width-s.width)>g)return false;if(v.height!=s.height&&Math.abs(v.height-s.height)>g)return false;return true}});
bespin.tiki.module("text_editor:models/buffer",function(y,t){var v=y("environment").env,s=y("bespin:util/util"),g=y("bespin:promise").Promise,e=y("models/textstorage").TextStorage,b=y("controllers/layoutmanager").LayoutManager,d=y("undomanager").UndoManager;t.Buffer=function(k,h){this._file=k;this._model=new e(h);this._layoutManager=new b({textStorage:this._model});this.undoManager=new d;if(k)this.reload().then(function(){this._updateSyntaxManagerInitialContext()}.bind(this));else{this.loadPromise=
new g;this.loadPromise.resolve()}h=v.session?v.session.history:null;var i,j,m;if(h&&k&&(i=h.getHistoryForPath(k.path))){j=i.selection;m=i.scroll}this._selectedRange=j||{start:{row:0,col:0},end:{row:0,col:0}};this._scrollOffset=m||{x:0,y:0}};t.Buffer.prototype={undoManager:null,loadPromise:null,_scrollOffset:null,_selectedRange:null,_selectedRangeEndVirtual:null,_layoutManager:null,_file:null,_model:null,save:function(){return this._file.saveContents(this._model.value)},saveAs:function(k){var h=new g;
k.saveContents(this._model.value).then(function(){this._file=k;this._updateSyntaxManagerInitialContext();h.resolve()}.bind(this),function(i){h.reject(i)});return h},reload:function(){var k=this,h;return this.loadPromise=h=this._file.loadContents().then(function(i){k._model.value=i})},_updateSyntaxManagerInitialContext:function(){var k=this._file.extension();this._layoutManager.syntaxManager.setSyntaxFromFileExt(k===null?"":k)},untitled:function(){return s.none(this._file)}};Object.defineProperties(t.Buffer.prototype,
{layoutManager:{get:function(){return this._layoutManager}},syntaxManager:{get:function(){}},file:{get:function(){return this._file}},model:{get:function(){return this._model}}})});
bespin.tiki.module("text_editor:models/textstorage",function(y,t){var v=y("events").Event,s=y("bespin:util/util");y=function(g){this._lines=g!==null&&g!==undefined?g.split("\n"):[""];this.changed=new v;return this};y.prototype={_lines:null,readOnly:false,clampPosition:function(g){var e=this._lines,b=g.row;if(b<0)return{row:0,col:0};else if(b>=e.length)return this.range.end;g=Math.max(0,Math.min(g.col,e[b].length));return{row:b,col:g}},clampRange:function(g){var e=this.clampPosition(g.start);g=this.clampPosition(g.end);
return{start:e,end:g}},deleteCharacters:function(g){this.replaceCharacters(g,"")},displacePosition:function(g,e){var b=e>0,d=this._lines,k=d.length;for(e=Math.abs(e);e!==0;e--)if(b){var h=d[g.row].length;if(g.row===k-1&&g.col===h)return g;g=g.col===h?{row:g.row+1,col:0}:{row:g.row,col:g.col+1}}else{if(g.row===0&&g.col==0)return g;if(g.col===0){d=this._lines;g={row:g.row-1,col:d[g.row-1].length}}else g={row:g.row,col:g.col-1}}return g},getCharacters:function(g){var e=this._lines,b=g.start,d=g.end,
k=b.row;g=d.row;var h=b.col;b=d.col;if(k===g)return e[k].substring(h,b);d=e[k].substring(h);k=e.slice(k+1,g);e=e[g].substring(0,b);return[d].concat(k,e).join("\n")},getLines:function(){return this._lines},getRange:function(){var g=this._lines,e=g.length-1;return{start:{row:0,col:0},end:{row:e,col:g[e].length}}},getValue:function(){return this._lines.join("\n")},insertCharacters:function(g,e){this.replaceCharacters({start:g,end:g},e)},replaceCharacters:function(g,e){if(this.readOnly)throw new Error("Attempt to modify a read-only text storage object");
var b=e.split("\n"),d=b.length,k=this.resultingRangeForReplacement(g,b),h=g.start,i=g.end,j=h.row,m=i.row,o=this._lines;b[0]=o[j].substring(0,h.col)+b[0];b[d-1]+=o[m].substring(i.col);this._lines=s.replace(o,j,m-j+1,b);this.changed(g,k,e)},resultingRangeForReplacement:function(g,e){var b=e.length;g=g.start;return{start:g,end:{row:g.row+b-1,col:(b===1?g.col:0)+e[b-1].length}}},setLines:function(g){this.setValue(g.join("\n"))},setValue:function(g){this.replaceCharacters(this.range,g)}};t.TextStorage=
y;Object.defineProperties(t.TextStorage.prototype,{lines:{get:function(){return this.getLines()},set:function(g){return this.setLines(g)}},range:{get:function(){return this.getRange()}},value:{get:function(){return this.getValue()},set:function(g){this.setValue(g)}}})});
bespin.tiki.module("text_editor:views/gutter",function(y,t){var v=y("bespin:util/util"),s=y("bespin:plugins").catalog,g=y("utils/rect"),e=y("views/canvas").CanvasView;t.GutterView=function(b,d){e.call(this,b,true);this.editor=d;this.domNode.addEventListener("click",this._click.bind(this),false)};t.GutterView.prototype=new e;v.mixin(t.GutterView.prototype,{_decorationSpacing:2,drawRect:function(b,d){var k=this.editor.themeData.gutter;d.fillStyle=k.backgroundColor;d.fillRect(b.x,b.y,b.width,b.height);
d.save();d.translate(k.paddingLeft-0.5,-0.5);k=this.editor.layoutManager;var h=k.characterRangeForBoundingRect(b);b=Math.min(h.end.row,k.textLines.length-1);for(var i=k.fontDimension.lineAscent,j=this._loadedDecorations(true),m=[],o=0;o<j.length;o++)m.push(j[o].computeWidth(this));for(h=h.start.row;h<=b;h++){d.save();o=k.lineRectForRow(h).y;d.translate(0,o);for(o=0;o<j.length;o++){j[o].drawDecoration(this,d,i,h);d.translate(m[o]+this._decorationSpacing,0)}d.restore()}d.restore()},computeWidth:function(){var b=
this.editor.themeData.gutter;b=b.paddingLeft+b.paddingRight;for(var d=this._loadedDecorations(true),k=0;k<d.length;k++)b+=d[k].computeWidth(this);b+=(d.length-1)*this._decorationSpacing;return b},_click:function(b){var d={x:b.layerX,y:b.layerY};if(g.pointInRect(d,this.frame))if((b=this._decorationAtPoint(d))&&"selected"in b){d=this.editor.layoutManager.characterAtPoint(this.computeWithClippingFrame(d.x,d.y));b.selected(this,d.row)}},_loadedDecorations:function(b){for(var d=[],k=s.getExtensions("gutterDecoration"),
h=0;h<k.length;h++){var i=k[h].load();if(i.isResolved())i.then(d.push.bind(d));else b&&i.then(this.invalidate.bind(this))}return d},_decorationAtPoint:function(b){var d=this.editor.themeData.gutter;if(b.x>d.paddingLeft){var k=this._loadedDecorations(false);d=d.paddingLeft;for(var h=0;h<k.length;h++){var i=k[h],j=i.computeWidth(this);if(b.x<d+j)return i;d+=j+this._decorationSpacing}}return null}});t.lineNumbers={drawDecoration:function(b,d,k,h){b=b.editor;d.fillStyle=b.themeData.gutter.color;d.font=
b.font;d.fillText(""+(h+1),0,k)},computeWidth:function(b){b=b.editor.layoutManager;return b.fontDimension.characterWidth*(""+b.textLines.length).length}}});
bespin.tiki.module("text_editor:views/editor",function(y,t){function v(p){var z=u.plugins.text_editor.provides,E=z.length,G={};if(p){p=p.themestyles;if(p.currentThemeVariables&&p.currentThemeVariables.text_editor)G=p.currentThemeVariables.text_editor}for(;E--;)if(z[E].ep==="themevariable"){p=e.mixin(e.clone(z[E].defaultValue),G[z[E].name]);switch(z[E].name){case "gutter":case "editor":case "scroller":case "highlighterFG":case "highlighterBG":F[z[E].name]=p}}}var s=y("rangeutils:utils/range"),g=y("views/scroller"),
e=y("bespin:util/util"),b=y("models/buffer").Buffer,d=y("completion:controller").CompletionController,k=y("controllers/search").EditorSearchController,h=y("controllers/undo").EditorUndoController,i=y("events").Event,j=y("views/gutter").GutterView;y("controllers/layoutmanager");var m=g.ScrollerCanvasView,o=y("views/text").TextView,x=y("underscore")._,u=y("bespin:plugins").catalog,f=y("keyboard:keyboard").keyboardManager,A=y("settings").settings,F={};v();u.registerExtension("themeChange",{pointer:v});
t.EditorView=function(p){this.elementAppended=new i;var z=this.element=this.container=document.createElement("div");z.style.overflow="visible";z.style.position="relative";this.scrollOffsetChanged=new i;this.willChangeBuffer=new i;this.selectionChanged=new i;this.textChanged=new i;this.gutterView=new j(z,this);this.textView=new o(z,this);var E=new m(this,g.LAYOUT_VERTICAL),G=new m(this,g.LAYOUT_HORIZONTAL);this.verticalScroller=E;this.horizontalScroller=G;this.completionController=new d(this);this.editorUndoController=
new h(this);this.searchController=new k(this);this._textViewSize=this._oldSize={width:0,height:0};this._themeData=F;this.buffer=new b(null,p);this.elementAppended.add(function(){var N=A.get("fontsize"),W=A.get("fontface");this._font=N+"px "+W;u.registerExtension("themeChange",{pointer:this._themeVariableChange.bind(this)});u.registerExtension("settingChange",{match:"font[size|face]",pointer:this._fontSettingChanged.bind(this)});u.registerExtension("dimensionsChanged",{pointer:this.dimensionsChanged.bind(this)});
this._dontRecomputeLayout=false;this._recomputeLayout();z.addEventListener(e.isMozilla?"DOMMouseScroll":"mousewheel",this._onMouseWheel.bind(this),false);E.valueChanged.add(function($){this.scrollOffset={y:$}}.bind(this));G.valueChanged.add(function($){this.scrollOffset={x:$}}.bind(this));this.scrollOffsetChanged.add(function($){this._updateScrollOffsetChanged($)}.bind(this))}.bind(this))};t.EditorView.prototype={elementAppended:null,textChanged:null,selectionChanged:null,scrollOffsetChanged:null,
willChangeBuffer:null,_textViewSize:null,_textLinesCount:0,_gutterViewWidth:0,_oldSize:null,_buffer:null,_dontRecomputeLayout:true,_themeData:null,_layoutManagerSizeChanged:function(p){var z=this.layoutManager.fontDimension;this._textViewSize={width:p.width*z.characterWidth,height:p.height*z.lineHeight};if(this._textLinesCount!==p.height){this.gutterView.computeWidth()!==this._gutterViewWidth?this._recomputeLayout(true):this.gutterView.invalidate();this._textLinesLength=p.height}this._updateScrollers();
this.scrollOffset={}},_updateScrollers:function(){if(!this._dontRecomputeLayout){var p=this.textViewPaddingFrame,z=this._textViewSize.width,E=this._textViewSize.height,G=this.scrollOffset,N=this.verticalScroller,W=this.horizontalScroller;if(E<p.height)N.isVisible=false;else{N.isVisible=true;N.proportion=p.height/E;N.maximum=E-p.height;N.value=G.y}if(z<p.width)W.isVisible=false;else{W.isVisible=true;W.proportion=p.width/z;W.maximum=z-p.width;W.value=G.x}}},_onMouseWheel:function(p){var z=0;if(p.wheelDelta)z=
-p.wheelDelta;else if(p.detail)z=p.detail*40;var E=true;if(p.axis){if(p.axis==p.HORIZONTAL_AXIS)E=false}else if(p.wheelDeltaY||p.wheelDeltaX){if(p.wheelDeltaX==p.wheelDelta)E=false}else if(p.shiftKey)E=false;E?this.scrollBy(0,z):this.scrollBy(z*5,0);e.stopEvent(p)},scrollTo:function(p){this.scrollOffset=p},scrollBy:function(p,z){this.scrollOffset={x:this.scrollOffset.x+p,y:this.scrollOffset.y+z}},_recomputeLayout:function(p){if(!this._dontRecomputeLayout){var z=this.container.offsetWidth,E=this.container.offsetHeight;
if(!(!p&&z==this._oldSize.width&&E==this._oldSize.height)){this._oldSize={width:z,height:E};this._gutterViewWidth=p=this.gutterView.computeWidth();this.gutterView.frame={x:0,y:0,width:p,height:E};this.textView.frame={x:p,y:0,width:z-p,height:E};var G=this._themeData.scroller.padding,N=this._themeData.scroller.thickness;this.horizontalScroller.frame={x:p+G,y:E-(N+G),width:z-(p+2*G+N),height:N};this.verticalScroller.frame={x:z-(G+N),y:G,width:N,height:E-(2*G+N)};this.scrollOffset={};this._updateScrollers();
this.gutterView.invalidate();this.textView.invalidate();this.verticalScroller.invalidate();this.horizontalScroller.invalidate()}}},dimensionsChanged:function(){this._recomputeLayout()},_font:null,_fontSettingChanged:function(){var p=A.get("fontsize"),z=A.get("fontface");this._font=p+"px "+z;this.layoutManager._recalculateMaximumWidth();this._layoutManagerSizeChanged(this.layoutManager.size);this.textView.invalidate()},_themeVariableChange:function(){this._recomputeLayout(true)},_updateScrollOffsetChanged:function(p){this.verticalScroller.value=
p.y;this.horizontalScroller.value=p.x;this.textView.clippingFrame={x:p.x,y:p.y};this.gutterView.clippingFrame={y:p.y};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate()},processKeyEvent:function(p,z,E){E=x(E).clone();E.completing=this.completionController.isCompleting();return f.processKeyEvent(p,z,E)},convertTextViewPoint:function(p){var z=this.scrollOffset;return{x:p.x-z.x+this._gutterViewWidth,y:p.y-z.y}},replace:function(p,z,E){if(!s.isRange(p))throw new Error('replace(): expected range but found "'+
p+"'");if(!e.isString(z))throw new Error('replace(): expected text string but found "'+text+'"');var G=s.normalizeRange(p),N=this.textView,W=N.getSelectedRange(false);return N.groupChanges(function(){N.replaceCharacters(G,z);if(E)N.setSelection(W);else{var $=z.split("\n");$=$.length>1?{row:p.start.row+$.length-1,col:$[$.length-1].length}:s.addPositions(p.start,{row:0,col:z.length});N.moveCursorTo($)}})},getText:function(p){if(!s.isRange(p))throw new Error('getText(): expected range but found "'+p+
'"');return this.layoutManager.textStorage.getCharacters(s.normalizeRange(p))},setLineNumber:function(p){if(!e.isNumber(p))throw new Error("setLineNumber(): lineNumber must be a number");this.textView.moveCursorTo({row:p-1,col:0})},setCursor:function(p){if(!s.isPosition(p))throw new Error('setCursor(): expected position but found "'+p+'"');this.textView.moveCursorTo(p)},changeGroup:function(p){return this.textView.groupChanges(function(){p(this)}.bind(this))},addTags:function(p){this.completionController.tags.add(p)}};
Object.defineProperties(t.EditorView.prototype,{themeData:{get:function(){return this._themeData},set:function(){throw new Error("themeData can't be changed directly. Use themeManager.");}},font:{get:function(){return this._font},set:function(){throw new Error("font can't be changed directly. Use settings fontsize and fontface.");}},buffer:{set:function(p){if(p!==this._buffer){if(!p.loadPromise.isResolved())throw new Error("buffer.set(): the new buffer must first be loaded!");if(this._buffer!==null){this.layoutManager.sizeChanged.remove(this);
this.layoutManager.textStorage.changed.remove(this);this.textView.selectionChanged.remove(this)}this.willChangeBuffer(p);u.publish(this,"editorChange","buffer",p);this.layoutManager=p.layoutManager;this._buffer=p;var z=this.layoutManager,E=this.textView;z.sizeChanged.add(this,this._layoutManagerSizeChanged.bind(this));z.textStorage.changed.add(this,this.textChanged.bind(this));E.selectionChanged.add(this,this.selectionChanged.bind(this));this.textView.setSelection(p._selectedRange,false);this.scrollOffsetChanged(p._scrollOffset);
this.layoutManager.sizeChanged(this.layoutManager.size);this._recomputeLayout()}},get:function(){return this._buffer}},frame:{get:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},textViewPaddingFrame:{get:function(){var p=e.clone(this.textView.frame),z=this.textView.padding;p.width-=z.left+z.right;p.height-=z.top+z.bottom;return p}},scrollOffset:{set:function(p){if(p.x===undefined)p.x=this.scrollOffset.x;if(p.y===undefined)p.y=this.scrollOffset.y;var z=this.textViewPaddingFrame;
if(p.y<0)p.y=0;else if(this._textViewSize.height<z.height)p.y=0;else if(p.y+z.height>this._textViewSize.height)p.y=this._textViewSize.height-z.height;if(p.x<0)p.x=0;else if(this._textViewSize.width<z.width)p.x=0;else if(p.x+z.width>this._textViewSize.width)p.x=this._textViewSize.width-z.width;if(!(p.x===this.scrollOffset.x&&p.y===this.scrollOffset.y)){this.buffer._scrollOffset=p;this.scrollOffsetChanged(p);u.publish(this,"editorChange","scrollOffset",p)}},get:function(){return this.buffer._scrollOffset}},
readOnly:{get:function(){return this._buffer.model.readOnly},set:function(p){this._buffer.model.readOnly=p}},focus:{get:function(){return this.textView.hasFocus},set:function(p){if(!e.isBoolean(p))throw new Error('set focus: expected boolean but found "'+p+'"');this.textView.hasFocus=p}},selection:{get:function(){return e.clone(this.textView.getSelectedRange(false))},set:function(p){if(!s.isRange(p))throw new Error("set selection: position/selection must be supplied");this.textView.setSelection(p)}},
selectedText:{get:function(){return this.getText(this.selection)},set:function(p){if(!e.isString(p))throw new Error('set selectedText: expected string but found "'+p+'"');return this.replace(this.selection,p)}},value:{get:function(){return this.layoutManager.textStorage.value},set:function(p){if(!e.isString(p))throw new Error('set value: expected string but found "'+p+'"');return this.replace(this.layoutManager.textStorage.range,p,false)}},syntax:{get:function(){return this.layoutManager.syntaxManager.getSyntax()},
set:function(p){if(!e.isString(p))throw new Error('set syntax: expected string but found "'+newValue+'"');return this.layoutManager.syntaxManager.setSyntax(p)}}})});
bespin.tiki.module("text_editor:views/canvas",function(y,t){var v=y("bespin:util/util"),s=y("utils/rect"),g=y("events").Event;t.CanvasView=function(e,b,d){if(e){this._preventDownsize=b||false;this._clearOnFullInvalid=d||false;this._clippingFrame=this._frame={x:0,y:0,width:0,height:0};this._invalidRects=[];b=document.createElement("canvas");b.setAttribute("style","position: absolute");b.innerHTML="canvas tag not supported by your browser";e.appendChild(b);this.domNode=b;this.clippingChanged=new g;
this.clippingChanged.add(this.clippingFrameChanged.bind(this))}};t.CanvasView.prototype={domNode:null,clippingChanged:null,_canvasContext:null,_canvasId:null,_invalidRects:null,_lastRedrawTime:null,_redrawTimer:null,_clippingFrame:null,_preventDownsize:false,_clearOnFullInvalid:false,_frame:null,_getContext:function(){if(this._canvasContext===null)this._canvasContext=this.domNode.getContext("2d");return this._canvasContext},computeWithClippingFrame:function(e,b){var d=this.clippingFrame;return{x:e+
d.x,y:b+d.y}},minimumRedrawDelay:1E3/30,clippingFrameChanged:function(){this.invalidate()},drawRect:function(){},render:function(){if(!(this._renderTimer||this._redrawTimer))this._renderTimer=setTimeout(this._tryRedraw.bind(this),0)},invalidate:function(){this._invalidRects="all";this.render()},invalidateRect:function(e){var b=this._invalidRects;if(b!=="all"){b.push(e);this.render()}},_tryRedraw:function(){this._renderTimer=null;var e=(new Date).getTime(),b=this._lastRedrawTime,d=this.minimumRedrawDelay;
if(b===null||e-b>=d)this._redraw();else if(this._redrawTimer===null)this._redrawTimer=window.setTimeout(this._redraw.bind(this),d)},_redraw:function(){var e=this.clippingFrame;e={x:Math.round(e.x),y:Math.round(e.y),width:e.width,height:e.height};var b=this._getContext();b.save();b.translate(-e.x,-e.y);var d=this._invalidRects;if(d==="all"){this._clearOnFullInvalid&&b.clearRect(0,0,this.domNode.width,this.domNode.height);this.drawRect(e,b)}else s.merge(d).forEach(function(k){k=s.intersectRects(k,e);
if(k.width!==0&&k.height!==0){b.save();var h=k.x,i=k.y,j=k.width,m=k.height;b.beginPath();b.moveTo(h,i);b.lineTo(h+j,i);b.lineTo(h+j,i+m);b.lineTo(h,i+m);b.closePath();b.clip();this.drawRect(k,b);b.restore()}},this);b.restore();this._invalidRects=[];this._redrawTimer=null;this._lastRedrawTime=(new Date).getTime()}};Object.defineProperties(t.CanvasView.prototype,{clippingFrame:{get:function(){return this._clippingFrame},set:function(e){e=v.mixin(v.clone(this._clippingFrame),e);if(this._clippingFrame===
null||!s.rectsEqual(e,this._clippingFrame)){this._clippingFrame=e;this.clippingChanged()}}},frame:{get:function(){return this._frame},set:function(e){var b=this.domNode,d=b.style,k=this._preventDownsize,h=b.width,i=b.height;d=b.style;d.left=e.x+"px";d.top=e.y+"px";var j,m;if(e.width!==h)if(e.width<h)k||(j=true);else j=true;if(e.height!==i)if(e.height<i)k||(m=true);else m=true;if(j)this.domNode.width=e.width;if(m)this.domNode.height=e.height;this._frame=e;this.clippingFrame={width:e.width,height:e.height}}}})});
bespin.tiki.module("text_editor:views/textinput",function(y,t){var v=y("bespin:util/util");y("events");var s=y("rangeutils:utils/range"),g=y("keyboard:keyutil");t.TextInput=function(e,b){var d=this.domNode=document.createElement("textarea");d.setAttribute("style","position: absolute; z-index: -99999; width: 0px; height: 0px; margin: 0px; outline: none; border: 0;");e.appendChild(d);this.delegate=b;this._attachEvents()};t.TextInput.prototype={_composing:false,domNode:null,delegate:null,_textFieldChanged:function(){if(!(this._composing||
this._ignore)){var e=this.domNode,b=e.value;if(b!=""){e.value="";this._textInserted(b)}}},_copy:function(){var e=false,b=this.delegate;if(b&&b.copy)e=b.copy();return e},_cut:function(){var e=false,b=this.delegate;if(b&&b.cut)e=b.cut();return e},_textInserted:function(e){var b=this.delegate;b&&b.textInserted&&b.textInserted(e)},_setValueAndSelect:function(e){var b=this.domNode;b.value=e;b.select()},focus:function(){this.domNode.focus()},blur:function(){this.domNode.blur()},_attachEvents:function(){var e=
this.domNode,b=this;e.addEventListener("focus",function(){b.delegate&&b.delegate.didFocus&&b.delegate.didFocus()},false);e.addEventListener("blur",function(){b.delegate&&b.delegate.didBlur&&b.delegate.didBlur()},false);g.addKeyDownListener(e,function(i){return b.delegate&&b.delegate.keyDown?b.delegate.keyDown(i):false});if(v.isWebKit){v.isChrome||e.addEventListener("compositionend",function(i){b._textInserted(i.data)},false);e.addEventListener("textInput",function(i){b._textInserted(i.data)},false);
e.addEventListener("paste",function(i){b._textInserted(i.clipboardData.getData("text/plain"));i.preventDefault()},false)}else{e.addEventListener("input",function(){b._textFieldChanged()},false);e.addEventListener("compositionstart",function(){b._composing=true},false);e.addEventListener("compositionend",function(){b._composing=false;b._textFieldChanged()},false);e.addEventListener("paste",function(){b._setValueAndSelect("");window.setTimeout(function(){b._textFieldChanged()},0)},false);this.delegate.selectionChanged.add(function(i){if(s.isZeroLength(i))wasSelection=
false;else{e.value="z";e.select();wasSelection=true}}.bind(this))}var d=function(i){i=i.type.indexOf("copy")!=-1?b._copy():b._cut();b._setValueAndSelect(i)};if(v.isWebKit&&!v.isChrome&&v.isMac){var k=(new Date).getTime(),h=function(i){var j=i.type.indexOf("cut")!=-1;if(!(j&&(new Date).getTime()-k<10)){d(i);if(j)k=(new Date).getTime()}};e.addEventListener("beforecopy",h,false);e.addEventListener("beforecut",h,false)}else{h=false;if(v.isMozilla)h=function(i){d(i);b._ignore=true;window.setTimeout(function(){b._setValueAndSelect("");
b._ignore=false},0)};e.addEventListener("copy",h||d,false);e.addEventListener("cut",h||d,false)}}}});
bespin.tiki.module("text_editor:views/scroller",function(y,t){var v=y("bespin:util/util"),s=y("events").Event,g=y("bespin:console").console,e=y("utils/rect"),b=y("views/canvas").CanvasView,d=t.LAYOUT_HORIZONTAL=0,k=t.LAYOUT_VERTICAL=1;t.ScrollerCanvasView=function(h,i){b.call(this,h.container,false,true);this.editor=h;this.layoutDirection=i;h=function(j,m,o){o=o||this.domNode;o.addEventListener(j,function(x){m.call(this,x);v.stopEvent(x)}.bind(this),false)}.bind(this);h("mouseover",this.mouseEntered);
h("mouseout",this.mouseExited);h("mousedown",this.mouseDown);h("mouseup",this.mouseUp,window);h("mousemove",this.mouseMove,window);this.valueChanged=new s};t.ScrollerCanvasView.prototype=new b;v.mixin(t.ScrollerCanvasView.prototype,{lineHeight:20,proportion:0,layoutDirection:k,_isVisible:false,_maximum:0,_value:0,valueChanged:null,padding:{left:0,bottom:0,top:0,right:0},_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,
_drawNib:function(h){var i=this.editor.themeData.scroller,j,m;j=i.nibStyle;m=i.nibArrowStyle;i=i.nibStrokeStyle;var o=Math.floor(7.5);h.fillStyle=j;h.beginPath();h.arc(0,0,Math.floor(7.5),0,Math.PI*2,true);h.closePath();h.fill();h.strokeStyle=i;h.stroke();h.fillStyle=m;h.beginPath();h.moveTo(0,-o+3);h.lineTo(-o+3,o-5);h.lineTo(o-3,o-5);h.closePath();h.fill()},_drawNibs:function(h,i){var j=this._getClientThickness(),m=this._value,o=this._maximum,x=this._isHighlighted();if(x||m!==0){h.save();h.translate(8,
j/2);h.rotate(Math.PI*1.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}if(x||m!==o){h.save();h.translate(this._getClientLength()-8,j/2);h.rotate(Math.PI*0.5);h.moveTo(0,0);this._drawNib(h,i);h.restore()}},_getClientFrame:function(){var h=this.frame,i=this.padding;return{x:i.left,y:i.top,width:h.width-(i.left+i.right),height:h.height-(i.top+i.bottom)}},_getClientLength:function(){var h=this._getClientFrame();switch(this.layoutDirection){case d:return h.width;case k:return h.height;default:g.error("unknown layout direction");
return null}},_getClientThickness:function(){var h=this.padding,i=this.editor.themeData.scroller.thickness;switch(this.layoutDirection){case k:return i-(h.left+h.right);case d:return i-(h.top+h.bottom);default:g.error("unknown layout direction");return null}},_getFrameLength:function(){switch(this.layoutDirection){case d:return this.frame.width;case k:return this.frame.height;default:g.error("unknown layout direction");return null}},_getGutterFrame:function(){var h=this._getClientFrame(),i=this._getClientThickness();
switch(this.layoutDirection){case k:return{x:h.x,y:h.y+15,width:i,height:Math.max(0,h.height-30)};case d:return{x:h.x+15,y:h.y,width:Math.max(0,h.width-30),height:i};default:g.error("unknown layout direction");return null}},_getGutterLength:function(){var h=this._getGutterFrame(),i;switch(this.layoutDirection){case d:i=h.width;break;case k:i=h.height;break;default:g.error("unknown layout direction");break}return i},_getHandleFrame:function(){var h=this._getGutterFrame(),i=this._getHandleOffset(),
j=this._getHandleLength();switch(this.layoutDirection){case k:return{x:h.x,y:h.y+i,width:h.width,height:j};case d:return{x:h.x+i,y:h.y,width:j,height:h.height}}},_getHandleLength:function(){var h=this._getGutterLength();return Math.max(h*this.proportion,20)},_getHandleOffset:function(){var h=this._maximum;if(h===0)return 0;var i=this._getGutterLength(),j=this._getHandleLength();return(i-j)*this._value/h},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},
_segmentForMouseEvent:function(h){h={x:h.layerX,y:h.layerY};var i=this._getClientFrame(),j=this.padding;if(!e.pointInRect(h,i))return null;var m=this.layoutDirection;switch(m){case d:if(h.x-j.left<15)return"nib-start";else if(h.x>=i.width-15)return"nib-end";break;case k:if(h.y-j.top<15)return"nib-start";else if(h.y>=i.height-15)return"nib-end";break;default:g.error("unknown layout direction");break}j=this._getHandleFrame();if(e.pointInRect(h,j))return"handle";switch(m){case d:if(h.x<j.x)return"gutter-before";
else if(h.x>=j.x+j.width)return"gutter-after";break;case k:if(h.y<j.y)return"gutter-before";else if(h.y>=j.y+j.height)return"gutter-after";break;default:g.error("unknown layout direction");break}g.error("_segmentForMouseEvent: point ",h," outside view with handle frame ",j," and client frame ",i);return null},adjustFrame:function(){var h=this.frame;this.set("layout",{left:0,top:0,width:h.width,height:h.height})},drawRect:function(h,i){if(this._isVisible){var j=this._isHighlighted();h=this.editor.themeData.scroller;
var m=j?h.fullAlpha:h.particalAlpha,o=this.frame;i.clearRect(0,0,o.width,o.height);i.save();o=this.padding;i.translate(o.left,o.top);this._getHandleFrame();o=this._getGutterLength();var x=this._getClientThickness(),u=x/2,f=this.layoutDirection,A=this._getHandleOffset()+15,F=this._getHandleLength();if(f===k){i.translate(x+1,0);i.rotate(Math.PI*0.5)}if(!(o<=F)){i.globalAlpha=m;if(j){j=this._getClientLength();i.fillStyle=h.trackFillStyle;i.fillRect(8.5,0.5,j-16,x-1);i.strokeStyle=h.trackStrokeStyle;
i.strokeRect(8.5,0.5,j-16,x-1)}j=function(){i.beginPath();i.arc(A+u+0.5,u,u-0.5,Math.PI/2,3*Math.PI/2,false);i.arc(A+F-u-0.5,u,u-0.5,3*Math.PI/2,Math.PI/2,false);i.lineTo(A+u+0.5,x-0.5);i.closePath()};j();o=i.createLinearGradient(A,0,A,x);o.addColorStop(0,h.barFillGradientTopStart);o.addColorStop(0.4,h.barFillGradientTopStop);o.addColorStop(0.41,h.barFillStyle);o.addColorStop(0.8,h.barFillGradientBottomStart);o.addColorStop(1,h.barFillGradientBottomStop);i.fillStyle=o;i.fill();i.save();i.clip();i.fillStyle=
h.barFillStyle;i.beginPath();i.moveTo(A+u*0.4,u*0.6);i.lineTo(A+u*0.9,x*0.4);i.lineTo(A,x*0.4);i.closePath();i.fill();i.beginPath();i.moveTo(A+F-u*0.4,0+u*0.6);i.lineTo(A+F-u*0.9,0+x*0.4);i.lineTo(A+F,0+x*0.4);i.closePath();i.fill();i.restore();i.save();j();i.strokeStyle=h.trackStrokeStyle;i.stroke();i.restore();this._drawNibs(i,m);i.restore()}}},_repeatAction:function(h,i){if(h()!==false){var j=function(){this._repeatAction(h,100)}.bind(this);this._scrollTimer=setTimeout(j,i)}},_scrollByDelta:function(h){this.value=
this._value+h},_scrollUpOneLine:function(){this._scrollByDelta(-this.lineHeight);return true},_scrollDownOneLine:function(){this._scrollByDelta(this.lineHeight);return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case "gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case "gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false}return true},mouseDown:function(h){this._mouseEventPosition=
h;this._mouseOverHandle=false;this._getGutterLength();switch(this._segmentForMouseEvent(h)){case "nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case "nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case "gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case "gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case "handle":break;default:g.error("_segmentForMouseEvent returned an unknown value");break}switch(this.layoutDirection){case d:this._mouseDownScreenPoint=
h.pageX;break;case k:this._mouseDownScreenPoint=h.pageY;break;default:g.error("unknown layout direction");break}},mouseMove:function(h){if(this._mouseDownScreenPoint!==null){if(this._segmentForMouseEvent(h)=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){clearTimeout(this._scrollTimer);this._scrollTimer=null}var i;switch(this.layoutDirection){case d:i=h.pageX;break;case k:i=h.pageY;break;default:g.error("unknown layout direction");break}var j=i-this._mouseDownScreenPoint,
m=this._maximum,o=this._value,x=this._getGutterLength(),u=this._getHandleLength();this.value=o+m*j/(x-u);this._mouseDownScreenPoint=i}this._mouseEventPosition=h}},mouseEntered:function(){this._isMouseOver=true;this.invalidate()},mouseExited:function(){this._isMouseOver=false;this.invalidate()},mouseUp:function(){this._mouseDownValue=this._mouseDownScreenPoint=null;if(this._scrollTimer){clearTimeout(this._scrollTimer);this._scrollTimer=null}this.invalidate()}});Object.defineProperties(t.ScrollerCanvasView.prototype,
{isVisible:{set:function(h){if(this._isVisible!==h){this._isVisible=h;this.domNode.style.display=h?"block":"none";h&&this.invalidate()}}},maximum:{set:function(h){if(this._value>this._maximum)this._value=this._maximum;if(h!==this._maximum){this._maximum=h;this.invalidate()}}},value:{set:function(h){if(h<0)h=0;else if(h>this._maximum)h=this._maximum;if(h!==this._value){this._value=h;this.valueChanged(h);this.invalidate()}}}})});
bespin.tiki.module("text_editor:views/text",function(y,t){var v=y("bespin:plugins").catalog,s=y("bespin:util/util"),g=y("events").Event,e=y("views/canvas").CanvasView;y("controllers/layoutmanager");var b=y("rangeutils:utils/range"),d=y("utils/rect"),k=y("views/textinput").TextInput,h=y("bespin:console").console,i=y("settings").settings;t.TextView=function(j,m){e.call(this,j,true);this.editor=m;this.padding={top:0,bottom:30,left:0,right:30};this.clippingChanged.add(this.clippingFrameChanged.bind(this));
var o=this.domNode;o.style.cursor="text";o.addEventListener("click",this.click.bind(this),false);o.addEventListener("mousedown",this.mouseDown.bind(this),false);o.addEventListener("mousemove",this.mouseMove.bind(this),false);window.addEventListener("mouseup",this.mouseUp.bind(this),false);m.willChangeBuffer.add(this.editorWillChangeBuffer.bind(this));this.selectionChanged=new g;this.beganChangeGroup=new g;this.endedChangeGroup=new g;this.willReplaceRange=new g;this.replacedCharacters=new g;this.textInput=
new k(j,this)};t.TextView.prototype=new e;s.mixin(t.TextView.prototype,{_dragPoint:null,_dragTimer:null,_enclosingScrollView:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_hasFocus:false,_mouseIsDown:false,selectionChanged:null,beganChangeGroup:null,endedChangeGroup:null,willReplaceRange:null,replacedCharacters:null,editorWillChangeBuffer:function(j){if(this.editor.layoutManager){var m=this.editor.layoutManager;
m.invalidatedRects.remove(this);m.changedTextAtRow.remove(this)}m=j.layoutManager;m.invalidatedRects.add(this,this.layoutManagerInvalidatedRects.bind(this));m.changedTextAtRow.add(this,this.layoutManagerChangedTextAtRow.bind(this))},didFocus:function(){this._setFocus(true,true)},didBlur:function(){this._setFocus(false,true)},_drag:function(){var j=this._dragPoint,m=d.offsetFromRect(this.clippingFrame,j);this.moveCursorTo(this._selectionPositionForPoint({x:j.x-m.x,y:j.y-m.y}),true)},_drawInsertionPoint:function(j,
m){if(this._insertionPointVisible){var o=this.editor.layoutManager.characterRectForPosition(this.editor.buffer._selectedRange.start);j=Math.floor(o.x);var x=o.y,u=Math.ceil(o.width);o=o.height;m.save();var f=this.editor.themeData.editor;if(this._hasFocus){m.strokeStyle=f.cursorColor;m.beginPath();m.moveTo(j+0.5,x);m.lineTo(j+0.5,x+o);m.closePath();m.stroke()}else{m.fillStyle=f.unfocusedCursorBackgroundColor;m.fillRect(j+0.5,x,u-0.5,o);m.strokeStyle=f.unfocusedCursorColor;m.strokeRect(j+0.5,x+0.5,
u-1,o-1)}m.restore()}},_drawLines:function(j,m){var o=this.editor,x=o.layoutManager,u=x.textLines,f=x.fontDimension.lineAscent,A=o.themeData;o=A.highlighterFG;A=A.highlighterBG;m.save();m.font=this.editor.font;var F=x.characterRangeForBoundingRect(j),p=F.start;F=F.end;for(var z=F.row,E=p.row;E<=z;E++){var G=u[E];if(!s.none(G)){var N=G.characters,W=N.length,$=Math.min(F.col,W);j=p.col;if(!(j>=W)){G=G.colors;if(G==null)G=[];for(W=0;W<G.length&&j<G[W].start;)W++;for(var ea=W<G.length?G[W].start:j;ea<
$;){j=G[W];var Y=j!=null?j.end:$,da=j!=null?j.tag:"plain";j=x.characterRectForPosition({row:E,col:ea});if(A.hasOwnProperty(da)){var ia=x.characterRectForPosition({row:E,col:Y-1});m.fillStyle=A[da];m.fillRect(j.x,j.y,ia.x-j.x+ia.width,ia.height)}da=o.hasOwnProperty(da)?o[da]:"red";ea=N.substring(ea,Y);m.fillStyle=da;m.fillText(ea,j.x,j.y+f);ea=Y;W++}}}}m.restore()},_drawSelectionHighlight:function(j,m){j=this.editor.themeData.editor;j=this._hasFocus?j.selectedTextBackgroundColor:j.unfocusedCursorBackgroundColor;
var o=this.editor.layoutManager;m.save();var x=b.normalizeRange(this.editor.buffer._selectedRange);m.fillStyle=j;o.rectsForRange(x).forEach(function(u){m.fillRect(u.x,u.y,u.width,u.height)});m.restore()},_drawSelection:function(j,m){this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?this._drawInsertionPoint(j,m):this._drawSelectionHighlight(j,m)},_getVirtualSelection:function(j){var m=this.editor.buffer._selectedRange,o=this.editor.buffer._selectedRangeEndVirtual;return{start:j&&o?o:m.start,
end:o||m.end}},_invalidateSelection:function(){var j=function(x){return{x:x.x-1,y:x.y,width:x.width+2,height:x.height}},m=this.editor.layoutManager,o=b.normalizeRange(this.editor.buffer._selectedRange);if(this._rangeIsInsertionPoint(o)){m=m.characterRectForPosition(o.start);this.invalidateRect(j(m))}else m.rectsForRange(o).forEach(function(x){this.invalidateRect(j(x))},this)},_isReadOnly:function(){return this.editor.layoutManager.textStorage.readOnly},_keymappingChanged:function(){this._keyBuffer=
"";this._keyState="start"},_performVerticalKeyboardSelection:function(j){var m=this.editor.buffer._selectedRangeEndVirtual;this.moveCursorTo(b.addPositions(m!==null?m:this.editor.buffer._selectedRange.end,{row:j,col:0}),true,true)},_rangeIsInsertionPoint:function(j){return b.isZeroLength(j)},_rearmInsertionPointBlinkTimer:function(){this._insertionPointVisible||this.blinkInsertionPoint();this._insertionPointBlinkTimer!==null&&clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=
setInterval(this.blinkInsertionPoint.bind(this),750)},_repositionSelection:function(){var j=this.editor.layoutManager.textLines,m=j.length,o=this.editor.buffer._selectedRange,x=Math.min(o.start.row,m-1);m=Math.min(o.end.row,m-1);var u=j[m];this.setSelection({start:{row:x,col:Math.min(o.start.col,j[x].characters.length)},end:{row:m,col:Math.min(o.end.col,u.characters.length)}})},_scrollPage:function(j){this.editor.scrollBy(0,(this.clippingFrame.height+this.editor.layoutManager.fontDimension.lineAscent)*
(j?-1:1))},_scrollWhileDragging:function(){var j=this._dragPoint;j=this.computeWithClippingFrame(j.layerX,j.layerY);s.mixin(this._dragPoint,j);this._drag()},_selectionPositionForPoint:function(j){j=this.editor.layoutManager.characterAtPoint(j);return j.partialFraction<0.5?j:b.addPositions(j,{row:0,col:1})},_syntaxManagerUpdatedSyntaxForRows:function(j,m){if(j!==m){var o=this.editor.layoutManager;o.updateTextRows(j,m);o.rectsForRange({start:{row:j,col:0},end:{row:m,col:0}}).forEach(this.invalidateRect,
this)}},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},copy:function(){return this.getSelectedCharacters()},cut:function(){var j=this.getSelectedCharacters();j!=""&&this.performBackspaceOrDelete(false);return j},click:function(){this.focus()},drawRect:function(j,m){m.fillStyle=this.editor.themeData.editor.backgroundColor;m.fillRect(j.x,j.y,j.width,j.height);this._drawSelection(j,m);this._drawLines(j,m)},focus:function(){this.textInput.focus()},
getInsertionPointPosition:function(){var j=this.editor;j=j.layoutManager.characterRectForPosition(j.buffer._selectedRange.start);return{x:j.x,y:j.y}},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?"":this.editor.layoutManager.textStorage.getCharacters(b.normalizeRange(this.editor.buffer._selectedRange))},getSelectedRange:function(j){return j?this.editor.buffer._selectedRange:b.normalizeRange(this.editor.buffer._selectedRange)},groupChanges:function(j){if(this._isReadOnly())return false;
if(this._inChangeGroup){j();return true}this._inChangeGroup=true;this.beganChangeGroup(this,this.editor.buffer._selectedRange);try{j()}catch(m){h.error("Error in groupChanges(): "+m);this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return false}finally{this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return true}},insertText:function(j){if(this._isReadOnly())return false;this.groupChanges(function(){var m=b.normalizeRange(this.editor.buffer._selectedRange);
this.replaceCharacters(m,j);var o=j.split("\n");this.moveCursorTo(o.length>1?{row:m.start.row+o.length-1,col:o[o.length-1].length}:b.addPositions(m.start,{row:0,col:j.length}))}.bind(this));return true},isDelimiter:function(j){return"\"',;.!~@#$%^&*?[]<>():/\\-+ \t".indexOf(j)!==-1},keyDown:function(j){if(j.charCode===0||j._charCode===0)return this.editor.processKeyEvent(j,this,{isTextView:true});else if(j.keyCode===9)j.preventDefault();else return false},layoutManagerChangedTextAtRow:function(){this._repositionSelection()},
layoutManagerInvalidatedRects:function(j,m){m.forEach(this.invalidateRect,this)},mouseDown:function(j){this._mouseIsDown=this.hasFocus=true;var m=this.computeWithClippingFrame(j.layerX,j.layerY);s.mixin(m,{layerX:j.layerX,layerY:j.layerY});switch(j.detail){case 1:var o=this._selectionPositionForPoint(m);this.moveCursorTo(o,j.shiftKey);break;case 2:o=this._selectionPositionForPoint(m);var x=this.editor.layoutManager.textStorage.lines[o.row];if(x.length===0)return true;o.col-=o.col==x.length?1:0;var u=
!this.isDelimiter(x[o.col]),f=this,A=function(F,p){for(;F>-1&&F<x.length;F+=p)if(f.isDelimiter(x[F])===u)break;return F+(p==1?0:1)};j=A(o.col,-1);A=A(o.col,1);this.moveCursorTo({row:o.row,col:j});this.moveCursorTo({row:o.row,col:A},true);break;case 3:j=this.editor.layoutManager.textStorage.lines;o=this._selectionPositionForPoint(m);this.setSelection({start:{row:o.row,col:0},end:{row:o.row,col:j[o.row].length}});break}this._dragPoint=m;this._dragTimer=setInterval(this._scrollWhileDragging.bind(this),
100)},mouseMove:function(j){if(this._mouseIsDown){this._dragPoint=this.computeWithClippingFrame(j.layerX,j.layerY);s.mixin(this._dragPoint,{layerX:j.layerX,layerY:j.layerY});this._drag()}},mouseUp:function(){this._mouseIsDown=false;if(this._dragTimer!==null){clearInterval(this._dragTimer);this._dragTimer=null}},moveCursorTo:function(j,m,o){var x=this.editor.layoutManager.textStorage,u=x.clampPosition(j);this.setSelection({start:m?this.editor.buffer._selectedRange.start:u,end:u});if(o){m=x.lines.length;
o=j.row;x=j.col;this.editor.buffer._selectedRangeEndVirtual=o>0&&o<m?j:{row:o<1?0:m-1,col:x}}else this.editor.buffer._selectedRangeEndVirtual=null;this.scrollToPosition(this.editor.buffer._selectedRange.end)},moveDown:function(){var j=this._getVirtualSelection();j=b.normalizeRange(j);j=this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?j.end:{row:j.end.row,col:j.start.col};j=b.addPositions(j,{row:1,col:0});this.moveCursorTo(j,false,true)},moveLeft:function(){var j=b.normalizeRange(this.editor.buffer._selectedRange);
this._rangeIsInsertionPoint(j)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(j.start,-1)):this.moveCursorTo(j.start)},moveRight:function(){var j=b.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(j)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(j.end,1)):this.moveCursorTo(j.end)},moveUp:function(){var j=b.normalizeRange(this._getVirtualSelection(true));position=b.addPositions({row:j.start.row,col:this._getVirtualSelection().end.col},
{row:-1,col:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(j,m){if(this._isReadOnly())return false;this.groupChanges(function(){j=b.normalizeRange(j);this.willReplaceRange(this,j);this.editor.layoutManager.textStorage.replaceCharacters(j,m);this.replacedCharacters(this,j,m)}.bind(this));return true},performBackspaceOrDelete:function(j){if(this._isReadOnly())return false;var m=this.editor.layoutManager.textStorage,
o=m.lines,x="";x=0;var u=i.get("tabstop"),f=this.getSelectedRange();if(b.isZeroLength(f))if(j){j=f.start;x=o[j.row];x=x.substring(0,j.col).match(/\s*$/)[0].length<u||(j.col-u)%u!=0?1:u;f={start:m.displacePosition(j,x*-1),end:f.end}}else{j=f.end;x=o[j.row];x=x.substring(j.col).match(/^\s*/)[0].length<u?1:u;f={start:f.start,end:m.displacePosition(f.end,x)}}this.groupChanges(function(){this.replaceCharacters(f,"");this.moveCursorTo(f.start)}.bind(this));return true},resetKeyBuffers:function(){this._keyMetaBuffer=
this._keyBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(j){var m=this.editor.layoutManager.characterRectForPosition(j);j=m.x;var o=m.y,x=m.width;m=m.height;var u=this.clippingFrame,f=u.x,A=u.y,F=this.padding,p=u.width-F.right;u=u.height-F.bottom;this.editor.scrollTo({x:j>=f+30&&j+x<f+p?f:j-p/2+x/2,y:o>=A&&o+m<A+u?A:o-u/2+m/2})},selectAll:function(){var j=this.editor.layoutManager.textStorage.lines,m=j.length-
1;this.setSelection({start:{row:0,col:0},end:{row:m,col:j[m].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,-1),true)},selectRight:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,1),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(j,
m){var o=this.editor.layoutManager.textStorage;j=o.clampRange(j);if(!b.equal(j,this.editor.buffer._selectedRange)){this._invalidateSelection();this.editor.buffer._selectedRange=j=o.clampRange(j);this._invalidateSelection();this._hasFocus&&this._rearmInsertionPointBlinkTimer();m&&this.scrollToPosition(j.end);this.selectionChanged(j);v.publish(this.editor,"editorChange","selection",j)}},textInserted:function(j){if(j!=="\n")if(!this.editor.processKeyEvent(j,this,{isTextView:true,isCommandKey:false})){this.insertText(j);
this.resetKeyBuffers()}},_setFocus:function(j,m){if(j!=this._hasFocus)if(this._hasFocus=j){this._rearmInsertionPointBlinkTimer();this._invalidateSelection();m||this.textInput.focus()}else{if(this._insertionPointBlinkTimer){clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=null}this._insertionPointVisible=true;this._invalidateSelection();m||this.textInput.blur()}}});Object.defineProperties(t.TextView.prototype,{hasFocus:{get:function(){return this._hasFocus},set:function(j){this._setFocus(j,
false)}}})});bespin.tiki.module("text_editor:commands/scrolling",function(y,t){var v=y("environment").env;t.scrollDocStart=function(){v.view.scrollToPosition({col:0,row:0})};t.scrollDocEnd=function(){v.view.scrollToPosition(v.model.range.end)};t.scrollPageDown=function(){v.view.scrollPageDown()};t.scrollPageUp=function(){v.view.scrollPageUp()}});
bespin.tiki.module("text_editor:commands/editor",function(y,t){y("bespin:plugins");var v=y("settings").settings,s=y("environment").env;t.findNextCommand=function(){var e=s.view,b=e.editor.searchController,d=e.getSelectedRange();if(b=b.findNext(d.end,true)){e.setSelection(b,true);e.focus()}};t.findPrevCommand=function(){var e=s.view,b=e.editor.searchController,d=e.getSelectedRange();if(b=b.findPrevious(d.start,true)){e.setSelection(b,true);e.focus()}};var g=function(e){var b=s.view,d=b.getSelectedCharacters();
e=e(d);b=b.getSelectedRange();s.model.replaceCharacters(b,e)};t.replaceCommand=function(e){g(function(b){return b.replace(e.search+"/g",e.replace)})};t.entabCommand=function(){tabstop=v.get("tabstop");g(function(e){return e.replace(" {"+tabstop+"}","\t")})};t.detabCommand=function(){tabstop=v.get("tabstop");g(function(e){return e.replace("\t",(new Array(tabstop+1)).join(" "))})};t.trimCommand=function(e){g(function(b){b=b.split("\n");b=b.map(function(d){if(e.side==="left"||e.side==="both")d=d.replace(/^\s+/,
"");if(e.side==="right"||e.side==="both")d=d.replace(/\s+$/,"");return d});return b.join("\n")})};t.ucCommand=function(){g(function(e){return e.toUpperCase()})};t.lcCommand=function(){g(function(e){return e.toLowerCase()})}});
bespin.tiki.module("text_editor:commands/editing",function(y,t){var v=y("settings").settings,s=y("environment").env,g=y("rangeutils:utils/range");t.backspace=function(){s.view.performBackspaceOrDelete(true)};t.deleteCommand=function(){s.view.performBackspaceOrDelete(false)};t.deleteLines=function(){if(!s.model.readOnly)if(s.model.lines.length!=1){var b=s.view;b.groupChanges(function(){var d=b.getSelectedRange(),k=s.model.lines,h=k.length-1,i;i=d.start.row==h?{col:k[h-1].length,row:h-1}:{col:0,row:d.start.row};
b.replaceCharacters({start:i,end:d.end.row==h?{col:k[h].length,row:h}:{col:0,row:d.end.row+1}},"");b.moveCursorTo(i)})}};var e=function(b,d){var k=d.getSelectedRange().start;b=/^\s*/.exec(b.lines[k.row].substring(0,k.col));d.insertText("\n"+b)};t.insertText=function(b){s.view.insertText(b.text)};t.newline=function(){e(s.model,s.view)};t.joinLines=function(){var b=s.model;if(!b.readOnly){var d=s.view,k=d.getSelectedRange(),h=b.lines,i=k.end.row;h.length!=i&&d.groupChanges(function(){d.replaceCharacters({start:{col:h[i].length,
row:i},end:{col:/^\s*/.exec(h[i+1])[0].length,row:i+1}},"")})}};t.openLine=function(){if(!s.model.readOnly){var b=s.model,d=s.view,k=d.getSelectedRange().end.row;d.moveCursorTo({row:k,col:b.lines[k].length});e(b,d)}};t.tab=function(){var b=s.view;b.groupChanges(function(){var d=v.get("tabstop"),k=b.getSelectedRange(),h="";if(g.isZeroLength(k)){var i=s.model.lines[k.start.row].substring(k.start.col).match(/^\s*/)[0].length;d=d-(k.start.col+i)%d;for(var j=0;j<d;j++)h+=" ";b.replaceCharacters({start:k.start,
end:k.start},h);b.moveCursorTo({col:k.start.col+d+i,row:k.end.row})}else{for(j=0;j<d;j++)h+=" ";for(j=k.start.row-1;j++<k.end.row;){i=j==k.start.row?k.start.col:0;b.replaceCharacters({start:{row:j,col:i},end:{row:j,col:i}},h)}b.setSelection({start:k.start,end:{col:k.end.col+d,row:k.end.row}})}}.bind(this))};t.untab=function(){var b=s.view;b.groupChanges(function(){var d=v.get("tabstop"),k=b.getSelectedRange(),h=s.model.lines,i=0;if(g.isZeroLength(k)){i=Math.min(h[k.start.row].substring(0,k.start.col).match(/\s*$/)[0].length,
(k.start.col-d)%d||d);b.replaceCharacters({start:{col:k.start.col-i,row:k.start.row},end:k.start},"");b.moveCursorTo({row:k.start.row,col:k.end.col-i})}else{for(var j,m=k.start.row-1;m++<k.end.row;){j=m==k.start.row?k.start.col:0;i=Math.min(h[m].substring(j).match(/^\s*/)[0].length,d);b.replaceCharacters({start:{row:m,col:j},end:{row:m,col:j+i}},"")}b.setSelection({start:{row:k.start.row,col:k.start.col},end:{row:k.end.row,col:k.end.col-i}})}}.bind(this))}});
bespin.tiki.module("text_editor:commands/movement",function(y,t){y("rangeutils:utils/range");var v=y("environment").env;t.moveDown=function(){v.view.moveDown()};t.moveLeft=function(){v.view.moveLeft()};t.moveRight=function(){v.view.moveRight()};t.moveUp=function(){v.view.moveUp()};t.selectDown=function(){v.view.selectDown()};t.selectLeft=function(){v.view.selectLeft()};t.selectRight=function(){v.view.selectRight()};t.selectUp=function(){v.view.selectUp()};var s=function(k,h){var i=v.view,j=v.model.lines,
m=i.getSelectedRange(true);h=h?m.end.row:j.length-1;i.moveCursorTo({row:h,col:j[h].length},k)};t.moveLineEnd=function(){s(false,true)};t.selectLineEnd=function(){s(true,true)};t.moveDocEnd=function(){s(false,false)};t.selectDocEnd=function(){s(true,false)};var g=function(k,h){var i=v.view,j=i.getSelectedRange(true);i.moveCursorTo({row:h?j.end.row:0,col:0},k)};t.moveLineStart=function(){g(false,true)};t.selectLineStart=function(){g(true,true)};t.moveDocStart=function(){g(false,false)};t.selectDocStart=
function(){g(true,false)};var e=function(k,h,i,j,m){var o=0,x=false;if(j<0){i--;if(m)o=1}for(;i<h.length&&i>-1;){if(m=k.isDelimiter(h[i]))o++;else x=true;if((m||o>1)&&x)break;i+=j}j<0&&i++;return i},b=function(k){var h=v.view,i=v.model.lines,j=h.getSelectedRange(true).end,m=j.row;j=j.col;var o=i[m],x=false;if(j>=o.length){m++;x=true;if(m<i.length){j=0;o=i[m]}else o=""}j=e(h,o,j,1,x);h.moveCursorTo({row:m,col:j},k)},d=function(k){var h=v.view,i=v.model.lines,j=h.getSelectedRange(true).end,m=j.row;
j=j.col;var o=i[m],x=false;if(j>o.length)j=o.length;else if(j==0){m--;x=true;if(m>-1){o=i[m];j=o.length}else o=""}j=e(h,o,j,-1,x);h.moveCursorTo({row:m,col:j},k)};t.moveNextWord=function(){b(false)};t.selectNextWord=function(){b(true)};t.movePreviousWord=function(){d(false)};t.selectPreviousWord=function(){d(true)};t.selectAll=function(){v.view.selectAll()}});
bespin.tiki.module("text_editor:controllers/layoutmanager",function(y,t){var v=y("bespin:util/util"),s=y("events").Event;y("rangeutils:utils/range");var g=y("syntax_manager").SyntaxManager,e=y("models/textstorage").TextStorage,b=y("bespin:plugins").catalog,d=y("settings").settings,k=y("bespin:util/scratchcanvas"),h={};y=function(){var i=d.get("fontsize"),j=d.get("fontface");j=i+"px "+j;for(var m=k.get(),o="",x=0;x<100;x++)o+="M";j=m.measureStringWidth(j,o)/100;h.characterWidth=j;h.lineHeight=Math.floor(i*
1.6);h.lineAscent=Math.floor(i*1.3)};y();b.registerExtension("settingChange",{match:"font[size|face]",pointer:y});t.LayoutManager=function(i){this.changedTextAtRow=new s;this.invalidatedRects=new s;this.fontDimension=h;if(i.textStorage){i._textStorage=i.textStorage;delete i.textStorage}else this._textStorage=new e;v.mixin(this,i);this._textStorage.changed.add(this.textStorageChanged.bind(this));this.textLines=[{characters:"",colors:[{start:0,end:0,color:"plain"}]}];this.syntaxManager=i=new g(this);
i.attrsChanged.add(this._attrsChanged.bind(this));this._size={width:0,height:0};this.sizeChanged=new s;this._height=0;this._recomputeEntireLayout()};t.LayoutManager.prototype={_maximumWidth:0,_textStorage:null,_size:null,sizeChanged:null,_theme:{},margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:b,syntaxManager:null,textLines:null,_attrsChanged:function(i,j){this.updateTextRows(i,j);this.invalidatedRects(this,this.rectsForRange({start:{row:i,col:0},end:{row:j,col:0}}))},_computeInvalidRects:function(i,
j){var m=this.characterRectForPosition(i.start),o={x:m.x,y:m.y,width:Number.MAX_VALUE,height:m.height};return i.end.row===j.end.row?[o]:[o,{x:0,y:m.y+h.lineHeight,width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.textLines.length-1,col:this._maximumWidth}},_recalculateMaximumWidth:function(){var i=0;this.textLines.forEach(function(j){j=j.characters.length;if(i<j)i=j});this._maximumWidth=i;this.size={width:i,height:this.textLines.length}},_recomputeEntireLayout:function(){var i=
this._textStorage.range;this._recomputeLayoutForRanges(i,i)},_recomputeLayoutForRanges:function(i,j){for(var m=i.start.row,o=i.end.row,x=j.end.row,u=x-m+1,f=this._textStorage.lines,A=this._theme.plain,F=[],p=0;p<u;p++)F[p]={characters:f[m+p],colors:[{start:0,end:null,color:A}]};this.textLines=v.replace(this.textLines,m,o-m+1,F);this._recalculateMaximumWidth();o=this.textLines.length;u=this.syntaxManager;if(this._height!==o)this._height=o;u.invalidateRow(m);this.updateTextRows(m,x+1);this.changedTextAtRow(this,
m);this.invalidatedRects(this,this._computeInvalidRects(i,j))},boundingRect:function(){return this.rectsForRange({start:{row:0,col:0},end:{row:this.textLines.length-1,col:this._maximumWidth}})[0]},characterAtPoint:function(i){var j=this.margin,m=i.x-j.left,o=h.characterWidth,x=this._textStorage;i=x.clampPosition({row:Math.floor((i.y-j.top)/h.lineHeight),col:Math.floor(m/o)});x=x.lines[i.row].length;i.partialFraction=m<0||i.col===x?0:m%o/o;return i},characterRangeForBoundingRect:function(i){var j=
h.lineHeight,m=h.characterWidth,o=this.margin,x=i.x-o.left;o=i.y-o.top;return{start:{row:Math.max(Math.floor(o/j),0),col:Math.max(Math.floor(x/m),0)},end:{row:Math.floor((o+i.height-1)/j),col:Math.floor((x+i.width-1)/m)+1}}},characterRectForPosition:function(i){return this.rectsForRange({start:i,end:{row:i.row,col:i.col+1}})[0]},lineRectForRow:function(i){return this.rectsForRange({start:{row:i,col:0},end:{row:i,col:this._maximumWidth}})[0]},rectForPosition:function(i){var j=this.margin,m=h.characterWidth,
o=h.lineHeight;return{x:j.left+m*i.col,y:j.top+o*i.row,width:m,height:o}},rectsForRange:function(i){var j=h.characterWidth,m=h.lineHeight,o=this._maximumWidth,x=this.margin,u=i.start,f=i.end;i=u.row;var A=u.col;u=f.row;f=f.col;if(i===u)return[{x:x.left+j*A,y:x.top+m*i,width:j*(f-A),height:m}];var F=[],p;if(A===0)p=i;else{p=i+1;F.push({x:x.left+j*A,y:x.top+m*i,width:99999,height:m})}if(f===0)o=u-1;else if(f===o)o=u;else{o=u-1;F.push({x:x.left,y:x.top+m*u,width:j*f,height:m})}F.push({x:x.left,y:x.top+
m*p,width:99999,height:m*(o-p+1)});return F},textStorageChanged:function(i,j){this._recomputeLayoutForRanges(i,j)},updateTextRows:function(i,j){var m=this.textLines;j=this.syntaxManager.getAttrsForRows(i,j);for(var o=0;o<j.length;o++)m[i+o].colors=j[o]}};Object.defineProperties(t.LayoutManager.prototype,{size:{set:function(i){if(i.width!==this._size.width||i.height!==this._size.height){this.sizeChanged(i);this._size=i}},get:function(){return this._size}},textStorage:{get:function(){return this._textStorage}}})});
bespin.tiki.module("text_editor:controllers/undo",function(y,t){var v=y("bespin:console").console,s=y("environment").env;t.EditorUndoController=function(g){this.editor=g;g=this.textView=g.textView;g.beganChangeGroup.add(function(e,b){this._beginTransaction();this._record.selectionBefore=b}.bind(this));g.endedChangeGroup.add(function(e,b){this._record.selectionAfter=b;this._endTransaction()}.bind(this));g.replacedCharacters.add(function(e,b,d){if(!this._inTransaction)throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction");
this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:b,newCharacters:d,newRange:this.editor.layoutManager.textStorage.resultingRangeForReplacement(b,d.split("\n"))});this._deletedCharacters=null}.bind(this));g.willReplaceRange.add(function(e,b){if(!this._inTransaction)throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction");this._deletedCharacters=this.editor.layoutManager.textStorage.getCharacters(b)}.bind(this))};t.EditorUndoController.prototype=
{_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){v.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place");}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction)throw new Error("UndoController._endTransaction() called without a transaction in place");this.editor.buffer.undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=
false},_tryApplyingPatches:function(g){var e=this.editor.layoutManager.textStorage;g.forEach(function(b){e.replaceCharacters(b.oldRange,b.newCharacters)});return true},_undoOrRedo:function(g,e){if(this._inTransaction)throw new Error("UndoController._undoOrRedo() called while in a transaction");if(!this._tryApplyingPatches(g))return false;this.textView.setSelection(e,true);return true},redo:function(g){var e=g.patches.concat();e.reverse();return this._undoOrRedo(e,g.selectionAfter)},undo:function(g){return this._undoOrRedo(g.patches.map(function(e){return{oldCharacters:e.newCharacters,
oldRange:e.newRange,newCharacters:e.oldCharacters,newRange:e.oldRange}}),g.selectionBefore)}};t.undoManagerCommand=function(g,e){s.editor.buffer.undoManager[e.commandExt.name]()}});
bespin.tiki.module("text_editor:controllers/search",function(y,t){var v=y("bespin:util/util");y("rangeutils:utils/range");y("bespin:console");t.EditorSearchController=function(s){this.editor=s};t.EditorSearchController.prototype={editor:null,_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(s){var g=[],e=this.searchRegExp,b;for(e.lastIndex=0;;){b=e.exec(s);if(b===null)break;g.push(b);e.lastIndex=b.index+b[0].length}return g},_makeRange:function(s,g){return{start:{row:g,
col:s.index},end:{row:g,col:s.index+s[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,setSearchText:function(s,g){this.searchRegExp=g?new RegExp(s):new RegExp(s.replace(this._escapeString,"\\$1"),"gi");this.isRegExp=g;this.searchText=s},findNext:function(s,g){var e=this.searchRegExp;if(v.none(e))return null;s=s||this.editor.textView.getSelectedRange().end;var b=this.editor.layoutManager.textStorage.lines,d;e.lastIndex=s.col;var k;for(k=s.row;k<b.length;k++){d=e.exec(b[k]);if(!v.none(d))return this._makeRange(d,
k)}if(!g)return null;for(k=0;k<=s.row;k++){d=e.exec(b[k]);if(!v.none(d))return this._makeRange(d,k)}return null},findPrevious:function(s,g){if(v.none(this.searchRegExp))return null;s=s||this.editor.textView.getSelectedRange().start;var e=this.editor.buffer.layoutManager.textStorage.lines,b;b=this._findMatchesInString(e[s.row].substring(0,s.col));if(b.length!==0)return this._makeRange(b[b.length-1],s.row);var d;for(d=s.row-1;d!==-1;d--){b=this._findMatchesInString(e[d]);if(b.length!==0)return this._makeRange(b[b.length-
1],d)}if(!g)return null;for(d=e.length-1;d>=s.row;d--){b=this._findMatchesInString(e[d]);if(b.length!==0)return this._makeRange(b[b.length-1],d)}return null}}});bespin.tiki.module("text_editor:index",function(){});bespin.tiki.register("::less",{name:"less",dependencies:{}});
bespin.tiki.module("less:index",function(y,t){function v(b){if(b instanceof e.Dimension)return parseFloat(b.unit=="%"?b.value/100:b.value);else if(typeof b==="number")return b;else throw{error:"RuntimeError",message:"color functions take numbers as parameters"};}function s(b){return Math.min(1,Math.max(0,b))}if(!Array.isArray)Array.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"||b instanceof Array};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,d){for(var k=
this.length>>>0,h=0;h<k;h++)h in this&&b.call(d,this[h],h,this)};if(!Array.prototype.map)Array.prototype.map=function(b,d){for(var k=this.length>>>0,h=new Array(k),i=0;i<k;i++)if(i in this)h[i]=b.call(d,this[i],i,this);return h};if(!Array.prototype.filter)Array.prototype.filter=function(b,d){for(var k=[],h=0;h<this.length;h++)b.call(d,this[h])&&k.push(this[h]);return k};if(!Array.prototype.reduce)Array.prototype.reduce=function(b){var d=this.length>>>0,k=0;if(d===0&&arguments.length===1)throw new TypeError;
if(arguments.length>=2)var h=arguments[1];else{do{if(k in this){h=this[k++];break}if(++k>=d)throw new TypeError;}while(1)}for(;k<d;k++)if(k in this)h=b.call(null,h,this[k],k,this);return h};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b,d){var k=this.length;d=d||0;if(!k)return-1;if(d>=k)return-1;if(d<0)d+=k;for(;d<k;d++)if(Object.prototype.hasOwnProperty.call(this,d))if(b===this[d])return d;return-1};if(!Object.keys)Object.keys=function(b){var d=[];for(var k in b)Object.prototype.hasOwnProperty.call(b,
k)&&d.push(k);return d};if(!String.prototype.trim)String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")};if(typeof y!=="undefined")var g=t,e={};else g=e={};g.Parser=function(b){function d(p){var z,E,G;if(p instanceof Function)return p.call(u.parsers);else if(typeof p==="string"){z=h.charAt(i)===p?p:null;E=1}else{if(i>=x+o[j].length&&j<o.length-1)x+=o[j++].length;p.lastIndex=G=i-x;if(z=p.exec(o[j])){E=z[0].length;if(p.lastIndex-E!==G)return}}if(z){i+=E;for(E=
x+o[j].length;i<=E;){p=h.charCodeAt(i);if(!(p===32||p===10||p===9))break;i++}return typeof z==="string"?z:z.length===1?z[0]:z}}function k(p){var z;if(typeof p==="string")return h.charAt(i)===p;else{p.lastIndex=i;if((z=p.exec(h))&&p.lastIndex-z[0].length===i)return z}}var h,i,j,m,o,x,u,f=this,A=function(){},F=this.imports={paths:b&&b.paths||[],queue:[],files:{},push:function(p,z){var E=this;this.queue.push(p);g.Parser.importer(p,this.paths,function(G){E.queue.splice(E.queue.indexOf(p),1);E.files[p]=
G;z(G);E.queue.length===0&&A()})}};this.env=b||{};this.optimization="optimization"in this.env?this.env.optimization:1;return u={imports:F,parse:function(p,z){var E,G,N=null;i=j=x=m=0;o=[];h=p.replace(/\r\n/g,"\n");if(f.optimization>0){h=h.replace(/\/\*(?:[^*]|\*+[^\/*])*\*+\//g,function(ea){return f.optimization>1?"":ea.replace(/\n(\s*\n)+/g,"\n")});o=h.split(/^(?=\n)/mg)}else o=[h];E=new e.Ruleset([],d(this.parsers.primary));E.root=true;E.toCSS=function(ea){var Y,da;return function(){try{return ea.call(this)}catch(ia){da=
h.split("\n");Y=(h.slice(0,ia.index).match(/\n/g)||"").length+1;for(var ma=ia.index,na=-1;ma>=0&&h.charAt(ma)!=="\n";ma--)na++;throw{name:"NameError",message:ia.message,line:Y,column:na,extract:[da[Y-2],da[Y-1],da[Y]]};}}}(E.toCSS);if(i<h.length-1){i=m;G=h.split("\n");p=(h.slice(0,i).match(/\n/g)||"").length+1;for(var W=i,$=-1;W>=0&&h.charAt(W)!=="\n";W--)$++;N={name:"ParseError",message:"Syntax Error on line "+p,filename:b.filename,line:p,column:$,extract:[G[p-2],G[p-1],G[p]]}}if(this.imports.queue.length>
0)A=function(){z(N,E)};else z(N,E)},parsers:{primary:function(){for(var p,z=[];p=d(this.mixin.definition)||d(this.rule)||d(this.ruleset)||d(this.mixin.call)||d(this.comment)||d(/[\n\s]+/g)||d(this.directive);)z.push(p);return z},comment:function(){var p;if(h.charAt(i)==="/")return(p=d(/\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/g))?new e.Comment(p):d(/\/\/.*/g)},entities:{quoted:function(){var p;if(!(h.charAt(i)!=='"'&&h.charAt(i)!=="'"))if(p=d(/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/g))return new e.Quoted(p[0],
p[1]||p[2])},keyword:function(){var p;if(p=d(/[A-Za-z-]+/g))return new e.Keyword(p)},call:function(){var p,z;if(p=d(/([a-zA-Z0-9_-]+|%)\(/g)){if(p[1].toLowerCase()==="alpha")return d(this.alpha);z=d(this.entities.arguments);if(d(")"))if(p)return new e.Call(p[1],z)}},arguments:function(){for(var p=[],z;z=d(this.expression);){p.push(z);if(!d(","))break}return p},literal:function(){return d(this.entities.dimension)||d(this.entities.color)||d(this.entities.quoted)},url:function(){var p;if(!(h.charAt(i)!==
"u"||!d(/url\(/g))){p=d(this.entities.quoted)||d(/[-a-zA-Z0-9_%@$\/.&=:;#+?]+/g);if(!d(")"))throw new Error("missing closing ) for url()");return new e.URL(p.value?p:new e.Anonymous(p))}},variable:function(){var p,z=i;if(h.charAt(i)==="@"&&(p=d(/@[a-zA-Z0-9_-]+/g)))return new e.Variable(p,z)},color:function(){var p;if(h.charAt(i)==="#"&&(p=d(/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/g)))return new e.Color(p[1])},dimension:function(){var p;p=h.charCodeAt(i);if(!(p>57||p<45||p===47))if(p=d(/(-?[0-9]*\.?[0-9]+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm)?/g))return new e.Dimension(p[1],
p[2])}},variable:function(){var p;if(h.charAt(i)==="@"&&(p=d(/(@[a-zA-Z0-9_-]+)\s*:/g)))return p[1]},shorthand:function(){var p,z;if(k(/[@\w.-]+\/[@\w.-]+/g))if((p=d(this.entity))&&d("/")&&(z=d(this.entity)))return new e.Shorthand(p,z)},mixin:{call:function(){for(var p=[],z,E,G,N=i;z=d(/[#.][a-zA-Z0-9_-]+/g);){p.push(new e.Element(E,z));E=d(">")}d("(")&&(G=d(this.entities.arguments))&&d(")");if(p.length>0&&(d(";")||k("}")))return new e.mixin.Call(p,G,N)},definition:function(){var p,z=[],E,G;if(!(h.charAt(i)!==
"."||k(/[^{]*(;|})/g)))if(p=d(/([#.][a-zA-Z0-9_-]+)\s*\(/g)){for(p=p[1];E=d(/@[\w-]+/g)||d(this.entities.literal)||d(this.entities.keyword);){if(E[0]==="@")if(d(":"))if(G=d(this.expression))z.push({name:E,value:G});else throw new Error("Expected value");else z.push({name:E});else z.push({value:E});if(!d(","))break}if(!d(")"))throw new Error("Expected )");if(E=d(this.block))return new e.mixin.Definition(p,z,E)}}},entity:function(){return d(this.entities.literal)||d(this.entities.variable)||d(this.entities.url)||
d(this.entities.call)||d(this.entities.keyword)},end:function(){return d(";")||k("}")},alpha:function(){var p;if(d(/opacity=/gi))if(p=d(/[0-9]+/g)||d(this.entities.variable)){if(!d(")"))throw new Error("missing closing ) for alpha()");return new e.Alpha(p)}},element:function(){var p;c=d(this.combinator);if(p=d(/[.#:]?[a-zA-Z0-9_-]+/g)||d("*")||d(this.attribute)||d(/\([^)@]+\)/g))return new e.Element(c,p)},combinator:function(){var p;return(p=d(/[+>~]/g)||d("&")||d(/::/g))?new e.Combinator(p):new e.Combinator(h.charAt(i-
1)===" "?" ":null)},selector:function(){for(var p,z=[];p=d(this.element);)z.push(p);if(z.length>0)return new e.Selector(z)},tag:function(){return d(/[a-zA-Z][a-zA-Z-]*[0-9]?/g)||d("*")},attribute:function(){var p="",z,E,G;if(d("[")){if(z=d(/[a-z-]+/g)||d(this.entities.quoted))p=(G=d(/[|~*$^]?=/g))&&(E=d(this.entities.quoted)||d(/[\w-]+/g))?[z,G,E.toCSS?E.toCSS():E].join(""):z;if(d("]"))if(p)return"["+p+"]"}},block:function(){var p;if(d("{")&&(p=d(this.primary))&&d("}"))return p},ruleset:function(){var p=
[],z,E,G=i;if(z=k(/([a-z.#: _-]+)[\s\n]*\{/g)){i+=z[0].length-1;p=[new e.Selector([new e.Element(null,z[1])])]}else{for(;z=d(this.selector);){p.push(z);if(!d(","))break}z&&d(this.comment)}if(p.length>0&&(E=d(this.block)))return new e.Ruleset(p,E);else{m=i;i=G}},rule:function(){var p,z=i;if(name=d(this.property)||d(this.variable)){if(name.charAt(0)!="@"&&(match=k(/([^@+\/*(;{}-]*);/g))){i+=match[0].length-1;p=new e.Anonymous(match[1])}else p=name==="font"?d(this.font):d(this.value);if(d(this.end))return new e.Rule(name,
p,z);else{m=i;i=z}}},"import":function(){var p;if(d(/@import\s+/g)&&(p=d(this.entities.quoted)||d(this.entities.url))&&d(";"))return new e.Import(p,F)},directive:function(){var p,z,E;if(h.charAt(i)==="@")if(z=d(this["import"]))return z;else if(p=d(/@media|@page/g)){E=d(/[^{]+/g).trim();if(z=d(this.block))return new e.Directive(p+" "+E,z)}else if(p=d(/@[-a-z]+/g))if(p==="@font-face"){if(z=d(this.block))return new e.Directive(p,z)}else if((z=d(this.entity))&&d(";"))return new e.Directive(p,z)},font:function(){for(var p=
[],z=[],E;E=d(this.shorthand)||d(this.entity);)z.push(E);p.push(new e.Expression(z));if(d(","))for(;E=d(this.expression);){p.push(E);if(!d(","))break}return new e.Value(p,d(this.important))},value:function(){for(var p,z=[];p=d(this.expression);){z.push(p);if(!d(","))break}p=d(this.important);if(z.length>0)return new e.Value(z,p)},important:function(){return d(/!\s*important/g)},sub:function(){var p;if(d("(")&&(p=d(this.expression))&&d(")"))return p},multiplication:function(){var p,z,E,G;if(p=d(this.operand)){for(;(E=
d(/[\/*]/g))&&(z=d(this.operand));)G=new e.Operation(E,[G||p,z]);return G||p}},addition:function(){var p,z,E,G;if(p=d(this.multiplication)){for(;(E=d(/[-+]\s+/g)||h.charAt(i-1)!=" "&&d(/[-+]/g))&&(z=d(this.multiplication));)G=new e.Operation(E,[G||p,z]);return G||p}},operand:function(){return d(this.sub)||d(this.entities.dimension)||d(this.entities.color)||d(this.entities.variable)},expression:function(){for(var p,z=[];p=d(this.addition)||d(this.entity);)z.push(p);if(z.length>0)return new e.Expression(z)},
property:function(){var p;if(p=d(/(\*?-?[-a-z_0-9]+)\s*:/g))return p[1]}}}};g.Parser.importer=null;e.functions={rgb:function(b,d,k){return this.rgba(b,d,k,1)},rgba:function(b,d,k,h){b=[b,d,k].map(function(i){return v(i)});h=v(h);return new e.Color(b,h)},hsl:function(b,d,k){return this.hsla(b,d,k,1)},hsla:function(b,d,k,h){function i(o){o=o<0?o+1:o>1?o-1:o;return o*6<1?m+(j-m)*o*6:o*2<1?j:o*3<2?m+(j-m)*(2/3-o)*6:m}b=(v(b)%360+360)%360/360;d=v(d);k=v(k);h=v(h);var j=k<=0.5?k*(d+1):k+d-k*d,m=k*2-j;return this.rgba(i(b+
1/3)*255,i(b)*255,i(b-1/3)*255,h)},opacity:function(b,d){v(d);return new e.Color(b.rgb,v(d))},saturate:function(b,d){b=b.toHSL();b.s+=d.value/100;b.s=s(b.s);return this.hsl(b.h,b.s,b.l)},desaturate:function(b,d){b=b.toHSL();b.s-=d.value/100;b.s=s(b.s);return this.hsl(b.h,b.s,b.l)},lighten:function(b,d){b=b.toHSL();b.l*=1+d.value/100;b.l=s(b.l);return this.hsl(b.h,b.s,b.l)},darken:function(b,d){b=b.toHSL();b.l*=1-d.value/100;b.l=s(b.l);return this.hsl(b.h,b.s,b.l)},greyscale:function(b){return this.desaturate(b,
new e.Dimension(100))},e:function(b){return new e.Anonymous(b)},"%":function(b){for(var d=Array.prototype.slice.call(arguments,1),k=b.content,h=0;h<d.length;h++)k=k.replace(/%s/,d[h].content).replace(/%[da]/,d[h].toCSS());k=k.replace(/%%/g,"%");return new e.Quoted('"'+k+'"',k)}};e.Alpha=function(b){this.value=b};e.Alpha.prototype={toCSS:function(){return"alpha(opacity="+this.value.toCSS()+")"},eval:function(){return this}};e.Anonymous=function(b){this.value=b.content||b};e.Anonymous.prototype={toCSS:function(){return this.value},
eval:function(){return this}};e.Call=function(b,d){this.name=b;this.args=d};e.Call.prototype={eval:function(b){var d=this.args.map(function(k){return k.eval(b)});return this.name in e.functions?e.functions[this.name].apply(e.functions,d):new e.Anonymous(this.name+"("+d.map(function(k){return k.toCSS()}).join(", ")+")")},toCSS:function(b){return this.eval(b).toCSS()}};e.Color=function(b,d){if(Array.isArray(b)){this.rgb=b;this.alpha=d}else this.rgb=b.length==6?b.match(/.{2}/g).map(function(k){return parseInt(k,
16)}):b.split("").map(function(k){return parseInt(k+k,16)})};e.Color.prototype={eval:function(){return this},toCSS:function(){return this.alpha&&this.alpha<1?"rgba("+this.rgb.concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(b){b=Math.round(b);b=(b>255?255:b<0?0:b).toString(16);return b.length===1?"0"+b:b}).join("")},operate:function(b,d){var k=[];d instanceof e.Color||(d=d.toColor());for(var h=0;h<3;h++)k[h]=e.operate(b,this.rgb[h],d.rgb[h]);return new e.Color(k)},toHSL:function(){var b=
this.rgb[0]/255,d=this.rgb[1]/255,k=this.rgb[2]/255,h=Math.max(b,d,k),i=Math.min(b,d,k),j,m=(h+i)/2,o=h-i;if(h===i)j=i=0;else{i=m>0.5?o/(2-h-i):o/(h+i);switch(h){case b:j=(d-k)/o+(d<k?6:0);break;case d:j=(k-b)/o+2;break;case k:j=(b-d)/o+4;break}j/=6}return{h:j*360,s:i,l:m}}};e.Comment=function(b){this.value=b};e.Comment.prototype={toCSS:function(){return this.value}};e.Dimension=function(b,d){this.value=parseFloat(b);this.unit=d||null};e.Dimension.prototype={eval:function(){return this},toColor:function(){return new e.Color([this.value,
this.value,this.value])},toCSS:function(){return this.value+this.unit},operate:function(b,d){return new e.Dimension(e.operate(b,this.value,d.value),this.unit||d.unit)}};e.Directive=function(b,d){this.name=b;if(Array.isArray(d))this.ruleset=new e.Ruleset([],d);else this.value=d};e.Directive.prototype={toCSS:function(b,d){if(this.ruleset){this.ruleset.root=true;return this.name+" {\n  "+this.ruleset.toCSS(b,d).trim().replace(/\n/g,"\n  ")+"\n}\n"}else return this.name+" "+this.value.toCSS()+";\n"},
eval:function(b){b.frames.unshift(this);this.ruleset&&this.ruleset.evalRules(b);b.frames.shift();return this},variable:function(b){return e.Ruleset.prototype.variable.call(this.ruleset,b)},find:function(){return e.Ruleset.prototype.find.apply(this.ruleset,arguments)},rulesets:function(){return e.Ruleset.prototype.rulesets.apply(this.ruleset)}};e.Element=function(b,d){this.combinator=b instanceof e.Combinator?b:new e.Combinator(b);this.value=d.trim()};e.Element.prototype.toCSS=function(){return this.combinator.toCSS()+
this.value};e.Combinator=function(b){this.value=b===" "?" ":b?b.trim():""};e.Combinator.prototype.toCSS=function(){switch(this.value){case "":return"";case " ":return" ";case "&":return"";case ":":return" :";case "::":return"::";case "+":return" + ";case "~":return" ~ ";case ">":return" > "}};e.Expression=function(b){this.value=b};e.Expression.prototype={eval:function(b){return this.value.length>1?new e.Expression(this.value.map(function(d){return d.eval(b)})):this.value[0].eval(b)},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(" ")}};
e.Import=function(b,d){var k=this;this._path=b;this.path=b instanceof e.Quoted?/\.(le?|c)ss$/.test(b.content)?b.content:b.content+".less":b.value.content||b.value;(this.css=/css$/.test(this.path))||d.push(this.path,function(h){k.root=h})};e.Import.prototype={toCSS:function(){return this.css?"@import "+this._path.toCSS()+";\n":""},eval:function(){if(this.css)return this;else{for(var b=0;b<this.root.rules.length;b++)this.root.rules[b]instanceof e.Import&&Array.prototype.splice.apply(this.root.rules,
[b,1].concat(this.root.rules[b].eval()));return this.root.rules}}};e.Keyword=function(b){this.value=b};e.Keyword.prototype={eval:function(){return this},toCSS:function(){return this.value}};e.mixin={};e.mixin.Call=function(b,d,k){this.selector=new e.Selector(b);this.arguments=d;this.index=k};e.mixin.Call.prototype={eval:function(b){for(var d,k=[],h=false,i=0;i<b.frames.length;i++)if((d=b.frames[i].find(this.selector)).length>0){for(i=0;i<d.length;i++)if(d[i].match(this.arguments,b))try{Array.prototype.push.apply(k,
d[i].eval(this.arguments,b).rules);h=true}catch(j){throw{message:j.message,index:this.index};}if(h)return k;else throw{message:"No matching definition was found for `"+this.selector.toCSS().trim()+"("+this.arguments.map(function(m){return m.toCSS()}).join(", ")+")`",index:this.index};}throw{message:this.selector.toCSS().trim()+" is undefined",index:this.index};}};e.mixin.Definition=function(b,d,k){this.name=b;this.selectors=[new e.Selector([new e.Element(null,b)])];this.params=d;this.arity=d.length;
this.rules=k;this._lookups={};this.required=d.reduce(function(h,i){return i.name&&!i.value?h+1:h},0)};e.mixin.Definition.prototype={toCSS:function(){return""},variable:function(b){return e.Ruleset.prototype.variable.call(this,b)},find:function(){return e.Ruleset.prototype.find.apply(this,arguments)},rulesets:function(){return e.Ruleset.prototype.rulesets.apply(this)},eval:function(b,d){for(var k=new e.Ruleset(null,[]),h=0,i;h<this.params.length;h++)if(this.params[h].name)if(i=b&&b[h]||this.params[h].value)k.rules.unshift(new e.Rule(this.params[h].name,
i.eval(d)));else throw{message:"wrong number of arguments for "+this.name+" ("+b.length+" for "+this.arity+")"};return(new e.Ruleset(null,this.rules)).evalRules({frames:[this,k].concat(d.frames)})},match:function(b,d){var k=b&&b.length||0;if(k<this.required)return false;for(var h=0;h<Math.min(k,this.arity);h++)if(!this.params[h].name)if(!b[h].wildcard)if(b[h].eval(d).toCSS()!=this.params[h].value.eval(d).toCSS())return false;return true}};e.Operation=function(b,d){this.op=b.trim();this.operands=d};
e.Operation.prototype.eval=function(b){var d=this.operands[0].eval(b);b=this.operands[1].eval(b);var k;if(d instanceof e.Dimension&&b instanceof e.Color)if(this.op==="*"||this.op==="+"){k=b;b=d;d=k}else throw{name:"OperationError",message:"Can't substract or divide a color from a number"};return d.operate(this.op,b)};e.operate=function(b,d,k){switch(b){case "+":return d+k;case "-":return d-k;case "*":return d*k;case "/":return d/k}};e.Quoted=function(b,d){this.value=b;this.content=d};e.Quoted.prototype=
{toCSS:function(){return this.value},eval:function(){return this}};e.Rule=function(b,d,k){this.name=b;this.value=d instanceof e.Value?d:new e.Value([d]);this.index=k;this.variable=b.charAt(0)==="@"?true:false};e.Rule.prototype.toCSS=function(){return this.variable?"":this.name+": "+this.value.toCSS()+";"};e.Rule.prototype.eval=function(b){return new e.Rule(this.name,this.value.eval(b))};e.Value=function(b){this.value=b;this.is="value"};e.Value.prototype={eval:function(b){return this.value.length===
1?this.value[0].eval(b):new e.Value(this.value.map(function(d){return d.eval(b)}))},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(", ")}};e.Shorthand=function(b,d){this.a=b;this.b=d};e.Shorthand.prototype={toCSS:function(b){return this.a.toCSS(b)+"/"+this.b.toCSS(b)},eval:function(){return this}};e.Ruleset=function(b,d){this.selectors=b;this.rules=d;this._lookups={}};e.Ruleset.prototype={eval:function(){return this},evalRules:function(b){var d=[];this.rules.forEach(function(k){if(k.evalRules)d.push(k.evalRules(b));
else k instanceof e.mixin.Call?Array.prototype.push.apply(d,k.eval(b)):d.push(k.eval(b))});this.rules=d;return this},match:function(b){return!b||b.length===0},variable:function(b){return this._variables?this._variables[b]:(this._variables=this.rules.reduce(function(d,k){if(k instanceof e.Rule&&k.variable===true)d[k.name]=k;return d},{}))[b]},rulesets:function(){return this._rulesets?this._rulesets:(this._rulesets=this.rules.filter(function(b){if(b instanceof e.Ruleset||b instanceof e.mixin.Definition)return b}))},
find:function(b,d){d=d||this;var k=[],h=b.toCSS();if(h in this._lookups)return this._lookups[h];this.rulesets().forEach(function(i){if(i!==d)for(var j=0;j<i.selectors.length;j++)if(b.match(i.selectors[j])){b.elements.length>1?Array.prototype.push.apply(k,i.find(new e.Selector(b.elements.slice(1)),d)):k.push(i);break}});return this._lookups[h]=k},toCSS:function(b,d){var k=[],h=[],i=[],j=[];if(this.root){b=[];d={frames:[]};for(var m=0;m<this.rules.length;m++)this.rules[m]instanceof e.Import&&Array.prototype.splice.apply(this.rules,
[m,1].concat(this.rules[m].eval(d)))}else if(b.length===0)j=this.selectors.map(function(x){return[x]});else for(m=0;m<this.selectors.length;m++)for(var o=0;o<b.length;o++)j.push(b[o].concat([this.selectors[m]]));d.frames.unshift(this);for(m=0;m<this.rules.length;m++)this.rules[m]instanceof e.mixin.Call&&Array.prototype.splice.apply(this.rules,[m,1].concat(this.rules[m].eval(d)));for(m=0;m<this.rules.length;m++){b=this.rules[m];if(b instanceof e.Directive)i.push(b.eval(d).toCSS(j,d));else if(b.rules)i.push(b.toCSS(j,
d));else if(b instanceof e.Comment)this.root?i.push(b.toCSS()):h.push(b.toCSS());else if(b.toCSS&&!b.variable)h.push(b.eval(d).toCSS());else b.value&&!b.variable&&h.push(b.value.toString())}i=i.join("");if(this.root)k.push(h.join("\n"));else if(h.length>0){j=j.map(function(x){return x.map(function(u){return u.toCSS()}).join("").trim()}).join(j.length>3?",\n":", ");k.push(j," {\n  "+h.join("\n  ")+"\n}\n")}k.push(i);d.frames.shift();return k.join("")}};e.Selector=function(b){this.elements=b;if(this.elements[0].combinator.value===
"")this.elements[0].combinator.value=" "};e.Selector.prototype.match=function(b){return this.elements[0].value===b.elements[0].value?true:false};e.Selector.prototype.toCSS=function(){if(this._css)return this._css;return this._css=this.elements.map(function(b){return typeof b==="string"?" "+b.trim():b.toCSS()}).join("")};e.URL=function(b){this.value=b};e.URL.prototype={toCSS:function(){return"url("+this.value.toCSS()+")"},eval:function(){return this}};e.Variable=function(b,d){this.name=b;this.index=
d};e.Variable.prototype={eval:function(b){var d,k,h=this.name;if(d=e.find(b.frames,function(i){if(k=i.variable(h))return k.value.eval(b)}))return d;else throw{message:"variable "+this.name+" is undefined",index:this.index};}};e.find=function(b,d){for(var k=0,h;k<b.length;k++)if(h=d.call(b,b[k]))return h;return null};(function(){function b(u){for(var f=0;f<o.length;f++)d(o[f],u)}function d(u,f){var A=typeof localStorage!=="undefined"&&localStorage.getItem(u.href),F=A&&JSON.parse(A);h(u.href,function(p,
z){if(F&&(new Date(z)).valueOf()===(new Date(F.timestamp)).valueOf()){k(F.css,u);f(null,u,{local:true})}else(new g.Parser({optimization:3})).parse(p,function(E,G){if(E)return m(E,u.href);try{f(G,u,{local:false,lastModified:z})}catch(N){m(N,u.href)}})},function(p){throw new Error("Couldn't load "+u.href+" ("+p+")");})}function k(u,f,A){var F=document.createElement("style");F.type="text/css";F.media="screen";F.title="less-sheet";if(f){F.title=f.title||f.href.match(/(?:^|\/)([-\w]+)\.[a-z]+$/i)[1];A&&
typeof localStorage!=="undefined"&&localStorage.setItem(f.href,JSON.stringify({timestamp:A,css:u}))}if(F.styleSheet)F.styleSheet.cssText=u;else F.appendChild(document.createTextNode(u));document.getElementsByTagName("head")[0].appendChild(F)}function h(u,f,A){var F=i();if(window.location.protocol==="file:"){F.open("GET",u,false);F.send(null);F.status===0?f(F.responseText):A(F.status)}else{F.open("GET",u,true);F.onreadystatechange=function(){if(F.readyState==4)if(F.status>=200&&F.status<300)f(F.responseText,
F.getResponseHeader("Last-Modified"));else typeof A==="function"&&A(F.status)};F.send(null)}}function i(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(u){j("less: browser doesn't support AJAX.");return null}}function j(u){g.env=="development"&&typeof console!=="undefined"&&console.log(u)}function m(u,f){var A=document.createElement("div"),F;A.id="less-error-message";A.innerHTML="<h3>"+(u.message||"There is an error in your .less file")+
'</h3><p><a href="'+f+'">'+f+"</a> on line "+u.line+", column "+(u.column+1)+":</p>"+'<div>\n<pre class="ctx"><span>[-1]</span>{0}</pre>\n<pre><span>[0]</span>{current}</pre>\n<pre class="ctx"><span>[1]</span>{2}</pre>\n</div>'.replace(/\[(-?\d)\]/g,function(p,z){return u.line+parseInt(z)}).replace(/\{(\d)\}/g,function(p,z){return u.extract[parseInt(z)]}).replace(/\{current\}/,u.extract[1].slice(0,u.column)+'<span class="error">'+u.extract[1].slice(u.column)+"</span>");k("#less-error-message span {margin-right: 15px;}#less-error-message pre {color: #ee4444;padding: 4px 0;margin: 0;}#less-error-message pre.ctx {color: #dd7777;}#less-error-message h3 {padding: 15px 0 5px 0;margin: 0;}#less-error-message a {color: #10a}#less-error-message .error {color: red;font-weight: bold;padding-bottom: 2px;border-bottom: 1px dashed red;}");
A.style.cssText="font-family: Arial, sans-serif;border: 1px solid #e00;background-color: #eee;border-radius: 5px;color: #e00;padding: 15px;margin-bottom: 15px";if(g.env=="development")F=setInterval(function(){if(document.body){document.body.insertBefore(A,document.body.childNodes[0]);clearInterval(F)}},10)}var o=[];g.env=location.hostname=="127.0.0.1"||location.hostname=="0.0.0.0"||location.hostname=="localhost"||location.protocol=="file:"?"development":"production";var x=setInterval(function(){if(document.body){if(!document.querySelectorAll&&
typeof jQuery==="undefined")j("No selector method found");else o=(document.querySelectorAll||jQuery).call(document,'link[rel="stylesheet/less"]');clearInterval(x);b(function(u,f,A){k(u.toCSS(),f,A.lastModified);A.local?j("less: loading "+f.href+" from local storage."):j("less: parsed "+f.href+" successfully.")})}},10);if(g.env==="development")refreshTimer=setInterval(function(){/!refresh/.test(location.hash)&&b(function(u,f,A){k(u.toCSS(),f,A)})},1E3);g.Parser.importer=function(u,f,A){d({href:u,title:u},
function(F){A(F)})}})()});bespin.tiki.register("::theme_manager_base",{name:"theme_manager_base",dependencies:{}});bespin.tiki.module("theme_manager_base:index",function(){});bespin.tiki.register("::canon",{name:"canon",dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("canon:request",function(y,t){var v=y("events").Event,s=y("canon:history");t.Request=function(g){g=g||{};this.command=g.command;this.commandExt=g.commandExt;this.args=g.args;this.typed=g.typed;this._begunOutput=false;this.start=new Date;this.end=null;this.error=this.completed=false;this.changed=new v};t.Request.prototype._beginOutput=function(){this._begunOutput=true;this.outputs=[];s.addRequestOutput(this)};t.Request.prototype.doneWithError=function(g){this.error=true;this.done(g)};
t.Request.prototype.async=function(){this._begunOutput||this._beginOutput()};t.Request.prototype.output=function(g){this._begunOutput||this._beginOutput();if(typeof g!=="string"&&!(g instanceof Node))g=g.toString();this.outputs.push(g);this.changed();return this};t.Request.prototype.done=function(g){this.completed=true;this.end=new Date;this.duration=this.end.getTime()-this.start.getTime();g?this.output(g):this.changed()}});
bespin.tiki.module("canon:history",function(y,t){var v=y("bespin:util/stacktrace").Trace,s=y("bespin:plugins").catalog,g=y("bespin:console").console;t.requests=[];t.addRequestOutput=function(e){for(t.requests.push(e);t.requests.length>100;)t.requests.shiftObject();s.publish(this,"addedRequestOutput",null,e)};t.execute=function(e,b){if(b.command)try{b.command(e,b)}catch(d){var k=new v(d,true);g.group("Error executing command '"+b.typed+"'");g.log("command=",b.commandExt);g.log("args=",e);g.error(d);
k.log(3);g.groupEnd();b.doneWithError(d)}else b.doneWithError("Command not found.")}});bespin.tiki.module("canon:index",function(){});bespin.tiki.register("::traits",{name:"traits",dependencies:{}});
bespin.tiki.module("traits:index",function(y,t){y=function(){function v(){try{if(Object.getOwnPropertyDescriptor)return!!Object.getOwnPropertyDescriptor({x:0},"x")}catch(M){}return false}function s(){try{if(Object.defineProperty){var M={};Object.defineProperty(M,"x",{value:0});return M.x===0}}catch(Q){}return false}function g(M){var Q=function(){throw new Error("Conflicting property: "+M);};Y(Q.prototype);return Y(Q)}function e(){return Y({value:undefined,enumerable:false,required:true})}function b(M){M=
g(M);return E?Y({get:M,set:M,enumerable:false,conflict:true}):Y({value:M,enumerable:false,conflict:true})}function d(M,Q){return M===Q?M!==0||1/M===1/Q:M!==M&&Q!==Q}function k(M,Q){return M.conflict&&Q.conflict?true:M.get===Q.get&&M.set===Q.set&&d(M.value,Q.value)&&M.enumerable===Q.enumerable&&M.required===Q.required&&M.conflict===Q.conflict}function h(M,Q){return Y(N(M,Q))}function i(M){var Q={};ea(M,function(S){Q[S]=true});return Y(Q)}function j(M){var Q={};ea(da(M),function(S){var T=ia(M,S);if(T.value===
ta)T=e(S);else if(typeof T.value==="function"){T.method=true;"prototype"in T.value&&Y(T.value.prototype)}else{T.get&&T.get.prototype&&Y(T.get.prototype);T.set&&T.set.prototype&&Y(T.set.prototype)}Q[S]=T});return Q}function m(){var M=$(arguments,0),Q={};ea(M,function(S){ea(da(S),function(T){var aa=S[T];if(W(Q,T)&&!Q[T].required)aa.required||k(Q[T],aa)||(Q[T]=b(T));else Q[T]=aa})});return Y(Q)}function o(M,Q){var S=i(M),T={};ea(da(Q),function(aa){T[aa]=!W(S,aa)||Q[aa].required?Q[aa]:e(aa)});return Y(T)}
function x(){var M=$(arguments,0),Q={};ea(M,function(S){ea(da(S),function(T){var aa=S[T];if(!W(Q,T)||Q[T].required)Q[T]=aa})});return Y(Q)}function u(M,Q){var S={};ea(da(Q),function(T){if(W(M,T)&&!Q[T].required){var aa=M[T];S[aa]=W(S,aa)&&!S[aa].required?b(aa):Q[T];W(S,T)||(S[T]=e(T))}else if(W(S,T))Q[T].required||(S[T]=b(T));else S[T]=Q[T]});return Y(S)}function f(M,Q){var S={},T=[];for(var aa in M)if(W(M,aa))if(M[aa])S[aa]=M[aa];else T.push(aa);return u(S,o(T,Q))}function A(M,Q){var S=oa(M),T={};
ea(da(Q),function(aa){var ha=Q[aa];if(ha.required){if(!(aa in M))throw new Error("Missing required property: "+aa);}else if(ha.conflict)throw new Error("Remaining conflicting property: "+aa);else T[aa]="value"in ha?ha.method?{value:h(ha.value,S),enumerable:ha.enumerable,configurable:ha.configurable,writable:ha.writable}:ha:{get:ha.get?h(ha.get,S):undefined,set:ha.set?h(ha.set,S):undefined,enumerable:ha.enumerable,configurable:ha.configurable,writable:ha.writable}});na(S,T);return Y(S)}function F(M,
Q){return A(Object.prototype,j(M),Q)}function p(M,Q){var S=da(M),T=da(Q);if(S.length!==T.length)return false;for(var aa=0;aa<S.length;aa++){T=S[aa];if(!Q[T]||!k(M[T],Q[T]))return false}return true}function z(M){return j(M)}var E=function(){try{var M={};Object.defineProperty(M,"x",{get:function(){return 0}});return M.x===0}catch(Q){return false}}(),G=Function.prototype.call,N=Function.prototype.bind?function(M,Q){return Function.prototype.bind.call(M,Q)}:function(M,Q){function S(){return M.apply(Q,
arguments)}return S},W=N(G,Object.prototype.hasOwnProperty),$=N(G,Array.prototype.slice),ea=Array.prototype.forEach?N(G,Array.prototype.forEach):function(M,Q){for(var S=0,T=M.length;S<T;S++)Q(M[S])},Y=Object.freeze?function(M){Object.freeze(M);return M}:function(M){return M},da=Object.getOwnPropertyNames||function(M){var Q=[];for(var S in M)W(M,S)&&Q.push(S);return Q},ia=v()?Object.getOwnPropertyDescriptor:function(M,Q){return{value:M[Q],enumerable:true,writable:true,configurable:true}},ma=s()?Object.defineProperty:
function(M,Q,S){M[Q]=S.value},na=Object.defineProperties||function(M,Q){for(var S in Q)W(Q,S)&&ma(M,S,Q[S])},oa=Object.create||function(M,Q){function S(){}S.prototype=M||Object.prototype;M=new S;Q&&na(M,Q);return M};G=Object.getOwnProperties||function(M){var Q={};ea(da(M),function(S){Q[S]=ia(M,S)});return Q};var ta=Y({toString:function(){return"<Trait.required>"}});if(!Object.create)Object.create=oa;if(!Object.getOwnProperties)Object.getOwnProperties=G;z.required=Y(ta);z.compose=Y(m);z.resolve=Y(f);
z.override=Y(x);z.create=Y(A);z.eqv=Y(p);z.object=Y(F);return Y(z)}();if(typeof t!=="undefined")t.Trait=y});bespin.tiki.register("::keyboard",{name:"keyboard",dependencies:{canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("keyboard:keyutil",function(y,t){var v=y("bespin:util/util");t.KeyHelper=function(){var g={MODIFIER_KEYS:{16:"shift",17:"ctrl",18:"alt",224:"meta"},FUNCTION_KEYS:{8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},PRINTABLE_KEYS:{32:" ",
48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},PRINTABLE_KEYS_CHARCODE:{},KEY:{}};for(var e in g.PRINTABLE_KEYS){var b=g.PRINTABLE_KEYS[e];g.PRINTABLE_KEYS_CHARCODE[b.charCodeAt(0)]=e;if(b.toUpperCase()!=
b)g.PRINTABLE_KEYS_CHARCODE[b.toUpperCase().charCodeAt(0)]=e}for(e in g.FUNCTION_KEYS){b=g.FUNCTION_KEYS[e].toUpperCase();g.KEY[b]=parseInt(e,10)}return g}();var s=function(g){return!!(g.altKey||g.ctrlKey||g.metaKey||g.charCode!==g.which&&t.KeyHelper.FUNCTION_KEYS[g.which])};t.commandCodes=function(g,e){var b=g._keyCode||g.keyCode,d=g._charCode===undefined?g.charCode:g._charCode,k=null,h=null,i="",j=true;if(b===0&&g.which===0)return false;if(d!==0)return false;if(t.KeyHelper.MODIFIER_KEYS[d])return[t.KeyHelper.MODIFIER_KEYS[d],
null];if(b){k=t.KeyHelper.FUNCTION_KEYS[b];if(!k&&(g.altKey||g.ctrlKey||g.metaKey)){k=t.KeyHelper.PRINTABLE_KEYS[b];if(b>47&&b<58)j=g.altKey}if(k){if(g.altKey)i+="alt_";if(g.ctrlKey)i+="ctrl_";if(g.metaKey)i+="meta_"}else if(g.ctrlKey||g.metaKey)return false}if(!k){b=g.which;h=k=String.fromCharCode(b);b=k.toLowerCase();if(g.metaKey){i="meta_";k=b}else k=null}if(g.shiftKey&&k&&j)i+="shift_";if(k)k=i+k;if(!e&&k)k=k.replace(/ctrl_meta|meta/,"ctrl");return[k,h]};t.addKeyDownListener=function(g,e){var b=
function(d){var k=e(d);k&&v.stopEvent(d);return k};g.addEventListener("keydown",function(d){if(v.isMozilla)if(t.KeyHelper.FUNCTION_KEYS[d.keyCode])return true;else if((d.ctrlKey||d.metaKey)&&t.KeyHelper.PRINTABLE_KEYS[d.keyCode])return true;if(s(d))return b(d);return true},false);g.addEventListener("keypress",function(d){if(v.isMozilla)if(t.KeyHelper.FUNCTION_KEYS[d.keyCode])return b(d);else if((d.ctrlKey||d.metaKey)&&t.KeyHelper.PRINTABLE_KEYS_CHARCODE[d.charCode]){d._keyCode=t.KeyHelper.PRINTABLE_KEYS_CHARCODE[d.charCode];
d._charCode=0;return b(d)}if(d.charCode!==undefined&&d.charCode===0)return true;return b(d)},false)}});
bespin.tiki.module("keyboard:keyboard",function(y,t){var v=y("bespin:plugins").catalog;y("bespin:console");y("bespin:util/stacktrace");var s=y("bespin:util/util"),g=y("settings").settings,e=y("keyboard:keyutil"),b=y("canon:history"),d=y("canon:request").Request,k=y("environment").env;t.buildFlags=function(h){h.context=k.contexts[0];return h};y=function(){};s.mixin(y.prototype,{_customKeymappingCache:{states:{}},processKeyEvent:function(h,i,j){h=e.commandCodes(h,true)[0];if(s.none(h))return false;
t.buildFlags(j);j.isCommandKey=true;return this._matchCommand(h,i,j)},_matchCommand:function(h,i,j){var m=this._findCommandExtension(h,i,j);if(m&&m.commandExt!=="no command"){j.isTextView&&i.resetKeyBuffers();var o=m.commandExt;o.load(function(x){x=new d({command:x,commandExt:o});b.execute(m.args,x)});return true}return m&&m.commandExt==="no command"?true:false},_buildBindingsRegex:function(h){h.forEach(function(i){if(s.none(i.key))if(Array.isArray(i.regex)){i.key=new RegExp("^"+i.regex[1]+"$");i.regex=
new RegExp(i.regex.join("")+"$")}else i.regex=new RegExp(i.regex+"$");else i.key=new RegExp("^"+i.key+"$")})},_buildKeymappingRegex:function(h){for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true},_findCommandExtension:function(h,i,j){if(j.isTextView){var m=i._keyState;if(!j.isCommandKey||h.indexOf("alt_")===-1){i._keyBuffer+=h.replace(/ctrl_meta|meta/,"ctrl");i._keyMetaBuffer+=h}var o=[this._customKeymappingCache];o=o.concat(v.getExtensions("keymapping"));for(var x=
0;x<o.length;x++)if(!s.none(o[x].states[m])){s.none(o[x]._convertedRegExp)&&this._buildKeymappingRegex(o[x]);var u=this._bindingsMatch(h,j,i,o[x]);if(!s.none(u))return u}}i=v.getExtensions("command");var f=null;m={};h=h.replace(/ctrl_meta|meta/,"ctrl");i.some(function(A){if(this._commandMatches(A,h,j)){f=A;return true}return false}.bind(this));return s.none(f)?null:{commandExt:f,args:m}},_bindingsMatch:function(h,i,j,m){var o,x=null,u={},f;f=s.none(m.hasMetaKey)?j._keyMetaBuffer:j._keyBuffer;if(h.indexOf("alt_")===
0&&i.isCommandKey)f+=h;m.states[j._keyState].some(function(A){if(A.key&&!A.key.test(h))return false;if(A.regex&&!(o=A.regex.exec(f)))return false;if(A.disallowMatches)for(var F=0;F<A.disallowMatches.length;F++)if(o[A.disallowMatches[F]])return true;if(!t.flagsMatch(A.predicates,i))return false;if(A.exec){x=v.getExtensionByKey("command",A.exec);if(s.none(x))throw new Error("Can't find command "+A.exec+" in state="+j._keyState+", symbolicName="+h);if(A.params){var p;A.params.forEach(function(z){p=!s.none(z.match)&&
!s.none(o)?o[z.match]||z.defaultValue:z.defaultValue;if(z.type==="number")p=parseInt(p);u[z.name]=p})}j.resetKeyBuffers()}if(A.then){j._keyState=A.then;j.resetKeyBuffers()}if(s.none(x))x="no command";return true});if(s.none(x))return null;return{commandExt:x,args:u}},_commandMatches:function(h,i,j){var m=h.key;if(!m)return false;if(!t.flagsMatch(h.predicates,j))return false;if(typeof m==="string"){if(m!=i)return false;return true}if(!Array.isArray(m)){m=[m];h.key=m}for(h=0;h<m.length;h++){var o=m[h];
if(typeof o==="string"){if(o==i)return true}else if(o.key==i)return t.flagsMatch(o.predicates,j)}return false},_customKeymappingChanged:function(){var h=this._customKeymappingCache=JSON.parse(g.get("customKeymapping"));h.states=h.states||{};for(state in h.states)this._buildBindingsRegex(h.states[state]);h._convertedRegExp=true}});t.flagsMatch=function(h,i){if(s.none(h))return true;if(!i)return false;for(var j in h)if(i[j]!==h[j])return false;return true};t.keyboardManager=new y;v.registerExtension("settingChange",
{match:"customKeymapping",pointer:t.keyboardManager._customKeymappingChanged.bind(t.keyboardManager)})});bespin.tiki.module("keyboard:index",function(){});bespin.tiki.register("::worker_manager",{name:"worker_manager",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("worker_manager:index",function(y,t){function v(i){var j=/^([^#:]+)(?::([^#:]+))?#([^#:]+)$/.exec(i);if(j==null)throw new Error('WorkerSupervisor: invalid pointer specification: "'+i+'"');i=j[1];var m=j[3];j=i+":"+(j[2]!=null?j[2]:"index");var o=bespin!=null&&bespin.base!=null?bespin.base:"";this._packageId=i;this._moduleId=j;this._base=o;this._target=m;this._worker=null;this._currentId=0;this.started=new d}function s(){h.restartAll()}if(window==null)throw new Error('The "worker_manager" plugin can only be loaded in the browser, not a web worker. Use "worker" instead.');
var g=y("bespin:proxy");y("bespin:plugins");var e=y("bespin:console").console,b=y("underscore")._,d=y("events").Event,k=y("bespin:promise").Promise;y("environment");var h={_workers:[],add:function(i){this._workers.push(i)},remove:function(i){this._workers=b(this._workers).without(i)},restartAll:function(){var i=this._workers;b(i).invoke("kill");b(i).invoke("start")}};v.prototype={_onError:function(i){this._worker=null;h.remove(this);e.error("WorkerSupervisor: worker failed at file "+i.filename+":"+
i.lineno+"; fix the worker and use 'worker restart' to restart it")},_onMessage:function(i){i=JSON.parse(i.data);switch(i.op){case "finish":if(i.id===this._currentId){var j=this._promise;this._promise=null;j.resolve(i.result)}break;case "log":e[i.method].apply(e,i.args);break}},_promise:null,started:null,kill:function(){var i=this._promise;if(i!=null){i.reject("killed");this._promise=null}this._worker.terminate();this._worker=null;h.remove(this)},send:function(i,j){var m=this._promise;if(m!=null){m.reject("interrupted");
this._currentId++}m=this._currentId;var o=new k;this._promise=o;this._worker.postMessage(JSON.stringify({op:"invoke",id:m,method:i,args:j}));return o},start:function(){if(this._worker!=null)throw new Error("WorkerSupervisor: worker already started");var i=this._base,j=this._target,m=this._packageId,o=this._moduleId,x=new g.Worker(i+"BespinEmbedded.js");x.onmessage=this._onMessage.bind(this);x.onerror=this._onError.bind(this);x.postMessage(JSON.stringify({op:"load",base:i,pkg:m,module:o,target:j}));
this._worker=x;this._currentId=0;h.add(this);this.started()}};t.WorkerSupervisor=v;t.workerManager=h;t.workerRestartCommand=s});bespin.tiki.register("::diff",{name:"diff",dependencies:{}});
bespin.tiki.module("diff:index",function(y,t){function v(){function g(){for(var e=0,b=1,d=2;b!=d;){e++;b=d;d<<=1}return e}this.Diff_Timeout=1;this.Diff_EditCost=4;this.Diff_DualThreshold=32;this.Match_Threshold=0.5;this.Match_Distance=1E3;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=g()}function s(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0}v.prototype.diff_main=function(g,e,b){if(g==e)return[[0,g]];if(typeof b=="undefined")b=true;var d=b,k=this.diff_commonPrefix(g,
e);b=g.substring(0,k);g=g.substring(k);e=e.substring(k);k=this.diff_commonSuffix(g,e);var h=g.substring(g.length-k);g=g.substring(0,g.length-k);e=e.substring(0,e.length-k);g=this.diff_compute(g,e,d);b&&g.unshift([0,b]);h&&g.push([0,h]);this.diff_cleanupMerge(g);return g};v.prototype.diff_compute=function(g,e,b){var d;if(!g)return[[1,e]];if(!e)return[[-1,g]];d=g.length>e.length?g:e;var k=g.length>e.length?e:g,h=d.indexOf(k);if(h!=-1){d=[[1,d.substring(0,h)],[0,k],[1,d.substring(h+k.length)]];if(g.length>
e.length)d[0][0]=d[2][0]=-1;return d}if(d=this.diff_halfMatch(g,e)){e=d[1];var i=d[3];g=d[4];d=this.diff_main(d[0],d[2],b);b=this.diff_main(e,i,b);return d.concat([[0,g]],b)}if(b&&(g.length<100||e.length<100))b=false;if(b){i=this.diff_linesToChars(g,e);g=i[0];e=i[1];i=i[2]}(d=this.diff_map(g,e))||(d=[[-1,g],[1,e]]);if(b){this.diff_charsToLines(d,i);this.diff_cleanupSemantic(d);d.push([0,""]);e=g=b=0;for(k=i="";b<d.length;){switch(d[b][0]){case 1:e++;k+=d[b][1];break;case -1:g++;i+=d[b][1];break;case 0:if(g>=
1&&e>=1){i=this.diff_main(i,k,false);d.splice(b-g-e,g+e);b=b-g-e;for(g=i.length-1;g>=0;g--)d.splice(b,0,i[g]);b+=i.length}g=e=0;k=i="";break}b++}d.pop()}return d};v.prototype.diff_linesToChars=function(g,e){function b(h){for(var i="",j=0,m=-1,o=d.length;m<h.length-1;){m=h.indexOf("\n",j);if(m==-1)m=h.length-1;var x=h.substring(j,m+1);j=m+1;if(k.hasOwnProperty?k.hasOwnProperty(x):k[x]!==undefined)i+=String.fromCharCode(k[x]);else{i+=String.fromCharCode(o);k[x]=o;d[o++]=x}}return i}var d=[],k={};d[0]=
"";g=b(g);e=b(e);return[g,e,d]};v.prototype.diff_charsToLines=function(g,e){for(var b=0;b<g.length;b++){for(var d=g[b][1],k=[],h=0;h<d.length;h++)k[h]=e[d.charCodeAt(h)];g[b][1]=k.join("")}};v.prototype.diff_map=function(g,e){var b=(new Date).getTime()+this.Diff_Timeout*1E3,d=g.length,k=e.length,h=d+k-1,i=this.Diff_DualThreshold*2<h,j=[],m=[],o={},x={};o[1]=0;x[1]=0;for(var u,f,A,F={},p=false,z=!!F.hasOwnProperty,E=(d+k)%2,G=0;G<h;G++){if(this.Diff_Timeout>0&&(new Date).getTime()>b)return null;j[G]=
{};for(var N=-G;N<=G;N+=2){u=N==-G||N!=G&&o[N-1]<o[N+1]?o[N+1]:o[N-1]+1;f=u-N;if(i){A=u+","+f;if(E&&(z?F.hasOwnProperty(A):F[A]!==undefined))p=true;E||(F[A]=G)}for(;!p&&u<d&&f<k&&g.charAt(u)==e.charAt(f);){u++;f++;if(i){A=u+","+f;if(E&&(z?F.hasOwnProperty(A):F[A]!==undefined))p=true;E||(F[A]=G)}}o[N]=u;j[G][u+","+f]=true;if(u==d&&f==k)return this.diff_path1(j,g,e);else if(p){m=m.slice(0,F[A]+1);b=this.diff_path1(j,g.substring(0,u),e.substring(0,f));return b.concat(this.diff_path2(m,g.substring(u),
e.substring(f)))}}if(i){m[G]={};for(N=-G;N<=G;N+=2){u=N==-G||N!=G&&x[N-1]<x[N+1]?x[N+1]:x[N-1]+1;f=u-N;A=d-u+","+(k-f);if(!E&&(z?F.hasOwnProperty(A):F[A]!==undefined))p=true;if(E)F[A]=G;for(;!p&&u<d&&f<k&&g.charAt(d-u-1)==e.charAt(k-f-1);){u++;f++;A=d-u+","+(k-f);if(!E&&(z?F.hasOwnProperty(A):F[A]!==undefined))p=true;if(E)F[A]=G}x[N]=u;m[G][u+","+f]=true;if(p){j=j.slice(0,F[A]+1);b=this.diff_path1(j,g.substring(0,d-u),e.substring(0,k-f));return b.concat(this.diff_path2(m,g.substring(d-u),e.substring(k-
f)))}}}}return null};v.prototype.diff_path1=function(g,e,b){for(var d=[],k=e.length,h=b.length,i=null,j=g.length-2;j>=0;j--)for(;;)if(g[j].hasOwnProperty?g[j].hasOwnProperty(k-1+","+h):g[j][k-1+","+h]!==undefined){k--;if(i===-1)d[0][1]=e.charAt(k)+d[0][1];else d.unshift([-1,e.charAt(k)]);i=-1;break}else if(g[j].hasOwnProperty?g[j].hasOwnProperty(k+","+(h-1)):g[j][k+","+(h-1)]!==undefined){h--;if(i===1)d[0][1]=b.charAt(h)+d[0][1];else d.unshift([1,b.charAt(h)]);i=1;break}else{k--;h--;if(i===0)d[0][1]=
e.charAt(k)+d[0][1];else d.unshift([0,e.charAt(k)]);i=0}return d};v.prototype.diff_path2=function(g,e,b){for(var d=[],k=0,h=e.length,i=b.length,j=null,m=g.length-2;m>=0;m--)for(;;)if(g[m].hasOwnProperty?g[m].hasOwnProperty(h-1+","+i):g[m][h-1+","+i]!==undefined){h--;if(j===-1)d[k-1][1]+=e.charAt(e.length-h-1);else d[k++]=[-1,e.charAt(e.length-h-1)];j=-1;break}else if(g[m].hasOwnProperty?g[m].hasOwnProperty(h+","+(i-1)):g[m][h+","+(i-1)]!==undefined){i--;if(j===1)d[k-1][1]+=b.charAt(b.length-i-1);
else d[k++]=[1,b.charAt(b.length-i-1)];j=1;break}else{h--;i--;if(j===0)d[k-1][1]+=e.charAt(e.length-h-1);else d[k++]=[0,e.charAt(e.length-h-1)];j=0}return d};v.prototype.diff_commonPrefix=function(g,e){if(!g||!e||g.charCodeAt(0)!==e.charCodeAt(0))return 0;for(var b=0,d=Math.min(g.length,e.length),k=d,h=0;b<k;){if(g.substring(h,k)==e.substring(h,k))h=b=k;else d=k;k=Math.floor((d-b)/2+b)}return k};v.prototype.diff_commonSuffix=function(g,e){if(!g||!e||g.charCodeAt(g.length-1)!==e.charCodeAt(e.length-
1))return 0;for(var b=0,d=Math.min(g.length,e.length),k=d,h=0;b<k;){if(g.substring(g.length-k,g.length-h)==e.substring(e.length-k,e.length-h))h=b=k;else d=k;k=Math.floor((d-b)/2+b)}return k};v.prototype.diff_halfMatch=function(g,e){function b(j,m,o){for(var x=j.substring(o,o+Math.floor(j.length/4)),u=-1,f="",A,F,p,z;(u=m.indexOf(x,u+1))!=-1;){var E=h.diff_commonPrefix(j.substring(o),m.substring(u)),G=h.diff_commonSuffix(j.substring(0,o),m.substring(0,u));if(f.length<G+E){f=m.substring(u-G,u)+m.substring(u,
u+E);A=j.substring(0,o-G);F=j.substring(o+E);p=m.substring(0,u-G);z=m.substring(u+E)}}return f.length>=j.length/2?[A,F,p,z,f]:null}var d=g.length>e.length?g:e,k=g.length>e.length?e:g;if(d.length<10||k.length<1)return null;var h=this,i=b(d,k,Math.ceil(d.length/4));d=b(d,k,Math.ceil(d.length/2));if(!i&&!d)return null;else i=d?i?i[4].length>d[4].length?i:d:d:i;if(g.length>e.length){g=i[0];e=i[1];d=i[2];k=i[3]}else{d=i[0];k=i[1];g=i[2];e=i[3]}return[g,e,d,k,i[4]]};v.prototype.diff_cleanupSemantic=function(g){for(var e=
false,b=[],d=0,k=null,h=0,i=0,j=0;h<g.length;){if(g[h][0]==0){b[d++]=h;i=j;j=0;k=g[h][1]}else{j+=g[h][1].length;if(k!==null&&k.length<=i&&k.length<=j){g.splice(b[d-1],0,[-1,k]);g[b[d-1]+1][0]=1;d--;d--;h=d>0?b[d-1]:-1;j=i=0;k=null;e=true}}h++}e&&this.diff_cleanupMerge(g);this.diff_cleanupSemanticLossless(g)};v.prototype.diff_cleanupSemanticLossless=function(g){function e(z,E){if(!z||!E)return 5;var G=0;if(z.charAt(z.length-1).match(b)||E.charAt(0).match(b)){G++;if(z.charAt(z.length-1).match(d)||E.charAt(0).match(d)){G++;
if(z.charAt(z.length-1).match(k)||E.charAt(0).match(k)){G++;if(z.match(h)||E.match(i))G++}}}return G}for(var b=/[^a-zA-Z0-9]/,d=/\s/,k=/[\r\n]/,h=/\n\r?\n$/,i=/^\r?\n\r?\n/,j=1;j<g.length-1;){if(g[j-1][0]==0&&g[j+1][0]==0){var m=g[j-1][1],o=g[j][1],x=g[j+1][1],u=this.diff_commonSuffix(m,o);if(u){var f=o.substring(o.length-u);m=m.substring(0,m.length-u);o=f+o.substring(0,o.length-u);x=f+x}u=m;f=o;for(var A=x,F=e(m,o)+e(o,x);o.charAt(0)===x.charAt(0);){m+=o.charAt(0);o=o.substring(1)+x.charAt(0);x=
x.substring(1);var p=e(m,o)+e(o,x);if(p>=F){F=p;u=m;f=o;A=x}}if(g[j-1][1]!=u){if(u)g[j-1][1]=u;else{g.splice(j-1,1);j--}g[j][1]=f;if(A)g[j+1][1]=A;else{g.splice(j+1,1);j--}}}j++}};v.prototype.diff_cleanupEfficiency=function(g){for(var e=false,b=[],d=0,k="",h=0,i=false,j=false,m=false,o=false;h<g.length;){if(g[h][0]==0){if(g[h][1].length<this.Diff_EditCost&&(m||o)){b[d++]=h;i=m;j=o;k=g[h][1]}else{d=0;k=""}m=o=false}else{if(g[h][0]==-1)o=true;else m=true;if(k&&(i&&j&&m&&o||k.length<this.Diff_EditCost/
2&&i+j+m+o==3)){g.splice(b[d-1],0,[-1,k]);g[b[d-1]+1][0]=1;d--;k="";if(i&&j){m=o=true;d=0}else{d--;h=d>0?b[d-1]:-1;m=o=false}e=true}}h++}e&&this.diff_cleanupMerge(g)};v.prototype.diff_cleanupMerge=function(g){g.push([0,""]);for(var e=0,b=0,d=0,k="",h="",i;e<g.length;)switch(g[e][0]){case 1:d++;h+=g[e][1];e++;break;case -1:b++;k+=g[e][1];e++;break;case 0:if(b!==0||d!==0){if(b!==0&&d!==0){i=this.diff_commonPrefix(h,k);if(i!==0){if(e-b-d>0&&g[e-b-d-1][0]==0)g[e-b-d-1][1]+=h.substring(0,i);else{g.splice(0,
0,[0,h.substring(0,i)]);e++}h=h.substring(i);k=k.substring(i)}i=this.diff_commonSuffix(h,k);if(i!==0){g[e][1]=h.substring(h.length-i)+g[e][1];h=h.substring(0,h.length-i);k=k.substring(0,k.length-i)}}if(b===0)g.splice(e-b-d,b+d,[1,h]);else d===0?g.splice(e-b-d,b+d,[-1,k]):g.splice(e-b-d,b+d,[-1,k],[1,h]);e=e-b-d+(b?1:0)+(d?1:0)+1}else if(e!==0&&g[e-1][0]==0){g[e-1][1]+=g[e][1];g.splice(e,1)}else e++;b=d=0;h=k="";break}g[g.length-1][1]===""&&g.pop();b=false;for(e=1;e<g.length-1;){if(g[e-1][0]==0&&g[e+
1][0]==0)if(g[e][1].substring(g[e][1].length-g[e-1][1].length)==g[e-1][1]){g[e][1]=g[e-1][1]+g[e][1].substring(0,g[e][1].length-g[e-1][1].length);g[e+1][1]=g[e-1][1]+g[e+1][1];g.splice(e-1,1);b=true}else if(g[e][1].substring(0,g[e+1][1].length)==g[e+1][1]){g[e-1][1]+=g[e+1][1];g[e][1]=g[e][1].substring(g[e+1][1].length)+g[e+1][1];g.splice(e+1,1);b=true}e++}b&&this.diff_cleanupMerge(g)};v.prototype.diff_xIndex=function(g,e){var b=0,d=0,k=0,h=0,i;for(i=0;i<g.length;i++){if(g[i][0]!==1)b+=g[i][1].length;
if(g[i][0]!==-1)d+=g[i][1].length;if(b>e)break;k=b;h=d}if(g.length!=i&&g[i][0]===-1)return h;return h+(e-k)};v.prototype.diff_prettyHtml=function(g){for(var e=[],b=0,d=0;d<g.length;d++){var k=g[d][0],h=g[d][1],i=h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(k){case 1:e[d]='<INS STYLE="background:#E6FFE6;" TITLE="i='+b+'">'+i+"</INS>";break;case -1:e[d]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+b+'">'+i+"</DEL>";break;case 0:e[d]='<SPAN TITLE="i='+
b+'">'+i+"</SPAN>";break}if(k!==-1)b+=h.length}return e.join("")};v.prototype.diff_text1=function(g){for(var e=[],b=0;b<g.length;b++)if(g[b][0]!==1)e[b]=g[b][1];return e.join("")};v.prototype.diff_text2=function(g){for(var e=[],b=0;b<g.length;b++)if(g[b][0]!==-1)e[b]=g[b][1];return e.join("")};v.prototype.diff_levenshtein=function(g){for(var e=0,b=0,d=0,k=0;k<g.length;k++){var h=g[k][1];switch(g[k][0]){case 1:b+=h.length;break;case -1:d+=h.length;break;case 0:e+=Math.max(b,d);d=b=0;break}}e+=Math.max(b,
d);return e};v.prototype.diff_toDelta=function(g){for(var e=[],b=0;b<g.length;b++)switch(g[b][0]){case 1:e[b]="+"+encodeURI(g[b][1]);break;case -1:e[b]="-"+g[b][1].length;break;case 0:e[b]="="+g[b][1].length;break}return e.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ")};v.prototype.diff_fromDelta=function(g,e){var b=[],d=0,k=0;e=e.replace(/%00/g,"\u0000");e=e.split(/\t/g);for(var h=0;h<e.length;h++){var i=e[h].substring(1);switch(e[h].charAt(0)){case "+":try{b[d++]=[1,decodeURI(i)]}catch(j){throw new Error("Illegal escape in diff_fromDelta: "+
i);}break;case "-":case "=":var m=parseInt(i,10);if(isNaN(m)||m<0)throw new Error("Invalid number in diff_fromDelta: "+i);i=g.substring(k,k+=m);if(e[h].charAt(0)=="=")b[d++]=[0,i];else b[d++]=[-1,i];break;default:if(e[h])throw new Error("Invalid diff operation in diff_fromDelta: "+e[h]);}}if(k!=g.length)throw new Error("Delta length ("+k+") does not equal source text length ("+g.length+").");return b};v.prototype.match_main=function(g,e,b){b=Math.max(0,Math.min(b,g.length));return g==e?0:g.length?
g.substring(b,b+e.length)==e?b:this.match_bitap(g,e,b):-1};v.prototype.match_bitap=function(g,e,b){function d(z,E){z=z/e.length;E=Math.abs(b-E);if(!h.Match_Distance)return E?1:z;return z+E/h.Match_Distance}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var k=this.match_alphabet(e),h=this,i=this.Match_Threshold,j=g.indexOf(e,b);if(j!=-1)i=Math.min(d(0,j),i);j=g.lastIndexOf(e,b+e.length);if(j!=-1)i=Math.min(d(0,j),i);var m=1<<e.length-1;j=-1;for(var o,x,u=e.length+
g.length,f,A=0;A<e.length;A++){o=0;for(x=u;o<x;){if(d(A,b+x)<=i)o=x;else u=x;x=Math.floor((u-o)/2+o)}u=x;o=Math.max(1,b-x+1);var F=Math.min(b+x,g.length)+e.length;x=Array(F+2);x[F+1]=(1<<A)-1;for(F=F;F>=o;F--){var p=k[g.charAt(F-1)];x[F]=A===0?(x[F+1]<<1|1)&p:(x[F+1]<<1|1)&p|(f[F+1]|f[F])<<1|1|f[F+1];if(x[F]&m){p=d(A,F-1);if(p<=i){i=p;j=F-1;if(j>b)o=Math.max(1,2*b-j);else break}}}if(d(A+1,b)>i)break;f=x}return j};v.prototype.match_alphabet=function(g){for(var e={},b=0;b<g.length;b++)e[g.charAt(b)]=
0;for(b=0;b<g.length;b++)e[g.charAt(b)]|=1<<g.length-b-1;return e};v.prototype.patch_addContext=function(g,e){for(var b=e.substring(g.start2,g.start2+g.length1),d=0;e.indexOf(b)!=e.lastIndexOf(b)&&b.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;){d+=this.Patch_Margin;b=e.substring(g.start2-d,g.start2+g.length1+d)}d+=this.Patch_Margin;(b=e.substring(g.start2-d,g.start2))&&g.diffs.unshift([0,b]);(e=e.substring(g.start2+g.length1,g.start2+g.length1+d))&&g.diffs.push([0,e]);g.start1-=
b.length;g.start2-=b.length;g.length1+=b.length+e.length;g.length2+=b.length+e.length};v.prototype.patch_make=function(g,e,b){var d;if(typeof g=="string"&&typeof e=="string"&&typeof b=="undefined"){d=g;e=this.diff_main(d,e,true);if(e.length>2){this.diff_cleanupSemantic(e);this.diff_cleanupEfficiency(e)}}else if(typeof g=="object"&&typeof e=="undefined"&&typeof b=="undefined"){e=g;d=this.diff_text1(e)}else if(typeof g=="string"&&typeof e=="object"&&typeof b=="undefined"){d=g;e=e}else if(typeof g==
"string"&&typeof e=="string"&&typeof b=="object"){d=g;e=b}else throw new Error("Unknown call format to patch_make.");if(e.length===0)return[];b=[];g=new s;var k=0,h=0,i=0,j=d;d=d;for(var m=0;m<e.length;m++){var o=e[m][0],x=e[m][1];if(!k&&o!==0){g.start1=h;g.start2=i}switch(o){case 1:g.diffs[k++]=e[m];g.length2+=x.length;d=d.substring(0,i)+x+d.substring(i);break;case -1:g.length1+=x.length;g.diffs[k++]=e[m];d=d.substring(0,i)+d.substring(i+x.length);break;case 0:if(x.length<=2*this.Patch_Margin&&k&&
e.length!=m+1){g.diffs[k++]=e[m];g.length1+=x.length;g.length2+=x.length}else if(x.length>=2*this.Patch_Margin)if(k){this.patch_addContext(g,j);b.push(g);g=new s;k=0;j=d;h=i}break}if(o!==1)h+=x.length;if(o!==-1)i+=x.length}if(k){this.patch_addContext(g,j);b.push(g)}return b};v.prototype.patch_deepCopy=function(g){for(var e=[],b=0;b<g.length;b++){var d=g[b],k=new s;k.diffs=[];for(var h=0;h<d.diffs.length;h++)k.diffs[h]=d.diffs[h].slice();k.start1=d.start1;k.start2=d.start2;k.length1=d.length1;k.length2=
d.length2;e[b]=k}return e};v.prototype.patch_apply=function(g,e){if(g.length==0)return[e,[]];g=this.patch_deepCopy(g);var b=this.patch_addPadding(g);e=b+e+b;this.patch_splitMax(g);for(var d=0,k=[],h=0;h<g.length;h++){var i=g[h].start2+d,j=this.diff_text1(g[h].diffs),m,o=-1;if(j.length>this.Match_MaxBits){m=this.match_main(e,j.substring(0,this.Match_MaxBits),i);if(m!=-1){o=this.match_main(e,j.substring(j.length-this.Match_MaxBits),i+j.length-this.Match_MaxBits);if(o==-1||m>=o)m=-1}}else m=this.match_main(e,
j,i);if(m==-1)k[h]=false;else{k[h]=true;d=m-i;i=o==-1?e.substring(m,m+j.length):e.substring(m,o+this.Match_MaxBits);if(j==i)e=e.substring(0,m)+this.diff_text2(g[h].diffs)+e.substring(m+j.length);else{i=this.diff_main(j,i,false);if(j.length>this.Match_MaxBits&&this.diff_levenshtein(i)/j.length>this.Patch_DeleteThreshold)k[h]=false;else{this.diff_cleanupSemanticLossless(i);j=0;var x;for(o=0;o<g[h].diffs.length;o++){var u=g[h].diffs[o];if(u[0]!==0)x=this.diff_xIndex(i,j);if(u[0]===1)e=e.substring(0,
m+x)+u[1]+e.substring(m+x);else if(u[0]===-1)e=e.substring(0,m+x)+e.substring(m+this.diff_xIndex(i,j+u[1].length));if(u[0]!==-1)j+=u[1].length}}}}}e=e.substring(b.length,e.length-b.length);return[e,k]};v.prototype.patch_addPadding=function(g){for(var e="",b=1;b<=this.Patch_Margin;b++)e+=String.fromCharCode(b);for(b=0;b<g.length;b++){g[b].start1+=e.length;g[b].start2+=e.length}b=g[0];var d=b.diffs;if(d.length==0||d[0][0]!=0){d.unshift([0,e]);b.start1-=e.length;b.start2-=e.length;b.length1+=e.length;
b.length2+=e.length}else if(e.length>d[0][1].length){var k=e.length-d[0][1].length;d[0][1]=e.substring(d[0][1].length)+d[0][1];b.start1-=k;b.start2-=k;b.length1+=k;b.length2+=k}b=g[g.length-1];d=b.diffs;if(d.length==0||d[d.length-1][0]!=0){d.push([0,e]);b.length1+=e.length;b.length2+=e.length}else if(e.length>d[d.length-1][1].length){k=e.length-d[d.length-1][1].length;d[d.length-1][1]+=e.substring(0,k);b.length1+=k;b.length2+=k}return e};v.prototype.patch_splitMax=function(g){for(var e=0;e<g.length;e++)if(g[e].length1>
this.Match_MaxBits){var b=g[e];g.splice(e--,1);for(var d=this.Match_MaxBits,k=b.start1,h=b.start2,i="";b.diffs.length!==0;){var j=new s,m=true;j.start1=k-i.length;j.start2=h-i.length;if(i!==""){j.length1=j.length2=i.length;j.diffs.push([0,i])}for(;b.diffs.length!==0&&j.length1<d-this.Patch_Margin;){i=b.diffs[0][0];var o=b.diffs[0][1];if(i===1){j.length2+=o.length;h+=o.length;j.diffs.push(b.diffs.shift());m=false}else if(i===-1&&j.diffs.length==1&&j.diffs[0][0]==0&&o.length>2*d){j.length1+=o.length;
k+=o.length;m=false;j.diffs.push([i,o]);b.diffs.shift()}else{o=o.substring(0,d-j.length1-this.Patch_Margin);j.length1+=o.length;k+=o.length;if(i===0){j.length2+=o.length;h+=o.length}else m=false;j.diffs.push([i,o]);if(o==b.diffs[0][1])b.diffs.shift();else b.diffs[0][1]=b.diffs[0][1].substring(o.length)}}i=this.diff_text2(j.diffs);i=i.substring(i.length-this.Patch_Margin);o=this.diff_text1(b.diffs).substring(0,this.Patch_Margin);if(o!==""){j.length1+=o.length;j.length2+=o.length;if(j.diffs.length!==
0&&j.diffs[j.diffs.length-1][0]===0)j.diffs[j.diffs.length-1][1]+=o;else j.diffs.push([0,o])}m||g.splice(++e,0,j)}}};v.prototype.patch_toText=function(g){for(var e=[],b=0;b<g.length;b++)e[b]=g[b];return e.join("")};v.prototype.patch_fromText=function(g){var e=[];if(!g)return e;g=g.replace(/%00/g,"\u0000");g=g.split("\n");for(var b=0;b<g.length;){var d=g[b].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!d)throw new Error("Invalid patch string: "+g[b]);var k=new s;e.push(k);k.start1=parseInt(d[1],
10);if(d[2]===""){k.start1--;k.length1=1}else if(d[2]=="0")k.length1=0;else{k.start1--;k.length1=parseInt(d[2],10)}k.start2=parseInt(d[3],10);if(d[4]===""){k.start2--;k.length2=1}else if(d[4]=="0")k.length2=0;else{k.start2--;k.length2=parseInt(d[4],10)}for(b++;b<g.length;){d=g[b].charAt(0);try{var h=decodeURI(g[b].substring(1))}catch(i){throw new Error("Illegal escape in patch_fromText: "+h);}if(d=="-")k.diffs.push([-1,h]);else if(d=="+")k.diffs.push([1,h]);else if(d==" ")k.diffs.push([0,h]);else if(d==
"@")break;else if(d!=="")throw new Error('Invalid patch mode "'+d+'" in: '+h);b++}}return e};s.prototype.toString=function(){for(var g=["@@ -"+(this.length1===0?this.start1+",0":this.length1==1?this.start1+1:this.start1+1+","+this.length1)+" +"+(this.length2===0?this.start2+",0":this.length2==1?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],e,b=0;b<this.diffs.length;b++){switch(this.diffs[b][0]){case 1:e="+";break;case -1:e="-";break;case 0:e=" ";break}g[b+1]=e+encodeURI(this.diffs[b][1])+
"\n"}return g.join("").replace(/\x00/g,"%00").replace(/%20/g," ")};t.diff_match_patch=v;t.DIFF_DELETE=-1;t.DIFF_INSERT=1;t.DIFF_EQUAL=0});bespin.tiki.register("::edit_session",{name:"edit_session",dependencies:{events:"0.0.0"}});
bespin.tiki.module("edit_session:index",function(y,t){y("bespin:promise");y("bespin:plugins");y("bespin:util/util");y("events");t.EditSession=function(){};t.EditSession.prototype={_currentView:null,currentUser:null,history:null,getCompletePath:function(v){if(v==null)v="";if(v==null||v.substring(0,1)!="/"){var s;if(this._currentView&&this._currentView.buffer)s=this._currentView.buffer;var g;if(s)g=s.file;v=g?g.parentdir()+v:"/"+v}return v}};Object.defineProperties(t.EditSession.prototype,{currentView:{set:function(v){if(v!==
this._currentView)this._currentView=v},get:function(){return this._currentView}}});t.createSession=function(v,s){var g=new t.EditSession;if(v)g.currentView=v.textView;if(s)g.currentUser=s;return g}});bespin.tiki.register("::syntax_manager",{name:"syntax_manager",dependencies:{worker_manager:"0.0.0",syntax_directory:"0.0.0",events:"0.0.0",underscore:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("syntax_manager:index",function(y,t){function v(j,m,o,x){for(;j.length<m;)j.push(b(x).clone());m=[m,o.length].concat(o);Array.prototype.splice.apply(j,m);return j}function s(){this._lines=[];this._syms={}}function g(j,m){this._syntaxInfo=j;this._syntaxManager=m;this._invalidRow=0;this._states=[];this._active=false;this.symbols=new s}function e(j){this.layoutManager=j;this.attrsChanged=new d;this.syntaxChanged=new d;this._contextRanges=this._invalidRows=this._context=null;this._attrs=
[];this._symbols=new s;this._syntax="plain";this._reset()}var b=y("underscore")._,d=y("events").Event,k=y("worker_manager").WorkerSupervisor;y("bespin:console");y("rangeutils:utils/range");var h=y("settings").settings,i=y("syntax_directory").syntaxDirectory;s.prototype={get:function(j){return this._syms["-"+j]},replaceLine:function(j,m){function o(f){return f.substring(1)}var x=this._lines,u=this._syms;j<x.length&&b(x[j]).isArray()&&b(x[j]).each(function(f){delete u["-"+f]});x[j]=b(m).keys().map(o);
b(u).extend(m)}};g.prototype={_annotate:function(){if(this._invalidRow==null)throw new Error("syntax_manager.Context: attempt to annotate without any invalid row");if(!this._active)throw new Error("syntax_manager.Context: attempt to annotate while inactive");if(this._worker==null)this._createWorker();else{var j=this._syntaxManager.getTextLines(),m=this._invalidRow,o=m===0?this.getName()+":start":this._states[m],x=Math.min(j.length,m+100);j=j.slice(m,x);var u={start:{row:m,col:0},end:{row:x-1,col:b(j).last().length}};
this._worker.send("annotate",[o,j,u]).then(b(this._annotationFinished).bind(this,m,x))}},_annotationFinished:function(j,m,o){if(this._active){var x=this._syntaxManager;x.mergeAttrs(j,o.attrs);x.mergeSymbols(j,o.symbols);v(this._states,j,o.states);if(m>=this._getRowCount()){this._invalidRow=null;this._active=false}else{this._invalidRow=m;this._annotate()}}},_createWorker:function(){if(this._syntaxInfo==null)return false;var j=new k("syntax_worker#syntaxWorker");this._worker=j;j.started.add(this._workerStarted.bind(this));
j.start();return true},_getRowCount:function(){return this._syntaxManager.getTextLines().length},_workerStarted:function(){this._syntaxInfo.settings.forEach(function(j){var m=h.get(j);this._worker.send("setSyntaxSetting",[j,m])},this);this._worker.send("loadSyntax",[this._syntaxInfo.name]);this._active&&this._annotate()},activateAndAnnotate:function(){this._active=true;this._annotate()},contextsAtPosition:function(){var j=this._syntaxInfo;if(j==null)return["plain"];return[j.name]},cut:function(j){var m=
this._getRowCount();if(j<0||j>=m)throw new Error("Attempt to cut the context at an invalid row");if(!(this._invalidRow!=null&&this._invalidRow<j)){this._invalidRow=j;this._active=false}},getName:function(){return this._syntaxInfo.name},kill:function(){var j=this._worker;if(j!=null){j.kill();this._worker=null}}};e.prototype={_getTextStorage:function(){return this.layoutManager.textStorage},_reset:function(){var j=this._context;if(j!=null){j.kill();this._context=null}j=this._syntax;j=j==="plain"?null:
i.get(j);this._context=j=new g(j,this);j.activateAndAnnotate()},attrsChanged:null,syntaxChanged:null,contextsAtPosition:function(j){return this._context.contextsAtPosition(j)},getAttrsForRows:function(j,m){return this._attrs.slice(j,m)},getSymbol:function(j){return this._symbols.get(j)},getSyntax:function(){return this._syntax},getTextLines:function(){return this._getTextStorage().lines},invalidateRow:function(j){var m=this._context;m.cut(j);m.activateAndAnnotate()},mergeAttrs:function(j,m){v(this._attrs,
j,m,[]);this.attrsChanged(j,j+m.length)},mergeSymbols:function(j,m){var o=this._symbols;b(m).each(function(x,u){o.replaceLine(j+u,x)})},setSyntax:function(j){this._syntax=i.hasSyntax(j)?j:"plain";this.syntaxChanged(j);this._reset()},setSyntaxFromFileExt:function(j){return this.setSyntax(i.syntaxForFileExt(j))}};t.SyntaxManager=e});bespin.tiki.register("::completion",{name:"completion",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("completion:ui",function(y,t){function v(k){var h=g.uniqueId("bespin-completion-panel"),i=document.createElement("div");i.id=h;i.className="bespin-completion-panel";i.style.display="none";i.innerHTML='<div class="bespin-completion-pointer"></div><div class="bespin-completion-bubble-outer"><div class="bespin-completion-bubble-inner"><div class="bespin-completion-highlight"></div><ul></ul></div></div>';s(k).append(i);this.panel=s(i);this.parent=s(k)}var s=y("jquery").$,g=y("underscore")._,
e=g.template('<span class="bespin-completion-container"> &mdash; <%= container %></span>'),b=g.template('<div class="bespin-completion-second-row"><%= type %></div>'),d=g.template('<li><div class="bespin-completion-top-row"><span class="bespin-completion-kind bespin-completion-kind-<%= kind %>"><%= kind %></span><span class="bespin-completion-ident"><%= ident %></span><%= container %></div><%= second_row %></li>');v.prototype={_fromBottom:false,_index:0,_tags:null,_getHighlightDimensions:function(k){var h=
k.position(),i=k.outerHeight()-2;k=k.outerWidth()-2;return{left:h.left,top:h.top,height:i,width:k}},_listItemForIndex:function(k){return this.panel.find("li:eq("+k+")")},_populate:function(){var k=g(this._tags).map(function(h){var i=h["class"],j=h.module,m=h.namespace;i=i!=null?i:m!=null?m:"";if(j!=null)i=j+(i!=""?"#"+i:"");j=i==""?"":e({container:i});i=h.type;i=i==null?"":b({type:i});return d({kind:h.kind,ident:h.name,container:j,second_row:i})});this.panel.find("ul").html(k.join("\n"))},panel:null,
visible:false,getCompletion:function(){return this.visible?this._tags[this._index]:null},hide:function(){if(this.visible){this.panel.fadeOut(100);this.visible=false}},move:function(k){var h=this._index,i=this._listItemForIndex(h),j=k==="up"?i.prev():i.next();if(j.length!==0){this._index=h=k==="up"?h-1:h+1;h=s(i).find(".bespin-completion-top-row");var m=s(i).find(".bespin-completion-second-row");i=s(j).find(".bespin-completion-top-row");var o=s(j).find(".bespin-completion-second-row");m.hide();o.show();
var x=this.panel.find(".bespin-completion-highlight");x.stop(true,true);j=this._getHighlightDimensions(j);x.animate(j,100);o.hide();if(k==="down"){k=m.height();i.css("top",k);i.animate({top:0},100)}else{k=o.height();h.css("top",-k);h.animate({top:0},100)}o.fadeIn()}},show:function(k,h,i){this._tags=k=g(k).clone();this._populate();var j=this.visible,m=this.panel;m.stop(true,true);j||m.show();var o=this.parent.offset(),x=o.left,u=x+h.x,f=o.top+h.y;o=m.outerWidth();var A=m.outerHeight(),F=s(window).width(),
p=s(window).height();this._fromBottom=f=f+A+i>p;if(this._index>=k.length)this._index=k.length-1;if(f){f=m.find(".bespin-completion-pointer");f.removeClass("bespin-completion-pointer-up");f.addClass("bespin-completion-pointer-down");m.css({bottom:-h.y,top:""});this._tags.reverse();this._populate();if(!j)this._index=k.length-1}else{f=m.find(".bespin-completion-pointer");f.removeClass("bespin-completion-pointer-down");f.addClass("bespin-completion-pointer-up");m.css({top:h.y+i,bottom:""});if(!j)this._index=
0}if(!j){if(u+h.x+o>F){f.css({left:"",right:32});m.css("left",Math.min(F-o-x,h.x-o+43))}else{f.css({left:32,right:""});m.css("left",Math.max(x,h.x-43))}m.hide().animate({opacity:"show"},100)}k=m.find(".bespin-completion-highlight");k.stop(true,true);h=this._listItemForIndex(this._index);h.find(".bespin-completion-second-row").show();h=this._getHighlightDimensions(h);k.css(h);this.visible=true}};t.CompletionUI=v});
bespin.tiki.module("completion:controller",function(y,t){function v(h){this._editorView=h;h.selectionChanged.add(this._selectionChanged.bind(this));h.willChangeBuffer.add(this._willChangeBuffer.bind(this));this._syntaxChanged=this._syntaxChanged.bind(this);this.tags=new g.Tags;this.ui=new b(h.element)}function s(h){return function(){return k.editor.completionController[h](k)}}var g=y("ctags"),e=y("rangeutils:utils/range"),b=y("completion:ui").CompletionUI,d=y("bespin:plugins").catalog,k=y("environment").env;
v.prototype={_buffer:null,_completionEngine:null,_completions:null,_stem:null,_hideCompletions:function(){this.ui.hide()},_selectionChanged:function(h){var i=this._completionEngine;if(!(i==null||!e.isZeroLength(h))){var j=this._buffer.layoutManager,m=j.syntaxManager,o=h.start;h=o.col;o=j.textStorage.lines[o.row];j=o.substring(0,h);h=o.substring(h);i=i.getCompletions(j,h,m);if(i==null)this._hideCompletions();else{m=i.tags;this._stem=i.stem;this._showCompletions(m)}}},_showCompletions:function(h){var i=
this._editorView,j=i.textView.getInsertionPointPosition();j=i.convertTextViewPoint(j);this.ui.show(h,j,i.layoutManager.fontDimension.lineHeight)},_syntaxChanged:function(h){h=d.getExtensionByKey("completion",h);if(h==null)this._completionEngine=null;else h.load().then(function(i){this._completionEngine=new i(this.tags)}.bind(this))},_willChangeBuffer:function(h){var i=this._buffer;i!=null&&i.layoutManager.syntaxManager.syntaxChanged.remove(this._syntaxChanged);h.layoutManager.syntaxManager.syntaxChanged.add(this._syntaxChanged);
this._buffer=h},cancel:function(){this.ui.hide()},complete:function(h){var i=this.ui,j=i.getCompletion().name;h.view.insertText(j.substring(this._stem.length));i.hide()},isCompleting:function(){return this.ui.visible},moveDown:function(){this.ui.move("down")},moveUp:function(){this.ui.move("up")},tags:null};t.CompletionController=v;t.completeCommand=s("complete");t.completeCancelCommand=s("cancel");t.completeDownCommand=s("moveDown");t.completeUpCommand=s("moveUp")});
bespin.tiki.module("completion:index",function(){});bespin.tiki.register("::rangeutils",{name:"rangeutils",dependencies:{}});
bespin.tiki.module("rangeutils:utils/range",function(y,t){var v=y("bespin:util/util");t.addPositions=function(s,g){return{row:s.row+g.row,col:s.col+g.col}};t.cloneRange=function(s){var g=s.start;s=s.end;return{start:{row:g.row,col:g.col},end:{row:s.row,col:s.col}}};t.comparePositions=function(s,g){var e=s.row-g.row;return e===0?s.col-g.col:e};t.equal=function(s,g){return t.comparePositions(s.start,g.start)===0&&t.comparePositions(s.end,g.end)===0};t.extendRange=function(s,g){var e=s.end;return{start:s.start,
end:{row:e.row+g.row,col:e.col+g.col}}};t.intersectRangeSets=function(s,g){s=v.clone(s);g=v.clone(g);for(var e=[];s.length>0&&g.length>0;){var b=s.shift(),d=g.shift(),k=t.comparePositions(b.start,d.start),h=t.comparePositions(b.end,d.end);if(t.comparePositions(b.end,d.start)<0){e.push(b);g.unshift(d)}else if(t.comparePositions(d.end,b.start)<0){e.push(d);s.unshift(b)}else if(k<0){e.push({start:b.start,end:d.start});s.unshift({start:d.start,end:b.end});g.unshift(d)}else if(k===0)if(h<0)g.unshift({start:b.end,
end:d.end});else h>0&&s.unshift({start:d.end,end:b.end});else if(k>0){e.push({start:d.start,end:b.start});s.unshift(b);g.unshift({start:b.start,end:d.end})}}return e.concat(s,g)};t.isZeroLength=function(s){return s.start.row===s.end.row&&s.start.col===s.end.col};t.maxPosition=function(s,g){return t.comparePositions(s,g)>0?s:g};t.normalizeRange=function(s){return this.comparePositions(s.start,s.end)<0?s:{start:s.end,end:s.start}};t.rangeSetBoundaries=function(s){return{start:s[0].start,end:s[s.length-
1].end}};t.toString=function(s){var g=s.start;s=s.end;return"[ "+g.row+", "+g.col+" "+s.row+","+ +s.col+" ]"};t.unionRanges=function(s,g){return{start:s.start.row<g.start.row||s.start.row===g.start.row&&s.start.col<g.start.col?s.start:g.start,end:s.end.row>g.end.row||s.end.row===g.end.row&&s.end.col>g.end.col?s.end:g.end}};t.isPosition=function(s){return!v.none(s)&&!v.none(s.row)&&!v.none(s.col)};t.isRange=function(s){return!v.none(s)&&t.isPosition(s.start)&&t.isPosition(s.end)}});
bespin.tiki.module("rangeutils:index",function(){});bespin.tiki.register("::undomanager",{name:"undomanager",dependencies:{}});
bespin.tiki.module("undomanager:index",function(y,t){var v=y("bespin:util/util");y("environment");t.UndoManager=function(){};v.mixin(t.UndoManager.prototype,{_redoStack:[],_undoStack:[],_undoOrRedo:function(s,g,e){if(g.length===0)return false;g=g.pop();if(!g.target[s](g.context)){this._redoStack=[];this._undoStack=[];return false}e.push(g);return true},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(s,g){this._redoStack=[];this._undoStack.push({target:s,
context:g})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});t.global=new t.UndoManager;t.undoManagerCommand=function(s,g){t.global[g.commandExt.name]()}});bespin.tiki.register("::command_line",{name:"command_line",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"}});
bespin.tiki.module("command_line:hint",function(y,t){t.Level={Error:3,Incomplete:2,Warning:1,Info:0};t.Hint=function(v,s,g){this.level=v;this.element=s;this.completion=g}});
bespin.tiki.module("command_line:input",function(y,t){var v=y("bespin:plugins").catalog,s=y("bespin:console").console,g=y("bespin:promise").Promise,e=y("bespin:promise").group,b=y("bespin:util/stacktrace").Trace,d=y("bespin:util/util"),k=y("types:types"),h=y("canon:request").Request,i=y("canon:history"),j=y("keyboard:keyboard"),m=y("command_line:hint").Hint,o=y("command_line:hint").Level,x=y("command_line:typehint");t.Input=function(u,f){if(d.none(u))throw new Error("Input requires something 'typed' to work on");
this.typed=u;this.hints=[];this.argsPromise=new g;f=f||{};f.flags=f.flags||j.buildFlags({});this.flags=f.flags;this._parts=[];this._assignments=this._commandExt=this._unparsedArgs=undefined;try{this._tokenize()}catch(A){u=new b(A,true);s.group("Error calling command: "+this.typed);s.error(A);u.log(3);s.groupEnd();this.argsPromise.isComplete()||this.argsPromise.reject(A)}};t.Input.prototype={_tokenize:function(){if(!this.typed||this.typed===""){this.hints.push(new m(o.Incomplete));this.argsPromise.resolve({})}else{for(var u=
this.typed.replace(/^\s\s*/,"").split(/\s+/),f;;){f=u.shift();if(d.none(f))break;if(f[0]=='"'||f[0]=="'"){f=[f.substring(1,f.length)];for(var A;;){A=u.shift();if(!A)break;if(A[A.length-1]=='"'||A[A.length-1]=="'"){f.push(A.substring(0,A.length-1));break}else f.push(A)}this._parts.push(f.join(" "))}else this._parts.push(f)}this._split()}},_split:function(){this._unparsedArgs=this._parts.slice();for(var u=this._unparsedArgs.shift(),f;;){f=v.getExtensionByKey("command",u);if(!f)break;if(!j.flagsMatch(f.predicates,
this.flags)){f=null;break}if(f.pointer)break;u+=" "+this._unparsedArgs.shift()}this._commandExt=f;u=null;var A;if(this._commandExt){var F=new g;f.load().then(function(E){if(E)F.resolve(null);else{A="Failed to load command "+f.name+": Pointer "+f.pluginName+":"+f.pointer+" is null.";F.resolve(new m(o.Error,A))}},function(E){A="Failed to load command "+f.name+": Pointer "+f.pluginName+":"+f.pointer+" failed to load."+E;F.resolve(new m(o.Error,A))});this.hints.push(F);if(this._parts.length===1){var p=
this._commandExt;if(this.typed==p.name||!p.params||p.params.length===0)u=t.documentCommand(p,this.typed)}}else{var z=[];v.getExtensions("command").forEach(function(E){j.flagsMatch(E.predicates,this.flags)&&E.description&&z.push(E)}.bind(this));u={param:{type:{name:"selection",data:z},description:"Commands"},value:this.typed}}u&&this.hints.push(x.getHint(this,u));d.none(this._commandExt)?this.argsPromise.resolve({}):this._assign()},_assign:function(){this._assignments=[];var u=this._commandExt.params,
f=this._unparsedArgs,A;if(!u||u.length===0){var F=0;f.forEach(function(G){G.trim()!==""&&F++});if(F!==0){A=this._commandExt.name+" does not take any parameters";this.hints.push(new m(o.Error,A))}this.argsPromise.resolve({})}else{if(u.length==1&&u[0].type=="text")this._assignments[0]={value:f.length===0?null:f.join(" "),param:u[0]};else{var p=0,z=[];u.forEach(function(G){this._assignParam(G,p++,z)}.bind(this));var E=false;f.forEach(function(G){if(z.indexOf(G)==-1){A="Parameter '"+G+"' makes no sense.";
this.hints.push(new m(o.Error,A));E=true}}.bind(this));if(E){this.argsPromise.resolve({});return}}if(this._parts.length>1){u=this._getAssignmentForLastArg();u.param.type.assignments=this._assignments;u&&this.hints.push(x.getHint(this,u))}this._convertTypes()}},_assignParam:function(u,f,A){for(var F=0;F<this._unparsedArgs.length;F++){var p=this._unparsedArgs[F];if("--"+u.name==p){A.push(p);if(k.equals(u.type,"boolean"))this._assignments[f]={value:true,param:u};else if(F+1<this._unparsedArgs.length){u=
"Missing parameter: "+u.name;this.hints.push(new m(o.Incomplete,u))}else A.push(this._unparsedArgs[F+1]);return}}F=null;if(this._unparsedArgs.length>f){F=this._unparsedArgs[f];A.push(this._unparsedArgs[f])}if(F!==undefined)this._assignments[f]={value:F,param:u};else{this._assignments[f]={param:u};if(u.defaultValue===undefined){u="Missing parameter: "+u.name;this.hints.push(new m(o.Incomplete,u))}}},_getAssignmentForLastArg:function(){var u=null;this._assignments.forEach(function(f){if(!u||!d.none(f.value))u=
f});return u},_convertTypes:function(){if(this._commandExt.params){var u={},f=[];this._assignments.forEach(function(A){A.param.type.assignments=this._assignments;var F=this._convertType(A,u);F.then(function(p){A.converted=p;u[A.param.name]=p},function(p){this.hints.push(new m(o.Error,"Can't convert '"+A.value+"' to a "+param.type+": "+p))}.bind(this));f.push(F)}.bind(this));e(f).then(function(){this.argsPromise.resolve(u)}.bind(this))}else this.argsPromise.resolve({})},_convertType:function(u){return u.value!==
null?k.fromString(u.value,u.param.type):(new g).resolve(u.param.defaultValue)},execute:function(){var u=function(f){var A=new b(f,true);s.group("Error executing: "+this.typed);s.error(f);A.log(3);s.groupEnd()}.bind(this);this.argsPromise.then(function(f){this._commandExt.load().then(function(A){A=new h({command:A,commandExt:this._commandExt,typed:this.typed,args:f});i.execute(f,A)}.bind(this),u)}.bind(this),u)}};t.documentCommand=function(u,f){var A=[];A.push("<h1>"+u.name+"</h1>");A.push("<h2>Summary</h2>");
A.push("<p>"+u.description+"</p>");if(u.manual){A.push("<h2>Description</h2>");A.push("<p>"+u.description+"</p>")}if(u.params&&u.params.length>0){A.push("<h2>Synopsis</h2>");A.push("<pre>");A.push(u.name);var F=0;u.params.forEach(function(p){if(p.defaultValue===undefined){A.push(" <i>");A.push(p.name);A.push("</i>")}else if(p.defaultValue===null){A.push(" <i>[");A.push(p.name);A.push("]</i>")}else F++});if(F>3)A.push(" [options]");else F>0&&u.params.forEach(function(p){if(p.defaultValue){A.push(" [--<i>");
A.push(p.name);k.equals(p.type,"boolean")?A.push("</i>"):A.push("</i> "+k.getSimpleName(p.type));A.push("]")}});A.push("</pre>");A.push("<h2>Parameters</h2>");u.params.forEach(function(p){A.push('<h3 class="cmd_body"><i>'+p.name+"</i></h3>");A.push("<p>"+p.description+"</p>");k.defaultValue&&A.push("<p>Default: "+k.defaultValue+"</p>")})}return{param:{type:"text",description:A.join("")},value:f}}});
bespin.tiki.module("command_line:views/menu",function(y,t){var v=y("command_line:hint").Hint,s=y("command_line:hint").Level,g=y("environment").env,e;t.activateItemAction=function(d,k){d=parseInt(k.commandExt.key.replace(/[A-Za-z_]/g,""),10);e&&e._itemActions[d]()};var b=function(d,k){for(var h=0;;){if(d.charAt(h).toLocaleLowerCase()!==k.charAt(h).toLocaleLowerCase())return h;if(h>=d.length||h>=k.length)return h;h++}};t.Menu=function(d,k){if(d!=="subclassPrototype"){this.input=d;this.assignment=k;
this._parent=document.createElement("div");this._parent.setAttribute("class","cmd_menu");this._notFound=document.createElement("div");this._notFound.setAttribute("class","cmd_error");this._notFound.innerHTML="No matches for '"+this.input.typed+"'";this._parent.appendChild(this._notFound);this._list=document.createElement("ul");this._parent.appendChild(this._list);this._items=[];this._commonPrefix=null;this._itemActions=[];this._prefix=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?
this.assignment.value.length:0));this.hint=new v(s.Incomplete,this._parent);e=this}};t.Menu.prototype.addItems=function(d){var k=1,h;d.forEach(function(i){if(this._items.length<10){var j=document.createElement("li");j.appendChild(document.createTextNode(i.name));if(i.description||i.path){var m=document.createElement("dfn");m.appendChild(document.createTextNode(i.description||i.path));j.appendChild(m)}this._itemActions[k]=function(){var o=this._prefix+this._getFullName(i);g.commandLine.setInput(o)}.bind(this);
if(k<11){m=document.createElement("abbr");m.innerHTML="ALT-"+"-1234567890"[k];if(k===1)h=m;j.appendChild(m);k++}this._list.appendChild(j);j.addEventListener("mousedown",function(o){var x=this._prefix+this._getFullName(i);g.commandLine.setInput(x);o.preventDefault()}.bind(this),false)}this._items.length===0&&this._parent.removeChild(this._notFound);this._items.push(i)}.bind(this));d=this._getBestCompletion();this.hint.completion=d.completion;if(d.isFirst&&h)h.innerHTML="TAB"};t.Menu.prototype._getBestCompletion=
function(){if(this._items.length===0)return{completion:undefined,isFirst:false};var d=this._items.length===1,k=this._getFullName(this._items[0]);this._items.length>1&&this._items.forEach(function(j){if(k.length>0){j=this._getFullName(j);j=b(k,j);if(j<k.length)k=k.substring(0,j)}}.bind(this));if(!k||k.length===0){k=this._getFullName(this._items[0]);d=true}var h=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?this.assignment.value.length:0)),i=h+k;if(i.indexOf(this.input.typed)!=
0||i===this.input.typed){i=h+this._getFullName(this._items[0]);d=true}return{completion:i,isFirst:d}};t.Menu.prototype._getFullName=function(d){return(d.path||"")+d.name};t.MatcherMenu=function(d,k,h,i){t.Menu.call(this,d,k);this.matcher=h;this.loaded=i;this.matcher.addListener({itemsAdded:function(j){this.addItems(j)}.bind(this),itemsCleared:function(){this.clearItems()}.bind(this)});if(this.loaded){this.loaded.then(function(){this._isLoaded=true}.bind(this));this._isLoaded=false}else this._isLoaded=
true};t.MatcherMenu.prototype=new t.Menu("subclassPrototype")});
bespin.tiki.module("command_line:views/basic",function(y,t){var v=y("bespin:console").console;y("bespin:promise");var s=y("types:basic"),g=y("matcher:prefix").PrefixMatcher,e=y("command_line:views/menu").Menu,b=y("command_line:views/menu").MatcherMenu;t.selection={getHint:function(d,k,h){if(!h.data){v.error("Missing data for selection type");h.data=[]}var i=new g(k.value||"");h=h.data.map(function(j){if(typeof j==="string")return{name:j};return j});i.addItems(h);return(new b(d,k,i)).hint},resolveTypeSpec:s.selection.resolveTypeSpec};
t.bool={getHint:function(d,k){d=new e(d,k);d.addItems([{name:"true"},{name:"false"}]);return d.hint}}});
bespin.tiki.module("command_line:views/requestOutput",function(y,t){var v=y("bespin:util/util"),s=y("bespin:plugins").catalog;y("bespin:console");var g=y("environment").env,e=y("command_line:templates"),b=s.getResourceURL("command_line")+"images";t.RequestOutput=function(d,k){this.request=d;this.cliInputView=k;this.throb=this.typed=this.duration=this.show=this.hide=this.output=this.rowout=this.rowin=null;e.requestOutput({actions:this,imagePath:b});this.cliInputView._table.appendChild(this.rowin);
this.cliInputView._table.appendChild(this.rowout);this.request.changed.add(this.onRequestChange.bind(this))};t.RequestOutput.prototype={copyToInput:function(){this.cliInputView.setInput(this.request.typed)},executeRequest:function(){g.commandLine=this.cliInputView;this.cliInputView._input=new Input(this.request.typed);this.cliInputView._input.execute()},hideOutput:function(d){this.output.style.display="none";v.addClass(this.hide,"cmd_hidden");v.removeClass(this.show,"cmd_hidden");d.stopPropagation()},
showOutput:function(d){this.output.style.display="block";v.removeClass(this.hide,"cmd_hidden");v.addClass(this.show,"cmd_hidden");d.stopPropagation()},remove:function(d){this.cliInputView._table.removeChild(this.rowin);this.cliInputView._table.removeChild(this.rowout);d.stopPropagation()},onRequestChange:function(){this.duration.innerHTML=this.request.duration?"completed in "+this.request.duration/1E3+" sec ":"";this.typed.innerHTML=this.request.typed;this.output.innerHTML="";this.request.outputs.forEach(function(d){var k;
if(typeof d=="string"){k=document.createElement("p");k.innerHTML=d}else k=d;this.output.appendChild(k)},this);this.cliInputView.scrollToBottom();v.setClass(this.output,"cmd_error",this.request.error);this.throb.style.display=this.request.completed?"none":"block"}};t.createHandler=function(d){return{pointer:function(k,h,i){new t.RequestOutput(i,d)}}}});
bespin.tiki.module("command_line:views/cli",function(y,t){var v=y("diff").diff_match_patch,s=y("bespin:util/util"),g=y("bespin:plugins").catalog;y("bespin:console");var e=y("keyboard:keyutil"),b=y("keyboard:keyboard").keyboardManager;y("canon:history");var d=y("environment").env,k=y("settings").settings,h=y("command_line:hint").Level,i=y("command_line:input").Input,j=y("command_line:templates"),m=y("command_line:views/requestOutput"),o=g.getResourceURL("command_line")+"images",x=new v;t.CliInputView=
function(){this._pinned=this._hasFocus=false;this._completion="";this._input=new i("");this._inputer=this._completer=this._table=this._hints=this._tog=this.element=this._lastOrientation=null;j.cli({cliInputView:this,imagePath:o});e.addKeyDownListener(this._inputer,function(f){d.commandLine=this;var A=b.processKeyEvent(f,this,{isCommandLine:true,isKeyUp:false});if(f.keyCode===e.KeyHelper.KEY.TAB)return true;return A}.bind(this));this._inputer.addEventListener("keyup",function(f){var A=b.processKeyEvent(f,
this,{isCommandLine:true,isKeyUp:true});if(f.keyCode===e.KeyHelper.KEY.RETURN){this._input.execute();this.setInput("")}else{f=this._inputer.value;if(this._input.typed!==f){this._input=new i(f);this.hintUpdated()}}return A}.bind(this),true);g.registerExtension("settingChange",{match:"[min|max]ConsoleHeight",pointer:this.checkSize.bind(this)});var u=m.createHandler(this);g.registerExtension("addedRequestOutput",u)};t.CliInputView.prototype={elementAppended:function(){this.checkSize()},getOrientation:function(){var u=
this.element.className,f=/\bnorth\b/.test(u),A=/\bsouth\b/.test(u),F=/\beast\b/.test(u);u=/\bwest\b/.test(u);if(f&&!A&&!F&&!u)return"north";if(!f&&A&&!F&&!u)return"south";if(!f&&!A&&F&&!u)return"east";if(!f&&!A&&!F&&u)return"west";throw new Error("Ambiguous orientation: north="+f+", south="+A+", east="+F+", west="+u);},checkSize:function(){var u=this.getOrientation();if(u==="north"||u==="south"){u=k.get("minConsoleHeight");if(this._pinned||this._hasFocus)u=k.get("maxConsoleHeight");this._table.style.height=
u+"px";this._tog.style.height=u+"px";this.element.style.height=u+26+"px";g.publish(this,"dimensionsChanged")}},complete:function(){if(this._completion)this._inputer.value=this._completion},setInput:function(u){u=u||"";this._inputer.value=u;this._input=new i(u);this.hintUpdated();this.focus()},focus:function(){this._inputer.focus()},execute:function(u){d.commandLine=this;(new i(u)).execute()},prompt:function(u){this._inputer.value=u},hintUpdated:function(){for(var u=this._input.hints;this._hints.firstChild;)this._hints.removeChild(this._hints.firstChild);
var f=h.Info;this.setCompletion("");var A=function(F,p){if(p)if(p.isPromise)p.then(function(G){A(F,G)}.bind(this));else{if(p.element)if(p.element.addEventListener)F.appendChild(p.element);else{var z=document.createElement("article"),E=p.element.toString();z.appendChild(document.createTextNode(E));F.appendChild(z)}this.setCompletion(p.completion);if(p.level>f)f=p.level;s.setClass(this._inputer,"cmd_error",f==h.Error)}}.bind(this);u.forEach(function(F){A(this._hints,F)}.bind(this));s.setClass(this._inputer,
"cmd_error",f==h.Error)},scrollToBottom:function(){this._table.scrollTop=Math.max(this._table.scrollHeight,this._table.clientHeight)-this._table.clientHeight},_focusCheck:function(u){this._hasFocus=u.type=="focus";this._delayedCheckSize()},_delayedCheckSize:function(){if(this._checkSizeTimeout){window.clearTimeout(this._checkSizeTimeout);this._checkSizeTimeout=null}this._checkSizeTimeout=window.setTimeout(function(){this.checkSize()}.bind(this),100)},_togglePin:function(u){if(/\bchecked\b/.test(u.target.className)){s.removeClass(u.target,
"checked");this._pinned=false}else{s.addClass(u.target,"checked");this._pinned=true}this._delayedCheckSize()},setCompletion:function(u){this._completion=u||"";var f=this._inputer.value;if(u)if(u.indexOf(f)===0)f='<span class="cmd_existing">'+f+"</span>"+u.substring(f.length);else{var A=x.diff_commonPrefix(f,u);u=u.substring(A);f='<span class="cmd_existing">'+f+'</span><span class="cmd_extension">'+u+"</span>"}else f="";this._completer.innerHTML=f}}});
bespin.tiki.module("command_line:commands/history",function(y,t){y("bespin:plugins");var v=y("canon:history"),s=y("environment").env,g=0;t.historyPreviousCommand=function(){g>0&&g--;s.commandLine.setInput(v.requests[g].typed)};t.historyNextCommand=function(){g<v.requests.length&&g++;s.commandLine.setInput(g===v.requests.length?"":v.requests[g].typed)};t.historyCommand=function(e,b){var d=[];d.push("<table>");var k=1;v.requests.forEach(function(h){d.push("<tr>");d.push("<th>"+k+"</th>");d.push("<td>"+
h.typed+"</td>");d.push("</tr>");k++});d.push("</table>");b.done(d.join(""))};t.addedRequestOutput=function(){g=v.requests.length}});
bespin.tiki.module("command_line:commands/basic",function(y,t){var v=y("bespin:index"),s=y("bespin:util/util");y("environment");t.evalCommand=function(e,b){var d;e=e.javascript;try{d=eval(e)}catch(k){d="<b>Error: "+k.message+"</b>"}var h="",i="",j;if(s.isFunction(d)){h=(d+"").replace(/\n/g,"<br>").replace(/ /g,"&#160");i="function"}else if(s.isObject(d)){i=Array.isArray(d)?"array":"object";var m=[],o;for(j in d)if(d.hasOwnProperty(j)){o=s.isFunction(d[j])?"[function]":s.isObject(d[j])?"[object]":
d[j];m.push({name:j,value:o})}m.sort(function(x,u){return x.name.toLowerCase()<u.name.toLowerCase()?-1:1});for(j=0;j<m.length;j++)h+="<b>"+m[j].name+"</b>: "+m[j].value+"<br>"}else{h=d;i=typeof d}b.done('Result for eval <b>"'+e+'"</b> (type: '+i+"): <br><br>"+h)};t.versionCommand=function(e,b){b.done("Bespin "+v.versionNumber+" ("+v.versionCodename+")")};var g=["really wants you to trick it out in some way.","is your Web editor.","would love to be like Emacs on the Web.","is written on the Web platform, so you can tweak it."];
t.bespinCommand=function(e,b){e=Math.floor(Math.random()*g.length);b.done("Bespin "+g[e])}});
bespin.tiki.module("command_line:commands/simple",function(y,t){var v=y("bespin:plugins").catalog,s=y("bespin:console").console,g=y("environment").env;t.completeCommand=function(){g.commandLine.complete()};var e=function(d,k){var h=[],i=v.getExtensionByKey("command",d);if(i&&i.pointer)h.push(i.description);else{var j=false;!d&&k&&k.prefix&&h.push(k.prefix);if(i){h.push("<h2>Sub-Commands of "+i.name+"</h2>");h.push("<p>"+i.description+"</p>")}else if(d){if(d=="hidden"){d="";j=true}h.push("<h2>Commands starting with '"+
d+"':</h2>")}else h.push("<h2>Available Commands:</h2>");var m=[];v.getExtensions("command").forEach(function(u){m.push(u.name)});var o=m.sort();h.push("<table>");for(var x=0;x<o.length;x++)if(i=v.getExtensionByKey("command",o[x])){if(!(!j&&i.hidden))if(i.description!==undefined)if(!(d&&i.name.indexOf(d)!==0))if(!(!d&&i.name.indexOf(" ")!=-1))if(!(i&&i.name==d)){h.push("<tr>");h.push('<th class="right">'+i.name+"</th>");h.push("<td>"+i.description+"</td>");h.push("</tr>")}}else s.error("Huh? command ",
i.name," cannot be looked up by name");h.push("</table>");!d&&k&&k.suffix&&h.push(k.suffix)}return h.join("")};t.helpCommand=function(d,k){d=e(d.search,{prefix:"<h2>Welcome to Bespin - Code in the Cloud</h2><ul><li><a href='http://labs.mozilla.com/projects/bespin' target='_blank'>Home Page</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin' target='_blank'>Wiki</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/UserGuide' target='_blank'>User Guide</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/Tips' target='_blank'>Tips and Tricks</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/FAQ' target='_blank'>FAQ</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/DeveloperGuide' target='_blank'>Developers Guide</a></li></ul>",
suffix:"For more information, see the <a href='https://wiki.mozilla.org/Labs/Bespin'>Bespin Wiki</a>."});k.done(d)};var b={aliases:[],commands:[]};t.aliasCommand=function(d,k){var h=b.aliases;if(d.alias)if(d.command===undefined)h[d.alias]?k.done(d.alias+" &#x2192; "+h[d.alias]):k.done("No alias set for '"+d.alias+"'");else{var i=d.alias;d=d.command;var j=d.split(" ")[0];if(b.commands[i])k.done("There is already a command with the name: "+i);else if(b.commands[j]){h[i]=d;k.done("Saving alias: "+i+
" &#x2192; "+d)}else if(h[j]){h[i]=d;k.done("Saving alias: "+i+" &#x2192; "+h[d]+" ("+d+" was an alias itself)")}else k.done("No command or alias with that name.")}else{d="<table>";for(i in h)if(h.hasOwnProperty(i))d+='<tr><td style="text-align:right;">'+i+"</td><td>&#x2192;</td><td>"+h[i]+"</td></tr>";d+="</table>";k.done(d)}}});
bespin.tiki.module("command_line:typehint",function(y,t){function v(m){var o=document.createElement("article");o.innerHTML=m;return new i(j.Info,o)}function s(m,o,x,u,f){var A;try{if(u&&typeof f.getHint==="function")A=f.getHint(o,x,u)}catch(F){d.error("Failed to get hint for ",u," reason: ",F)}A||(A=v(x.param.description));m.resolve(A);return m}function g(m){var o=new k,x=b.getExtensionByKey("typehint",m.name);o.resolve({ext:x,typeSpec:m});return o}function e(m){if(typeof m==="string")return g({name:m});
if(typeof m==="object")if(m.name==="deferred"){var o=new k;h.undeferTypeSpec(m).then(function(x){e(x).then(function(u){o.resolve(u)},function(u){o.reject(u)})});return o}else return g(m);throw new Error("Unknown typeSpec type: "+typeof m);}var b=y("bespin:plugins").catalog,d=y("bespin:console").console,k=y("bespin:promise").Promise,h=y("types:types"),i=y("command_line:hint").Hint,j=y("command_line:hint").Level;t.getHint=function(m,o){var x=new k;e(o.param.type).then(function(u){if(!u.ext)return s(x,
m,o);u.ext.load().then(function(f){typeof f.resolveTypeSpec==="function"?f.resolveTypeSpec(u.ext,u.typeSpec).then(function(){s(x,m,o,u.ext,f)},function(A){x.reject(A)}):s(x,m,o,u.ext,f)},function(){hint=v(o.param.description);x.resolve(hint)})});return x}});bespin.tiki.module("command_line:index",function(){});
bespin.tiki.module("command_line:templates",function(y,t){y("templater").compileAll({"requestOutput.htmlt":'\n<!-- The div for the input (i.e. what was typed) --\>\n<div class="cmd_rowin" save="${actions.rowin}"\n    onclick="${actions.copyToInput}"\n    ondblclick="${actions.executeRequest}">\n\n  <!-- What the user actually typed --\>\n  <div class="cmd_gt">&gt; </div>\n  <div class="cmd_typed" save="${actions.typed}"></div>\n\n  <!-- The extra details that appear on hover --\>\n  <div class="cmd_duration cmd_hover" save="${actions.duration}"></div>\n  <img class="cmd_hover" onclick="${actions.hideOutput}" save="${actions.hide}"\n      alt="Hide command output" src="${imagePath}/minus.png"/>\n  <img class="cmd_hover cmd_hidden" onclick="${actions.showOutput}" save="${actions.show}"\n      alt="Show command output" src="${imagePath}/plus.png"/>\n  <img class="cmd_hover" onclick="${actions.remove}"\n      alt="Remove this command from the history" src="${imagePath}/closer.png"/>\n\n</div>\n\n<!-- The div for the command output --\>\n<div class="cmd_rowout" save="${actions.rowout}">\n  <div class="cmd_output" save="${actions.output}"></div>\n  <img src="${imagePath}/throbber.gif" save="${actions.throb}"/>\n</div>\n',"cli.htmlt":'\n<div class="cmd_line" save="${cliInputView.element}"\n    onfocus="${cliInputView._focusCheck}" capturefocus="capturefocus"\n    onblur="${cliInputView._focusCheck}" captureblur="captureblur"\n    onclick="${cliInputView.focus}" captureclick="captureclick">\n\n  <!-- The output area that changes height --\>\n  <div class="cmd_tog stack_children" save="${cliInputView._tog}">\n\n    <div class="cmd_top">\n      <!-- Side toolbar --\>\n      <div class="cmd_toolbar">\n        <img src="${imagePath}/dot_clear.gif" class="cmd_pin check"\n            alt="Pin/Unpin the console output"\n            onclick="${cliInputView._togglePin}"/>\n      </div>\n  \n      <!-- CLI output table --\>\n      <div class="cmd_table" save="${cliInputView._table}"></div>\n    </div>\n\n    <!-- A div to hang hints on --\>\n    <div class="cmd_hints" save="${cliInputView._hints}"></div>\n\n  </div>\n\n  <!-- The input area, with fixed height --\>\n  <div class="cmd_cli">\n\n    <!-- The prompt --\>\n    <div class="cmd_prompt cmd_gt">\n      <span class="cmd_brackets">{ }</span> &gt;\n    </div>\n\n    <!-- Where you type commands --\>\n    <div class="cmd_kbd stack_children">\n      <div class="cmd_completion" save="${cliInputView._completer}"></div>\n      <div>\n        <input class="cmd_input" type="text" save="${cliInputView._inputer}"/>\n      </div>\n    </div>\n\n  </div>\n\n</div>\n'},
t)});bespin.tiki.register("::editing_commands",{name:"editing_commands",dependencies:{}});
bespin.tiki.module("editing_commands:index",function(y,t){var v=y("environment").env;t.findCommand=function(s,g){if("value"in s){var e=v.view,b=e.editor.searchController,d=e.getSelectedRange(),k="";b.setSearchText(s.value,false);if(b=b.findNext(d.end,true)){e.setSelection(b,true);e.focus()}else k+="<i>No matches found</i><br>";k+='Searching for "'+s.value+'"';g.done(k)}else v.commandLine.setInput("find ")};t.gotoCommand=function(s){if("line"in s){var g=v.view;g.moveCursorTo({row:s.line-1,col:0});
g.focus()}else v.commandLine.setInput("goto ")}});bespin.tiki.register("::environment",{name:"environment",dependencies:{settings:"0.0.0"}});
bespin.tiki.module("environment:index",function(y,t){var v=y("bespin:util/util"),s=y("bespin:console").console,g=y("bespin:plugins").catalog,e=y("settings").settings;t.Environment=function(){this.commandLine=null;window.addEventListener("resize",this.dimensionsChanged.bind(this),false)};Object.defineProperties(t.Environment.prototype,{settings:{value:{set:function(b,d){if(v.none(b))throw new Error("setSetting(): key must be supplied");if(v.none(d))throw new Error("setSetting(): value must be supplied");
e.set(b,d)},get:function(b){if(v.none(b))throw new Error("getSetting(): key must be supplied");return e.get(b)}}},dimensionsChanged:{value:function(){g.publish(this,"dimensionsChanged")}},session:{get:function(){return g.getObject("session")}},view:{get:function(){if(!this.session)return null;return this.session.currentView}},editor:{get:function(){if(!this.session)return null;return this.session.currentView.editor}},contexts:{get:function(){if(!this.view)return[];var b=this.view.editor.layoutManager.syntaxManager,
d=this.view.getSelectedRange().start;return b.contextsAtPosition(d)}},buffer:{get:function(){if(this.session)return this.view.editor.buffer;else s.error("command attempted to get buffer but there's no session")}},model:{get:function(){if(this.buffer)return this.view.editor.layoutManager.textStorage;else s.error("Session has no current buffer")}},file:{get:function(){if(this.buffer)return this.buffer.file;else s.error("Session has no current buffer")}},files:{get:function(){return g.getObject("files")}}});
t.env=new t.Environment});bespin.tiki.register("::ctags",{name:"ctags",dependencies:{traits:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("ctags:index",function(y,t){var v=y("underscore")._,s=y("./reader").TagReader;y=y("traits").Trait;t.Tags=function(){this.tags=[]};t.Tags.prototype=Object.create(Object.prototype,y.compose(y({_search:function(g,e){var b={name:g};g=this.tags;var d=v(g).sortedIndex(b,function(k){return k.name});for(d=b=d;b>=0&&b<g.length&&e(g[b]);)b--;for(;d>=0&&d<g.length&&e(g[d]);)d++;return g.slice(b+1,d)},add:function(g){var e=this.tags;Array.prototype.push.apply(e,g);e.sort(function(b,d){b=b.name;
d=d.name;if(b<d)return-1;if(b===d)return 0;return 1})},get:function(g){return this._search(g,function(e){return e.name===g})},scan:function(g,e,b){if(b===null||b===undefined)b={};var d=g.split("\n");g=parse(g,e,1);e=new Interpreter(g,e,d,b);e.interpret();this.add(e.tags)},stem:function(g){var e=g.length;return this._search(g,function(b){return b.name.substring(0,e)===g})}}),s))});
bespin.tiki.module("ctags:reader",function(y,t){var v=y("underscore")._;y=y("traits").Trait;t.TagReader=y({readLines:function(s){var g=[];v(s).each(function(e){e=e.split("\t");if(!(e.length<3)){var b=e[0];if(!/^!_TAG_/.test(b)){b={name:b,tagfile:e[1],addr:e[2]};var d;if(e.length>3&&e[3].indexOf(":")===-1){b.kind=e[3];d=4}else d=3;var k={};v(e.slice(d)).each(function(h){h=/^([^:]+):(.*)/.exec(h);k[h[1]]=h[2]});b.fields=k;g.push(b)}}});this.add(g)},readString:function(s){this.readLines(s.split("\n"))}})});
bespin.tiki.register("::templater",{name:"templater",dependencies:{}});
bespin.tiki.module("templater:index",function(y,t){function v(k,h){var i=true;if(k.attributes&&k.attributes.length)for(var j=Array.prototype.slice.call(k.attributes),m=0;m<j.length;m++){var o=j[m].value,x=j[m].name;if(x==="save"){o=g(o);e(o,h,k);k.removeAttribute(x)}else if(x==="if"){o=g(o);try{i=!!b(o,h)}catch(u){console.error("Error with '",o,"'",u);i=false}i||k.parentNode.removeChild(k);k.removeAttribute(x)}else if(x==="foreach"){o=g(o);i=false;try{b(o,h).forEach(function(F){var p=k.cloneNode(true);
k.parentNode.insertBefore(p,k);h.param=F;s(p,h);delete h.param});k.parentNode.removeChild(k)}catch(f){console.error("Error with '",o,"'",f);i=false}k.removeAttribute(x)}else if(x.substring(0,2)==="on"){o=g(o);var A=e(o,h);typeof A!=="function"&&console.error("Expected "+o+" to resolve to a function, but got ",typeof A);k.removeAttribute(x);o=k.hasAttribute("capture"+x.substring(2));k.addEventListener(x.substring(2),A,o)}else{A=o.replace(/\$\{[^}]*\}/,function(F){return b(F.slice(2,-1),h)});if(x.indexOf("_")===
0){k.removeAttribute(x);k.setAttribute(x.substring(1),A)}else if(o!==A)j[m].value=A}}i&&s(k,h);if(k.nodeType===3){o=k.textContent;o=o.replace(/\$\{([^}]*)\}/,"\uf001$$$1\uf002");i=o.split(/\uF001|\uF002/);if(i.length>1){i.forEach(function(F){if(!(!F||F==="")){if(F.charAt(0)==="$")F=b(F.slice(1),h);if(typeof F.cloneNode!=="function")F=document.createTextNode(F.toString());k.parentNode.insertBefore(F,k)}});k.parentNode.removeChild(k)}A=o.replace(/\$\{[^}]*\}/,function(F){return b(F.slice(2,-1),h)});
if(o!==A)k.textContent=A}}function s(k,h){k=Array.prototype.slice.call(k.childNodes);for(var i=0;i<k.length;i++)v(k[i],h)}function g(k){if(!k.match(/\$\{.*\}/)){console.error("Expected "+k+" to match ${...}");return k}return k.slice(2,-1)}function e(k,h,i){if(typeof k==="string")k=k.split(".");var j=h[k[0]];if(k.length===1){if(i!==undefined)h[k[0]]=i;if(typeof j==="function")return j.bind(h);return j}if(!j){console.error("Can't find path=",k," in data=",h);return null}return e(k.slice(1),j,i)}function b(k,
h){with(h)return eval(k)}function d(k){var h=k.lastIndexOf(".");return k.substring(0,h)}t.processTemplate=function(k,h){h=h||{};var i=document.createElement("div");i.innerHTML=k;v(i,h);return i};t.compile=function(k){return function(h){return t.processTemplate(k,h)}};t.compileAll=function(k,h){if("undefined"===typeof h)h={};Object.keys(k).forEach(function(i){h[d(i)]=t.compile(k[i])});return h}});bespin.tiki.register("::matcher",{name:"matcher",dependencies:{}});
bespin.tiki.module("matcher:quick",function(y,t){var v=y("matcher").Matcher;t.QuickMatcher=function(s){v.call(this,s)};t.QuickMatcher.prototype=new v("subclassPrototype");t.QuickMatcher.prototype.score=function(s,g){s=s.toLowerCase();var e=g.name.toLowerCase();g=g.path?g.path.toLowerCase():null;if(e.substring(0,s.length)===s)return 5E3-e.length;if(g&&g.substring(0,s.length)===s)return 4E3-g.length;if(e.substring(e.length-s.length,e.length)===s)return 3E3-e.length;if(g)e=g+e;g=s.substring(0,1);for(var b=
0,d=2E3,k=0;k<e.length;k++)if(e.substring(k,k+1)===g){b++;if(b===s.length)return d;g=s.substring(b,b+1)}else b!==0&&d--;return 0}});bespin.tiki.module("matcher:prefix",function(y,t){var v=y("matcher").Matcher;t.PrefixMatcher=function(s){v.call(this,s)};t.PrefixMatcher.prototype=new v("subclassPrototype");t.PrefixMatcher.prototype.score=function(s,g){var e=s.length;if(e>g.name.length)return 0;if(g.name.substring(0,e).toLowerCase()===s.toLowerCase())return 1E3-g.name.length;return 0}});
bespin.tiki.module("matcher:index",function(y,t){t.Matcher=function(v){if(v!=="subclassPrototype"){this._query=v;this._scoredItems=[];this._listeners=[];this._maxScore=null}};Object.defineProperties(t.Matcher.prototype,{query:{get:function(){return this._query},set:function(v){this._query=v;var s=[];this._scoredItems.forEach(function(g){g.score=this.score(this._query,g.item);g.score>0&&s.push(g.item)},this);this._callListeners("itemsCleared");this._callListeners("itemsAdded",s)}},addItem:{value:function(v){this.addItems([v])}},
addItems:{value:function(v){var s=[],g=false;v.forEach(function(d){d={score:this.score(this._query,d),item:d};d.score>0&&s.push(d);if(d.score>this._maxScore){this._maxScore=d.score;g=true}this._scoredItems.push(d)},this);var e=false;g&&this._scoredItems.forEach(function(d){if(d.score+500<this._maxScore)e=true});v=function(d,k){return k.score-d.score};this._scoredItems.sort(v);s.sort(v);if(e){this._callListeners("itemsCleared");v=this._scoredItems}else v=s;var b=[];v.forEach(function(d){d.score+500>
this._maxScore&&b.push(d.item)}.bind(this));this._callListeners("itemsAdded",b)}},addListener:{value:function(v){this._listeners.push(v);var s=[];this._scoredItems.forEach(function(g){g.score>0&&s.push(g.item)},this);typeof v.itemsAdded==="function"&&v.itemsAdded(s)}},_callListeners:{value:function(){var v=Array.prototype.slice.call(arguments),s=v.shift();this._listeners.forEach(function(g){typeof g[s]==="function"&&g[s].apply(null,v)})}}})});
bespin.tiki.register("::theme_manager",{name:"theme_manager",dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"}});
bespin.tiki.module("theme_manager:index",function(y,t){y("bespin:promise");var v=y("bespin:plugins").catalog;y("events");var s=y("themestyles"),g=y("settings").settings,e=null,b=null;t.themestyles=s;t.themeSettingChanged=function(d,k,h){var i=v.getExtensionByKey("theme",h);if(h==="standard"||!h||!i){i=null;if(b!==null)i=v.getExtensionByKey("theme",b)}if(i)i.load().then(function(j){e&&s.unregisterThemeStyles(e);s.currentThemeVariables=j();e=i;s.parseGlobalVariables();s.reparse();i.url&&s.registerThemeStyles(i);
v.publish(t,"themeChange")});else if(e){s.unregisterThemeStyles(e);e=null;s.currentThemeVariables=null;s.parseGlobalVariables();s.reparse();v.publish(this,"themeChange")}};v.registerExtension("settingChange",{match:"theme",pointer:t.themeSettingChanged.bind(t)});t.setStandardTheme=function(d){b=d;d!==g.get("theme")&&t.themeSettingChanged(this)};t.setBasePlugin=function(d){s.basePluginName=d};t.startParsing=function(){s.preventParsing=false;return s.reparse()};t.registerTheme=function(d){var k=g.get("theme");
d.name===k&&t.themeSettingChanged(this,"theme",d.name)};t.unregisterTheme=function(d){d.name===g.get("theme")&&t.themeSettingChanged(this)};t.appLaunched=function(){v.publish(t,"themeChange")}});
bespin.tiki.module("theme_manager:themestyles",function(y,t){var v=y("bespin:util/util"),s=y("bespin:plugins").catalog,g=y("bespin:console").console,e=y("bespin:promise").Promise,b=y("bespin:promise").group,d=y("bespin:proxy"),k=new (y("less").Parser)({optimization:3}),h=1;t.currentThemeVariables=null;t.basePluginName=null;t.preventParsing=true;var i="";t.globalThemeVariables={};var j={},m={},o=function(z){var E={},G=[],N=function(W,$){G.push(W);if(typeof $!="object")E[G.join("_")]=$;else for(prop in $)N(prop,
$[prop]);G.pop()};N("global",z);return E},x={},u={font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",error_color:"#F99",header_color:"white",link_color:"#ACF",control:{color:"#E1B41F",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.2)",active:{color:"#FF9600",border:"1px solid #E1B41F",inset_color:"#ff9600",background:"rgba(0, 0, 0, 0.2)"}},pane:{h1:{font:"'MuseoSans', Helvetica",
font_size:"2.8em",color:"white"},color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",link_color:"white",background:"#45443C",border_radius:".5em"},form:{color:"white",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",font:"'Lucida Sans','Lucida Grande',Verdana,Arial,sans-serif",font_size:"@global_font_size",line_height:"@global_line_height"},button:{color:"white",background:"#3E6CB9"},container:{background:"#1E1916",border:"1px solid black"},selectable:{color:"white",border:"0px solid transparent",background:"transparent",
active:{color:"black",border:"0px solid transparent",background:"#FF8E00"},hover:{color:"black",border:"0px solid transparent",background:"#FF8E00"}},hint:{color:"#AAA",active:{color:"black"},hover:{color:"black"}},accelerator:{color:"#996633",active:{color:"black"},hover:{color:"black"}},menu:{border_color:"black",inset_color_right:"#1E1916",inset_color_top_left:"#3E3936",background:"transparent"}};u=o(u);t.getPluginThemeVariables=function(z){var E=s.plugins[z];if(!E)return null;var G={};if(t.currentThemeVariables&&
t.currentThemeVariables[z])G=t.currentThemeVariables[z];E.provides.forEach(function(N){if(N.ep==="themevariable"){var W=N.name;G[W]=G[W]||N.defaultValue}});return G};t.parseGlobalVariables=function(){var z={},E="",G=t.currentThemeVariables;v.mixin(z,u);G&&G.global&&v.mixin(z,o(G.global));t.globalThemeVariables=z;for(prop in z)E+="@"+prop+":"+z[prop]+";";i=E};t.parseGlobalVariables();var f=function(z,E,G){if(j[E])styleElem=document.getElementById("_bespin_theme_style_"+j[E]);else{styleElem=document.createElement("style");
styleElem.setAttribute("id","_bespin_theme_style_"+h);j[E]=h;h++;document.body.appendChild(styleElem)}k.parse(i+G+m[E],function(N,W){if(N){N="Error less parsing "+E+" "+N.message;g.error(N);z.reject(N)}else{try{var $=W.toCSS()}catch(ea){N="Error less parsing "+E+" "+ea;g.error(N);z.reject(N);return}if(styleElem&&styleElem.firstChild)styleElem.firstChild.textContent=$;else{N=document.createTextNode($);styleElem.appendChild(N)}z.resolve()}})},A={};t.parsePlugin=function(z){if(t.preventParsing)return(new e).resolve();
var E=s.plugins[z];if(!E)throw"reparsePlugin: plugin "+z+" is not defined!";if(!A[z]){A[z]=new e;setTimeout(function(){var G=t.getPluginThemeVariables(z),N="";for(prop in G)N+="@"+prop+":"+G[prop]+";";G=new e;G.then(function(W){A[this.name].resolve(W);A[this.name]=null}.bind(this),function(){A[this.name].reject(data);A[this.name]=null}.bind(this));f(G,z,N)}.bind(E),0)}return A[z]};var F=function(z,E,G,N){G=G.replace(/url\(['"]*([^'")]*)(['"]*)\)/g,"url("+z+"$1)");m[E]+=G;N&&N.resolve()},p=null;t.registerThemeStyles=
function(z){var E=z.getPluginName(),G=s.getResourceURL(E);if(!(z.url instanceof Array))z.url=[z.url];m[E]="";var N=[],W=t.preventParsing;z.url.forEach(function($){if(x[E]&&x[E][$])F(G,E,x[E][$]);else{var ea=new e;N.push(ea);var Y=G+$+"?"+(new Date).getTime();d.xhr("GET",Y,true,function(da){da.overrideMimeType("text/plain")}).then(function(da){F(G,E,da,ea)},function(){g.error("registerLessFile: Could not load "+G+$);ea.resolve()})}});if(N.length===0)t.parsePlugin(E);else{W||b(N).then(function(){t.parsePlugin(E)});
if(p!==null)N=N.concat(p);p=b(N)}};t.reparse=function(){var z=new e;if(t.preventParsing)return z.resolve();p?p.then(function(){var E=[],G=t.basePluginName;G!==null&&m[G]&&E.push(t.parsePlugin(G));for(var N in m)N!==G&&E.push(t.parsePlugin(N));b(E).then(z.resolve.bind(z),z.reject.bind(z))},function(E){z.reject(E)}):z.resolve();return z};t.unregisterThemeStyles=function(z){z=z.getPluginName();if(j[z]){var E=document.getElementById("_bespin_theme_style_"+j[z]);E.parentNode.removeChild(E);delete j[z];
delete m[z]}}});bespin.tiki.register("::jquery",{name:"jquery",dependencies:{}});
bespin.tiki.module("jquery:index",function(y,t){function v(){if(!f.isReady){try{p.documentElement.doScroll("left")}catch(a){setTimeout(v,1);return}f.ready()}}function s(a,l){l.src?f.ajax({url:l.src,async:false,dataType:"script"}):f.globalEval(l.text||l.textContent||l.innerHTML||"");l.parentNode&&l.parentNode.removeChild(l)}function g(a,l,n,r,q,C){var D=a.length;if(typeof l==="object"){for(var L in l)g(a,L,l[L],r,q,n);return a}if(n!==undefined){r=!C&&r&&f.isFunction(n);for(L=0;L<D;L++)q(a[L],l,r?n.call(a[L],
L,q(a[L],l)):n,C);return a}return D?q(a[0],l):undefined}function e(){return(new Date).getTime()}function b(){return false}function d(){return true}function k(a,l,n){n[0].type=a;return f.event.handle.apply(l,n)}function h(a){var l,n=[],r=[],q=arguments,C,D,L,H,K,R;D=f.data(this,"events");if(!(a.liveFired===this||!D||!D.live||a.button&&a.type==="click")){a.liveFired=this;var V=D.live.slice(0);for(H=0;H<V.length;H++){D=V[H];D.origType.replace(ua,"")===a.type?r.push(D.selector):V.splice(H--,1)}C=f(a.target).closest(r,
a.currentTarget);K=0;for(R=C.length;K<R;K++)for(H=0;H<V.length;H++){D=V[H];if(C[K].selector===D.selector){L=C[K].elem;r=null;if(D.preType==="mouseenter"||D.preType==="mouseleave")r=f(a.relatedTarget).closest(D.selector)[0];if(!r||r!==L)n.push({elem:L,handleObj:D})}}K=0;for(R=n.length;K<R;K++){C=n[K];a.currentTarget=C.elem;a.data=C.handleObj.data;a.handleObj=C.handleObj;if(C.handleObj.origHandler.apply(C.elem,q)===false){l=false;break}}return l}}function i(a,l){return"live."+(a&&a!=="*"?a+".":"")+
l.replace(/\./g,"`").replace(/ /g,"&")}function j(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function m(a,l){var n=0;l.each(function(){if(this.nodeName===(a[n]&&a[n].nodeName)){var r=f.data(a[n++]),q=f.data(this,r);if(r=r&&r.events){delete q.handle;q.events={};for(var C in r)for(var D in r[C])f.event.add(this,C,r[C][D],r[C][D].data)}}})}function o(a,l,n){var r,q,C;l=l&&l[0]?l[0].ownerDocument||l[0]:p;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&l===p&&!Ia.test(a[0])&&(f.support.checkClone||
!Ja.test(a[0]))){q=true;if(C=f.fragments[a[0]])if(C!==1)r=C}if(!r){r=l.createDocumentFragment();f.clean(a,l,r,n)}if(q)f.fragments[a[0]]=C?r:1;return{fragment:r,cacheable:q}}function x(a,l){var n={};f.each(Ka.concat.apply([],Ka.slice(0,l)),function(){n[this]=a});return n}function u(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var f=function(a,l){return new f.fn.init(a,l)},A=window.jQuery,F=window.$,p=window.document,z,E=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,
G=/^.[^:#\[\.,]*$/,N=/\S/,W=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,$=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;y=navigator.userAgent;var ea=false,Y=[],da,ia=Object.prototype.toString,ma=Object.prototype.hasOwnProperty,na=Array.prototype.push,oa=Array.prototype.slice,ta=Array.prototype.indexOf;f.fn=f.prototype={init:function(a,l){var n,r;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!l){this.context=p;this[0]=p.body;this.selector="body";this.length=1;return this}if(typeof a===
"string")if((n=E.exec(a))&&(n[1]||!l))if(n[1]){r=l?l.ownerDocument||l:p;if(a=$.exec(a))if(f.isPlainObject(l)){a=[p.createElement(a[1])];f.fn.attr.call(a,l,true)}else a=[r.createElement(a[1])];else{a=o([n[1]],[r]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return f.merge(this,a)}else{if(l=p.getElementById(n[2])){if(l.id!==n[2])return z.find(a);this.length=1;this[0]=l}this.context=p;this.selector=a;return this}else if(!l&&/^\w+$/.test(a)){this.selector=a;this.context=p;a=p.getElementsByTagName(a);
return f.merge(this,a)}else return!l||l.jquery?(l||z).find(a):f(l).find(a);else if(f.isFunction(a))return z.ready(a);if(a.selector!==undefined){this.selector=a.selector;this.context=a.context}return f.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return oa.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,l,n){var r=f();f.isArray(a)?na.apply(r,a):f.merge(r,a);r.prevObject=this;
r.context=this.context;if(l==="find")r.selector=this.selector+(this.selector?" ":"")+n;else if(l)r.selector=this.selector+"."+l+"("+n+")";return r},each:function(a,l){return f.each(this,a,l)},ready:function(a){f.bindReady();if(f.isReady)a.call(p,f);else Y&&Y.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(oa.apply(this,arguments),"slice",oa.call(arguments).join(","))},
map:function(a){return this.pushStack(f.map(this,function(l,n){return a.call(l,n,l)}))},end:function(){return this.prevObject||f(null)},push:na,sort:[].sort,splice:[].splice};f.fn.init.prototype=f.fn;f.extend=f.fn.extend=function(){var a=arguments[0]||{},l=1,n=arguments.length,r=false,q,C,D,L;if(typeof a==="boolean"){r=a;a=arguments[1]||{};l=2}if(typeof a!=="object"&&!f.isFunction(a))a={};if(n===l){a=this;--l}for(;l<n;l++)if((q=arguments[l])!=null)for(C in q){D=a[C];L=q[C];if(a!==L)if(r&&L&&(f.isPlainObject(L)||
f.isArray(L))){D=D&&(f.isPlainObject(D)||f.isArray(D))?D:f.isArray(L)?[]:{};a[C]=f.extend(r,D,L)}else if(L!==undefined)a[C]=L}return a};f.extend({noConflict:function(a){window.$=F;if(a)window.jQuery=A;return f},isReady:false,ready:function(){if(!f.isReady){if(!p.body)return setTimeout(f.ready,13);f.isReady=true;if(Y){for(var a,l=0;a=Y[l++];)a.call(p,f);Y=null}f.fn.triggerHandler&&f(p).triggerHandler("ready")}},bindReady:function(){if(!ea){ea=true;if(p.readyState==="complete")return f.ready();if(p.addEventListener){p.addEventListener("DOMContentLoaded",
da,false);window.addEventListener("load",f.ready,false)}else if(p.attachEvent){p.attachEvent("onreadystatechange",da);window.attachEvent("onload",f.ready);var a=false;try{a=window.frameElement==null}catch(l){}p.documentElement.doScroll&&a&&v()}}},isFunction:function(a){return ia.call(a)==="[object Function]"},isArray:function(a){return ia.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||ia.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!ma.call(a,
"constructor")&&!ma.call(a.constructor.prototype,"isPrototypeOf"))return false;var l;for(l in a);return l===undefined||ma.call(a,l)},isEmptyObject:function(a){for(var l in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=f.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return window.JSON&&
window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))();else f.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&N.test(a)){var l=p.getElementsByTagName("head")[0]||p.documentElement,n=p.createElement("script");n.type="text/javascript";if(f.support.scriptEval)n.appendChild(p.createTextNode(a));else n.text=a;l.insertBefore(n,l.firstChild);l.removeChild(n)}},nodeName:function(a,l){return a.nodeName&&a.nodeName.toUpperCase()===l.toUpperCase()},each:function(a,l,n){var r,
q=0,C=a.length,D=C===undefined||f.isFunction(a);if(n)if(D)for(r in a){if(l.apply(a[r],n)===false)break}else for(;q<C;){if(l.apply(a[q++],n)===false)break}else if(D)for(r in a){if(l.call(a[r],r,a[r])===false)break}else for(n=a[0];q<C&&l.call(n,q,n)!==false;n=a[++q]);return a},trim:function(a){return(a||"").replace(W,"")},makeArray:function(a,l){l=l||[];if(a!=null)a.length==null||typeof a==="string"||f.isFunction(a)||typeof a!=="function"&&a.setInterval?na.call(l,a):f.merge(l,a);return l},inArray:function(a,
l){if(l.indexOf)return l.indexOf(a);for(var n=0,r=l.length;n<r;n++)if(l[n]===a)return n;return-1},merge:function(a,l){var n=a.length,r=0;if(typeof l.length==="number")for(var q=l.length;r<q;r++)a[n++]=l[r];else for(;l[r]!==undefined;)a[n++]=l[r++];a.length=n;return a},grep:function(a,l,n){for(var r=[],q=0,C=a.length;q<C;q++)!n!==!l(a[q],q)&&r.push(a[q]);return r},map:function(a,l,n){for(var r=[],q,C=0,D=a.length;C<D;C++){q=l(a[C],C,n);if(q!=null)r[r.length]=q}return r.concat.apply([],r)},guid:1,proxy:function(a,
l,n){if(arguments.length===2)if(typeof l==="string"){n=a;a=n[l];l=undefined}else if(l&&!f.isFunction(l)){n=l;l=undefined}if(!l&&a)l=function(){return a.apply(n||this,arguments)};if(a)l.guid=a.guid=a.guid||l.guid||f.guid++;return l},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});
y=f.uaMatch(y);if(y.browser){f.browser[y.browser]=true;f.browser.version=y.version}if(f.browser.webkit)f.browser.safari=true;if(ta)f.inArray=function(a,l){return ta.call(l,a)};z=f(p);if(p.addEventListener)da=function(){p.removeEventListener("DOMContentLoaded",da,false);f.ready()};else if(p.attachEvent)da=function(){if(p.readyState==="complete"){p.detachEvent("onreadystatechange",da);f.ready()}};(function(){f.support={};var a=p.documentElement,l=p.createElement("script"),n=p.createElement("div"),r=
"script"+e();n.style.display="none";n.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var q=n.getElementsByTagName("*"),C=n.getElementsByTagName("a")[0];if(!(!q||!q.length||!C)){f.support={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/red/.test(C.getAttribute("style")),hrefNormalized:C.getAttribute("href")==="/a",opacity:/^0.55$/.test(C.style.opacity),
cssFloat:!!C.style.cssFloat,checkOn:n.getElementsByTagName("input")[0].value==="on",optSelected:p.createElement("select").appendChild(p.createElement("option")).selected,parentNode:n.removeChild(n.appendChild(p.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};l.type="text/javascript";try{l.appendChild(p.createTextNode("window."+r+"=1;"))}catch(D){}a.insertBefore(l,a.firstChild);if(window[r]){f.support.scriptEval=true;delete window[r]}try{delete l.test}catch(L){f.support.deleteExpando=
false}a.removeChild(l);if(n.attachEvent&&n.fireEvent){n.attachEvent("onclick",function H(){f.support.noCloneEvent=false;n.detachEvent("onclick",H)});n.cloneNode(true).fireEvent("onclick")}n=p.createElement("div");n.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=p.createDocumentFragment();a.appendChild(n.firstChild);f.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;f(function(){var H=p.createElement("div");H.style.width=H.style.paddingLeft="1px";p.body.appendChild(H);
f.boxModel=f.support.boxModel=H.offsetWidth===2;p.body.removeChild(H).style.display="none"});a=function(H){var K=p.createElement("div");H="on"+H;var R=H in K;if(!R){K.setAttribute(H,"return;");R=typeof K[H]==="function"}return R};f.support.submitBubbles=a("submit");f.support.changeBubbles=a("change");a=l=n=q=C=null}})();f.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",
frameborder:"frameBorder"};var M="jQuery"+e(),Q=0,S={};f.extend({cache:{},expando:M,noData:{embed:true,object:true,applet:true},data:function(a,l,n){if(!(a.nodeName&&f.noData[a.nodeName.toLowerCase()])){a=a==window?S:a;var r=a[M],q=f.cache;if(!r&&typeof l==="string"&&n===undefined)return null;r||(r=++Q);if(typeof l==="object"){a[M]=r;q[r]=f.extend(true,{},l)}else if(!q[r]){a[M]=r;q[r]={}}a=q[r];if(n!==undefined)a[l]=n;return typeof l==="string"?a[l]:a}},removeData:function(a,l){if(!(a.nodeName&&f.noData[a.nodeName.toLowerCase()])){a=
a==window?S:a;var n=a[M],r=f.cache,q=r[n];if(l){if(q){delete q[l];f.isEmptyObject(q)&&f.removeData(a)}}else{if(f.support.deleteExpando)delete a[f.expando];else a.removeAttribute&&a.removeAttribute(f.expando);delete r[n]}}}});f.fn.extend({data:function(a,l){if(typeof a==="undefined"&&this.length)return f.data(this[0]);else if(typeof a==="object")return this.each(function(){f.data(this,a)});var n=a.split(".");n[1]=n[1]?"."+n[1]:"";if(l===undefined){var r=this.triggerHandler("getData"+n[1]+"!",[n[0]]);
if(r===undefined&&this.length)r=f.data(this[0],a);return r===undefined&&n[1]?this.data(n[0]):r}else return this.trigger("setData"+n[1]+"!",[n[0],l]).each(function(){f.data(this,a,l)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}});f.extend({queue:function(a,l,n){if(a){l=(l||"fx")+"queue";var r=f.data(a,l);if(!n)return r||[];if(!r||f.isArray(n))r=f.data(a,l,f.makeArray(n));else r.push(n);return r}},dequeue:function(a,l){l=l||"fx";var n=f.queue(a,l),r=n.shift();if(r===
"inprogress")r=n.shift();if(r){l==="fx"&&n.unshift("inprogress");r.call(a,function(){f.dequeue(a,l)})}}});f.fn.extend({queue:function(a,l){if(typeof a!=="string"){l=a;a="fx"}if(l===undefined)return f.queue(this[0],a);return this.each(function(){var n=f.queue(this,a,l);a==="fx"&&n[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,l){a=f.fx?f.fx.speeds[a]||a:a;l=l||"fx";return this.queue(l,function(){var n=this;setTimeout(function(){f.dequeue(n,
l)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var T=/[\n\t]/g,aa=/\s+/,ha=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,cb=/^(a|area)$/i,La=/radio|checkbox/;f.fn.extend({attr:function(a,l){return g(this,a,l,true,f.attr)},removeAttr:function(a){return this.each(function(){f.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(f.isFunction(a))return this.each(function(K){var R=f(this);R.addClass(a.call(this,
K,R.attr("class")))});if(a&&typeof a==="string")for(var l=(a||"").split(aa),n=0,r=this.length;n<r;n++){var q=this[n];if(q.nodeType===1)if(q.className){for(var C=" "+q.className+" ",D=q.className,L=0,H=l.length;L<H;L++)if(C.indexOf(" "+l[L]+" ")<0)D+=" "+l[L];q.className=f.trim(D)}else q.className=a}return this},removeClass:function(a){if(f.isFunction(a))return this.each(function(H){var K=f(this);K.removeClass(a.call(this,H,K.attr("class")))});if(a&&typeof a==="string"||a===undefined)for(var l=(a||
"").split(aa),n=0,r=this.length;n<r;n++){var q=this[n];if(q.nodeType===1&&q.className)if(a){for(var C=(" "+q.className+" ").replace(T," "),D=0,L=l.length;D<L;D++)C=C.replace(" "+l[D]+" "," ");q.className=f.trim(C)}else q.className=""}return this},toggleClass:function(a,l){var n=typeof a,r=typeof l==="boolean";if(f.isFunction(a))return this.each(function(q){var C=f(this);C.toggleClass(a.call(this,q,C.attr("class"),l),l)});return this.each(function(){if(n==="string")for(var q,C=0,D=f(this),L=l,H=a.split(aa);q=
H[C++];){L=r?L:!D.hasClass(q);D[L?"addClass":"removeClass"](q)}else if(n==="undefined"||n==="boolean"){this.className&&f.data(this,"__className__",this.className);this.className=this.className||a===false?"":f.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var l=0,n=this.length;l<n;l++)if((" "+this[l].className+" ").replace(T," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===undefined){var l=this[0];if(l){if(f.nodeName(l,"option"))return(l.attributes.value||
{}).specified?l.value:l.text;if(f.nodeName(l,"select")){var n=l.selectedIndex,r=[],q=l.options;l=l.type==="select-one";if(n<0)return null;var C=l?n:0;for(n=l?n+1:q.length;C<n;C++){var D=q[C];if(D.selected){a=f(D).val();if(l)return a;r.push(a)}}return r}if(La.test(l.type)&&!f.support.checkOn)return l.getAttribute("value")===null?"on":l.value;return(l.value||"").replace(ha,"")}}else{var L=f.isFunction(a);return this.each(function(H){var K=f(this),R=a;if(this.nodeType===1){if(L)R=a.call(this,H,K.val());
if(typeof R==="number")R+="";if(f.isArray(R)&&La.test(this.type))this.checked=f.inArray(K.val(),R)>=0;else if(f.nodeName(this,"select")){var V=f.makeArray(R);f("option",this).each(function(){this.selected=f.inArray(f(this).val(),V)>=0});if(!V.length)this.selectedIndex=-1}else this.value=R}})}}});f.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,l,n,r){if(!(!a||a.nodeType===3||a.nodeType===8)){if(r&&l in f.attrFn)return f(a)[l](n);
r=a.nodeType!==1||!f.isXMLDoc(a);var q=n!==undefined;l=r&&f.props[l]||l;if(a.nodeType===1){var C=$a.test(l);if(l in a&&r&&!C){if(q){l==="type"&&ab.test(a.nodeName)&&a.parentNode&&f.error("type property can't be changed");a[l]=n}if(f.nodeName(a,"form")&&a.getAttributeNode(l))return a.getAttributeNode(l).nodeValue;if(l==="tabIndex")return(l=a.getAttributeNode("tabIndex"))&&l.specified?l.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:undefined;return a[l]}if(!f.support.style&&r&&l==="style"){if(q)a.style.cssText=
""+n;return a.style.cssText}q&&a.setAttribute(l,""+n);a=!f.support.hrefNormalized&&r&&C?a.getAttribute(l,2):a.getAttribute(l);return a===null?undefined:a}return f.style(a,l,n)}}});var ua=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,function(l){return"\\"+l})};f.event={add:function(a,l,n,r){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==window&&!a.frameElement)a=window;var q,C;if(n.handler){q=n;n=q.handler}if(!n.guid)n.guid=f.guid++;if(C=f.data(a)){var D=C.events=C.events||
{},L=C.handle;if(!L)C.handle=L=function(){return typeof f!=="undefined"&&!f.event.triggered?f.event.handle.apply(L.elem,arguments):undefined};L.elem=a;l=l.split(" ");for(var H,K=0,R;H=l[K++];){C=q?f.extend({},q):{handler:n,data:r};if(H.indexOf(".")>-1){R=H.split(".");H=R.shift();C.namespace=R.slice(0).sort().join(".")}else{R=[];C.namespace=""}C.type=H;C.guid=n.guid;var V=D[H],ca=f.event.special[H]||{};if(!V){V=D[H]=[];if(!ca.setup||ca.setup.call(a,r,R,L)===false)if(a.addEventListener)a.addEventListener(H,
L,false);else a.attachEvent&&a.attachEvent("on"+H,L)}if(ca.add){ca.add.call(a,C);if(!C.handler.guid)C.handler.guid=n.guid}V.push(C);f.event.global[H]=true}a=null}}},global:{},remove:function(a,l,n,r){if(!(a.nodeType===3||a.nodeType===8)){var q,C=0,D,L,H,K,R,V,ca=f.data(a),ga=ca&&ca.events;if(ca&&ga){if(l&&l.type){n=l.handler;l=l.type}if(!l||typeof l==="string"&&l.charAt(0)==="."){l=l||"";for(q in ga)f.event.remove(a,q+l)}else{for(l=l.split(" ");q=l[C++];){K=q;D=q.indexOf(".")<0;L=[];if(!D){L=q.split(".");
q=L.shift();H=new RegExp("(^|\\.)"+f.map(L.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(R=ga[q])if(n){K=f.event.special[q]||{};for(fa=r||0;fa<R.length;fa++){V=R[fa];if(n.guid===V.guid){if(D||H.test(V.namespace)){r==null&&R.splice(fa--,1);K.remove&&K.remove.call(a,V)}if(r!=null)break}}if(R.length===0||r!=null&&R.length===1){if(!K.teardown||K.teardown.call(a,L)===false)Ma(a,q,ca.handle);delete ga[q]}}else for(var fa=0;fa<R.length;fa++){V=R[fa];if(D||H.test(V.namespace)){f.event.remove(a,
K,V.handler,fa);R.splice(fa--,1)}}}if(f.isEmptyObject(ga)){if(l=ca.handle)l.elem=null;delete ca.events;delete ca.handle;f.isEmptyObject(ca)&&f.removeData(a)}}}}},trigger:function(a,l,n,r){var q=a.type||a;if(!r){a=typeof a==="object"?a[M]?a:f.extend(f.Event(q),a):f.Event(q);if(q.indexOf("!")>=0){a.type=q=q.slice(0,-1);a.exclusive=true}if(!n){a.stopPropagation();f.event.global[q]&&f.each(f.cache,function(){this.events&&this.events[q]&&f.event.trigger(a,l,this.handle.elem)})}if(!n||n.nodeType===3||n.nodeType===
8)return;a.result=undefined;a.target=n;l=f.makeArray(l);l.unshift(a)}a.currentTarget=n;(r=f.data(n,"handle"))&&r.apply(n,l);r=n.parentNode||n.ownerDocument;try{if(!(n&&n.nodeName&&f.noData[n.nodeName.toLowerCase()]))if(n["on"+q]&&n["on"+q].apply(n,l)===false)a.result=false}catch(C){}if(!a.isPropagationStopped()&&r)f.event.trigger(a,l,r,true);else if(!a.isDefaultPrevented()){r=a.target;var D,L=f.nodeName(r,"a")&&q==="click",H=f.event.special[q]||{};if((!H._default||H._default.call(n,a)===false)&&!L&&
!(r&&r.nodeName&&f.noData[r.nodeName.toLowerCase()])){try{if(r[q]){if(D=r["on"+q])r["on"+q]=null;f.event.triggered=true;r[q]()}}catch(K){}if(D)r["on"+q]=D;f.event.triggered=false}}},handle:function(a){var l,n,r,q;a=arguments[0]=f.event.fix(a||window.event);a.currentTarget=this;l=a.type.indexOf(".")<0&&!a.exclusive;if(!l){n=a.type.split(".");a.type=n.shift();r=new RegExp("(^|\\.)"+n.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}q=f.data(this,"events");n=q[a.type];if(q&&n){n=n.slice(0);q=0;for(var C=
n.length;q<C;q++){var D=n[q];if(l||r.test(D.namespace)){a.handler=D.handler;a.data=D.data;a.handleObj=D;D=D.handler.apply(this,arguments);if(D!==undefined){a.result=D;if(D===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[M])return a;var l=a;a=f.Event(l);for(var n=this.props.length,r;n;){r=this.props[--n];a[r]=l[r]}if(!a.target)a.target=a.srcElement||p;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){l=p.documentElement;n=p.body;a.pageX=a.clientX+(l&&l.scrollLeft||n&&n.scrollLeft||0)-(l&&l.clientLeft||n&&n.clientLeft||0);a.pageY=a.clientY+(l&&l.scrollTop||
n&&n.scrollTop||0)-(l&&l.clientTop||n&&n.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==undefined)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,a.origType,f.extend({},a,{handler:h}))},remove:function(a){var l=true,n=a.origType.replace(ua,"");f.each(f.data(this,
"events").live||[],function(){if(n===this.origType.replace(ua,""))return l=false});l&&f.event.remove(this,a.origType,h)}},beforeunload:{setup:function(a,l,n){if(this.setInterval)this.onbeforeunload=n;return false},teardown:function(a,l){if(this.onbeforeunload===l)this.onbeforeunload=null}}}};var Ma=p.removeEventListener?function(a,l,n){a.removeEventListener(l,n,false)}:function(a,l,n){a.detachEvent("on"+l,n)};f.Event=function(a){if(!this.preventDefault)return new f.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=e();this[M]=true};f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=d;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=d;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d;this.stopPropagation()},isDefaultPrevented:b,isPropagationStopped:b,
isImmediatePropagationStopped:b};var Na=function(a){var l=a.relatedTarget;try{for(;l&&l!==this;)l=l.parentNode;if(l!==this){a.type=a.data;f.event.handle.apply(this,arguments)}}catch(n){}},Oa=function(a){a.type=a.data;f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,l){f.event.special[a]={setup:function(n){f.event.add(this,l,n&&n.selector?Oa:Na,a)},teardown:function(n){f.event.remove(this,l,n&&n.selector?Oa:Na)}}});if(!f.support.submitBubbles)f.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){f.event.add(this,"click.specialSubmit",function(a){var l=a.target,n=l.type;if((n==="submit"||n==="image")&&f(l).closest("form").length)return k("submit",this,arguments)});f.event.add(this,"keypress.specialSubmit",function(a){var l=a.target,n=l.type;if((n==="text"||n==="password")&&f(l).closest("form").length&&a.keyCode===13)return k("submit",this,arguments)})}else return false},teardown:function(){f.event.remove(this,".specialSubmit")}};if(!f.support.changeBubbles){var za=
/textarea|input|select/i,Aa,Pa=function(a){var l=a.type,n=a.value;if(l==="radio"||l==="checkbox")n=a.checked;else if(l==="select-multiple")n=a.selectedIndex>-1?f.map(a.options,function(r){return r.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")n=a.selectedIndex;return n},Ba=function(a,l){var n=a.target,r,q;if(!(!za.test(n.nodeName)||n.readOnly)){r=f.data(n,"_change_data");q=Pa(n);if(a.type!=="focusout"||n.type!=="radio")f.data(n,"_change_data",q);if(!(r===undefined||q===r))if(r!=
null||q){a.type="change";return f.event.trigger(a,l,n)}}};f.event.special.change={filters:{focusout:Ba,click:function(a){var l=a.target,n=l.type;if(n==="radio"||n==="checkbox"||l.nodeName.toLowerCase()==="select")return Ba.call(this,a)},keydown:function(a){var l=a.target,n=l.type;if(a.keyCode===13&&l.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(n==="checkbox"||n==="radio")||n==="select-multiple")return Ba.call(this,a)},beforeactivate:function(a){a=a.target;f.data(a,"_change_data",Pa(a))}},
setup:function(){if(this.type==="file")return false;for(var a in Aa)f.event.add(this,a+".specialChange",Aa[a]);return za.test(this.nodeName)},teardown:function(){f.event.remove(this,".specialChange");return za.test(this.nodeName)}};Aa=f.event.special.change.filters}p.addEventListener&&f.each({focus:"focusin",blur:"focusout"},function(a,l){function n(r){r=f.event.fix(r);r.type=l;return f.event.handle.call(this,r)}f.event.special[l]={setup:function(){this.addEventListener(a,n,true)},teardown:function(){this.removeEventListener(a,
n,true)}}});f.each(["bind","one"],function(a,l){f.fn[l]=function(n,r,q){if(typeof n==="object"){for(var C in n)this[l](C,r,n[C],q);return this}if(f.isFunction(r)){q=r;r=undefined}var D=l==="one"?f.proxy(q,function(H){f(this).unbind(H,D);return q.apply(this,arguments)}):q;if(n==="unload"&&l!=="one")this.one(n,r,q);else{C=0;for(var L=this.length;C<L;C++)f.event.add(this[C],n,D,r)}return this}});f.fn.extend({unbind:function(a,l){if(typeof a==="object"&&!a.preventDefault)for(var n in a)this.unbind(n,
a[n]);else{n=0;for(var r=this.length;n<r;n++)f.event.remove(this[n],a,l)}return this},delegate:function(a,l,n,r){return this.live(l,n,r,a)},undelegate:function(a,l,n){return arguments.length===0?this.unbind("live"):this.die(l,null,n,a)},trigger:function(a,l){return this.each(function(){f.event.trigger(a,l,this)})},triggerHandler:function(a,l){if(this[0]){a=f.Event(a);a.preventDefault();a.stopPropagation();f.event.trigger(a,l,this[0]);return a.result}},toggle:function(a){for(var l=arguments,n=1;n<
l.length;)f.proxy(a,l[n++]);return this.click(f.proxy(a,function(r){var q=(f.data(this,"lastToggle"+a.guid)||0)%n;f.data(this,"lastToggle"+a.guid,q+1);r.preventDefault();return l[q].apply(this,arguments)||false}))},hover:function(a,l){return this.mouseenter(a).mouseleave(l||a)}});var Qa={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,l){f.fn[l]=function(n,r,q,C){var D,L=0,H,K,R=C||this.selector,V=C?this:f(this.context);if(f.isFunction(r)){q=
r;r=undefined}for(n=(n||"").split(" ");(D=n[L++])!=null;){C=ua.exec(D);H="";if(C){H=C[0];D=D.replace(ua,"")}if(D==="hover")n.push("mouseenter"+H,"mouseleave"+H);else{K=D;if(D==="focus"||D==="blur"){n.push(Qa[D]+H);D+=H}else D=(Qa[D]||D)+H;l==="live"?V.each(function(){f.event.add(this,i(D,R),{data:r,selector:R,handler:q,origType:D,origHandler:q,preType:K})}):V.unbind(i(D,R),q)}}return this}});f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,l){f.fn[l]=function(n){return n?this.bind(l,n):this.trigger(l)};if(f.attrFn)f.attrFn[l]=true});window.attachEvent&&!window.addEventListener&&window.attachEvent("onunload",function(){for(var a in f.cache)if(f.cache[a].handle)try{f.event.remove(f.cache[a].handle.elem)}catch(l){}});(function(){function a(w){for(var B="",I,J=0;w[J];J++){I=w[J];if(I.nodeType===3||I.nodeType===4)B+=I.nodeValue;else if(I.nodeType!==8)B+=a(I.childNodes)}return B}function l(w,B,I,J,P,O){P=0;for(var X=J.length;P<
X;P++){var U=J[P];if(U){U=U[w];for(var ba=false;U;){if(U.sizcache===I){ba=J[U.sizset];break}if(U.nodeType===1&&!O){U.sizcache=I;U.sizset=P}if(U.nodeName.toLowerCase()===B){ba=U;break}U=U[w]}J[P]=ba}}}function n(w,B,I,J,P,O){P=0;for(var X=J.length;P<X;P++){var U=J[P];if(U){U=U[w];for(var ba=false;U;){if(U.sizcache===I){ba=J[U.sizset];break}if(U.nodeType===1){if(!O){U.sizcache=I;U.sizset=P}if(typeof B!=="string"){if(U===B){ba=true;break}}else if(H.filter(B,[U]).length>0){ba=U;break}}U=U[w]}J[P]=ba}}}
var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,q=0,C=Object.prototype.toString,D=false,L=true;[0,0].sort(function(){L=false;return 0});var H=function(w,B,I,J){I=I||[];var P=B=B||p;if(B.nodeType!==1&&B.nodeType!==9)return[];if(!w||typeof w!=="string")return I;for(var O=[],X,U,ba,va,pa=true,ra=Z(B),qa=w;(r.exec(""),X=r.exec(qa))!==null;){qa=X[3];O.push(X[1]);if(X[2]){va=X[3];break}}if(O.length>1&&R.exec(w))if(O.length===
2&&K.relative[O[0]])U=Ca(O[0]+O[1],B);else for(U=K.relative[O[0]]?[B]:H(O.shift(),B);O.length;){w=O.shift();if(K.relative[w])w+=O.shift();U=Ca(w,U)}else{if(!J&&O.length>1&&B.nodeType===9&&!ra&&K.match.ID.test(O[0])&&!K.match.ID.test(O[O.length-1])){X=H.find(O.shift(),B,ra);B=X.expr?H.filter(X.expr,X.set)[0]:X.set[0]}if(B){X=J?{expr:O.pop(),set:ca(J)}:H.find(O.pop(),O.length===1&&(O[0]==="~"||O[0]==="+")&&B.parentNode?B.parentNode:B,ra);U=X.expr?H.filter(X.expr,X.set):X.set;if(O.length>0)ba=ca(U);
else pa=false;for(;O.length;){var ja=O.pop();X=ja;if(K.relative[ja])X=O.pop();else ja="";if(X==null)X=B;K.relative[ja](ba,X,ra)}}else ba=[]}ba||(ba=U);ba||H.error(ja||w);if(C.call(ba)==="[object Array]")if(pa)if(B&&B.nodeType===1)for(w=0;ba[w]!=null;w++){if(ba[w]&&(ba[w]===true||ba[w].nodeType===1&&ka(B,ba[w])))I.push(U[w])}else for(w=0;ba[w]!=null;w++)ba[w]&&ba[w].nodeType===1&&I.push(U[w]);else I.push.apply(I,ba);else ca(ba,I);if(va){H(va,P,I,J);H.uniqueSort(I)}return I};H.uniqueSort=function(w){if(fa){D=
L;w.sort(fa);if(D)for(var B=1;B<w.length;B++)w[B]===w[B-1]&&w.splice(B--,1)}return w};H.matches=function(w,B){return H(w,null,null,B)};H.find=function(w,B,I){var J,P;if(!w)return[];for(var O=0,X=K.order.length;O<X;O++){var U=K.order[O];if(P=K.leftMatch[U].exec(w)){var ba=P[1];P.splice(1,1);if(ba.substr(ba.length-1)!=="\\"){P[1]=(P[1]||"").replace(/\\/g,"");J=K.find[U](P,B,I);if(J!=null){w=w.replace(K.match[U],"");break}}}}J||(J=B.getElementsByTagName("*"));return{set:J,expr:w}};H.filter=function(w,
B,I,J){for(var P=w,O=[],X=B,U,ba,va=B&&B[0]&&Z(B[0]);w&&B.length;){for(var pa in K.filter)if((U=K.leftMatch[pa].exec(w))!=null&&U[2]){var ra=K.filter[pa],qa,ja;ja=U[1];ba=false;U.splice(1,1);if(ja.substr(ja.length-1)!=="\\"){if(X===O)O=[];if(K.preFilter[pa])if(U=K.preFilter[pa](U,X,I,O,J,va)){if(U===true)continue}else ba=qa=true;if(U)for(var wa=0;(ja=X[wa])!=null;wa++)if(ja){qa=ra(ja,U,wa,X);var Ra=J^!!qa;if(I&&qa!=null)if(Ra)ba=true;else X[wa]=false;else if(Ra){O.push(ja);ba=true}}if(qa!==undefined){I||
(X=O);w=w.replace(K.match[pa],"");if(!ba)return[];break}}}if(w===P)if(ba==null)H.error(w);else break;P=w}return X};H.error=function(w){throw"Syntax error, unrecognized expression: "+w;};var K=H.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,
POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(w){return w.getAttribute("href")}},relative:{"+":function(w,B){var I=typeof B==="string",J=I&&!/\W/.test(B);I=I&&!J;if(J)B=B.toLowerCase();J=0;for(var P=w.length,O;J<P;J++)if(O=w[J]){for(;(O=O.previousSibling)&&O.nodeType!==1;);w[J]=I||O&&O.nodeName.toLowerCase()===
B?O||false:O===B}I&&H.filter(B,w,true)},">":function(w,B){var I=typeof B==="string";if(I&&!/\W/.test(B)){B=B.toLowerCase();for(var J=0,P=w.length;J<P;J++){var O=w[J];if(O){I=O.parentNode;w[J]=I.nodeName.toLowerCase()===B?I:false}}}else{J=0;for(P=w.length;J<P;J++)if(O=w[J])w[J]=I?O.parentNode:O.parentNode===B;I&&H.filter(B,w,true)}},"":function(w,B,I){var J=q++,P=n;if(typeof B==="string"&&!/\W/.test(B)){var O=B=B.toLowerCase();P=l}P("parentNode",B,J,w,O,I)},"~":function(w,B,I){var J=q++,P=n;if(typeof B===
"string"&&!/\W/.test(B)){var O=B=B.toLowerCase();P=l}P("previousSibling",B,J,w,O,I)}},find:{ID:function(w,B,I){if(typeof B.getElementById!=="undefined"&&!I)return(w=B.getElementById(w[1]))?[w]:[]},NAME:function(w,B){if(typeof B.getElementsByName!=="undefined"){var I=[];B=B.getElementsByName(w[1]);for(var J=0,P=B.length;J<P;J++)B[J].getAttribute("name")===w[1]&&I.push(B[J]);return I.length===0?null:I}},TAG:function(w,B){return B.getElementsByTagName(w[1])}},preFilter:{CLASS:function(w,B,I,J,P,O){w=
" "+w[1].replace(/\\/g,"")+" ";if(O)return w;O=0;for(var X;(X=B[O])!=null;O++)if(X)if(P^(X.className&&(" "+X.className+" ").replace(/[\t\n]/g," ").indexOf(w)>=0))I||J.push(X);else if(I)B[O]=false;return false},ID:function(w){return w[1].replace(/\\/g,"")},TAG:function(w){return w[1].toLowerCase()},CHILD:function(w){if(w[1]==="nth"){var B=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(w[2]==="even"&&"2n"||w[2]==="odd"&&"2n+1"||!/\D/.test(w[2])&&"0n+"+w[2]||w[2]);w[2]=B[1]+(B[2]||1)-0;w[3]=B[3]-0}w[0]=q++;return w},
ATTR:function(w,B,I,J,P,O){B=w[1].replace(/\\/g,"");if(!O&&K.attrMap[B])w[1]=K.attrMap[B];if(w[2]==="~=")w[4]=" "+w[4]+" ";return w},PSEUDO:function(w,B,I,J,P){if(w[1]==="not")if((r.exec(w[3])||"").length>1||/^\w/.test(w[3]))w[3]=H(w[3],null,null,B);else{w=H.filter(w[3],B,I,true^P);I||J.push.apply(J,w);return false}else if(K.match.POS.test(w[0])||K.match.CHILD.test(w[0]))return true;return w},POS:function(w){w.unshift(true);return w}},filters:{enabled:function(w){return w.disabled===false&&w.type!==
"hidden"},disabled:function(w){return w.disabled===true},checked:function(w){return w.checked===true},selected:function(w){return w.selected===true},parent:function(w){return!!w.firstChild},empty:function(w){return!w.firstChild},has:function(w,B,I){return!!H(I[3],w).length},header:function(w){return/h\d/i.test(w.nodeName)},text:function(w){return"text"===w.type},radio:function(w){return"radio"===w.type},checkbox:function(w){return"checkbox"===w.type},file:function(w){return"file"===w.type},password:function(w){return"password"===
w.type},submit:function(w){return"submit"===w.type},image:function(w){return"image"===w.type},reset:function(w){return"reset"===w.type},button:function(w){return"button"===w.type||w.nodeName.toLowerCase()==="button"},input:function(w){return/input|select|textarea|button/i.test(w.nodeName)}},setFilters:{first:function(w,B){return B===0},last:function(w,B,I,J){return B===J.length-1},even:function(w,B){return B%2===0},odd:function(w,B){return B%2===1},lt:function(w,B,I){return B<I[3]-0},gt:function(w,
B,I){return B>I[3]-0},nth:function(w,B,I){return I[3]-0===B},eq:function(w,B,I){return I[3]-0===B}},filter:{PSEUDO:function(w,B,I,J){var P=B[1],O=K.filters[P];if(O)return O(w,I,B,J);else if(P==="contains")return(w.textContent||w.innerText||a([w])||"").indexOf(B[3])>=0;else if(P==="not"){B=B[3];I=0;for(J=B.length;I<J;I++)if(B[I]===w)return false;return true}else H.error("Syntax error, unrecognized expression: "+P)},CHILD:function(w,B){var I=B[1],J=w;switch(I){case "only":case "first":for(;J=J.previousSibling;)if(J.nodeType===
1)return false;if(I==="first")return true;J=w;case "last":for(;J=J.nextSibling;)if(J.nodeType===1)return false;return true;case "nth":I=B[2];var P=B[3];if(I===1&&P===0)return true;B=B[0];var O=w.parentNode;if(O&&(O.sizcache!==B||!w.nodeIndex)){var X=0;for(J=O.firstChild;J;J=J.nextSibling)if(J.nodeType===1)J.nodeIndex=++X;O.sizcache=B}w=w.nodeIndex-P;return I===0?w===0:w%I===0&&w/I>=0}},ID:function(w,B){return w.nodeType===1&&w.getAttribute("id")===B},TAG:function(w,B){return B==="*"&&w.nodeType===
1||w.nodeName.toLowerCase()===B},CLASS:function(w,B){return(" "+(w.className||w.getAttribute("class"))+" ").indexOf(B)>-1},ATTR:function(w,B){var I=B[1];w=K.attrHandle[I]?K.attrHandle[I](w):w[I]!=null?w[I]:w.getAttribute(I);I=w+"";var J=B[2];B=B[4];return w==null?J==="!=":J==="="?I===B:J==="*="?I.indexOf(B)>=0:J==="~="?(" "+I+" ").indexOf(B)>=0:!B?I&&w!==false:J==="!="?I!==B:J==="^="?I.indexOf(B)===0:J==="$="?I.substr(I.length-B.length)===B:J==="|="?I===B||I.substr(0,B.length+1)===B+"-":false},POS:function(w,
B,I,J){var P=K.setFilters[B[2]];if(P)return P(w,I,B,J)}}},R=K.match.POS;for(var V in K.match){K.match[V]=new RegExp(K.match[V].source+/(?![^\[]*\])(?![^\(]*\))/.source);K.leftMatch[V]=new RegExp(/(^(?:.|\r|\n)*?)/.source+K.match[V].source.replace(/\\(\d+)/g,function(w,B){return"\\"+(B-0+1)}))}var ca=function(w,B){w=Array.prototype.slice.call(w,0);if(B){B.push.apply(B,w);return B}return w};try{Array.prototype.slice.call(p.documentElement.childNodes,0)}catch(ga){ca=function(w,B){B=B||[];if(C.call(w)===
"[object Array]")Array.prototype.push.apply(B,w);else if(typeof w.length==="number")for(var I=0,J=w.length;I<J;I++)B.push(w[I]);else for(I=0;w[I];I++)B.push(w[I]);return B}}var fa;if(p.documentElement.compareDocumentPosition)fa=function(w,B){if(!w.compareDocumentPosition||!B.compareDocumentPosition){if(w==B)D=true;return w.compareDocumentPosition?-1:1}w=w.compareDocumentPosition(B)&4?-1:w===B?0:1;if(w===0)D=true;return w};else if("sourceIndex"in p.documentElement)fa=function(w,B){if(!w.sourceIndex||
!B.sourceIndex){if(w==B)D=true;return w.sourceIndex?-1:1}w=w.sourceIndex-B.sourceIndex;if(w===0)D=true;return w};else if(p.createRange)fa=function(w,B){if(!w.ownerDocument||!B.ownerDocument){if(w==B)D=true;return w.ownerDocument?-1:1}var I=w.ownerDocument.createRange(),J=B.ownerDocument.createRange();I.setStart(w,0);I.setEnd(w,0);J.setStart(B,0);J.setEnd(B,0);w=I.compareBoundaryPoints(Range.START_TO_END,J);if(w===0)D=true;return w};(function(){var w=p.createElement("div"),B="script"+(new Date).getTime();
w.innerHTML="<a name='"+B+"'/>";var I=p.documentElement;I.insertBefore(w,I.firstChild);if(p.getElementById(B)){K.find.ID=function(J,P,O){if(typeof P.getElementById!=="undefined"&&!O)return(P=P.getElementById(J[1]))?P.id===J[1]||typeof P.getAttributeNode!=="undefined"&&P.getAttributeNode("id").nodeValue===J[1]?[P]:undefined:[]};K.filter.ID=function(J,P){var O=typeof J.getAttributeNode!=="undefined"&&J.getAttributeNode("id");return J.nodeType===1&&O&&O.nodeValue===P}}I.removeChild(w);I=w=null})();(function(){var w=
p.createElement("div");w.appendChild(p.createComment(""));if(w.getElementsByTagName("*").length>0)K.find.TAG=function(B,I){I=I.getElementsByTagName(B[1]);if(B[1]==="*"){B=[];for(var J=0;I[J];J++)I[J].nodeType===1&&B.push(I[J]);I=B}return I};w.innerHTML="<a href='#'></a>";if(w.firstChild&&typeof w.firstChild.getAttribute!=="undefined"&&w.firstChild.getAttribute("href")!=="#")K.attrHandle.href=function(B){return B.getAttribute("href",2)};w=null})();p.querySelectorAll&&function(){var w=H,B=p.createElement("div");
B.innerHTML="<p class='TEST'></p>";if(!(B.querySelectorAll&&B.querySelectorAll(".TEST").length===0)){H=function(J,P,O,X){P=P||p;if(!X&&P.nodeType===9&&!Z(P))try{return ca(P.querySelectorAll(J),O)}catch(U){}return w(J,P,O,X)};for(var I in w)H[I]=w[I];B=null}}();(function(){var w=p.createElement("div");w.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!w.getElementsByClassName||w.getElementsByClassName("e").length===0)){w.lastChild.className="e";if(w.getElementsByClassName("e").length!==
1){K.order.splice(1,0,"CLASS");K.find.CLASS=function(B,I,J){if(typeof I.getElementsByClassName!=="undefined"&&!J)return I.getElementsByClassName(B[1])};w=null}}})();var ka=p.compareDocumentPosition?function(w,B){return!!(w.compareDocumentPosition(B)&16)}:function(w,B){return w!==B&&(w.contains?w.contains(B):true)},Z=function(w){return(w=(w?w.ownerDocument||w:0).documentElement)?w.nodeName!=="HTML":false},Ca=function(w,B){var I=[],J="",P;for(B=B.nodeType?[B]:B;P=K.match.PSEUDO.exec(w);){J+=P[0];w=
w.replace(K.match.PSEUDO,"")}w=K.relative[w]?w+"*":w;P=0;for(var O=B.length;P<O;P++)H(w,B[P],I);return H.filter(J,I)};f.find=H;f.expr=H.selectors;f.expr[":"]=f.expr.filters;f.unique=H.uniqueSort;f.text=a;f.isXMLDoc=Z;f.contains=ka})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,gb=/,/;oa=Array.prototype.slice;var Sa=function(a,l,n){if(f.isFunction(l))return f.grep(a,function(q,C){return!!l.call(q,C,q)===n});else if(l.nodeType)return f.grep(a,function(q){return q===l===n});else if(typeof l===
"string"){var r=f.grep(a,function(q){return q.nodeType===1});if(G.test(l))return f.filter(l,r,!n);else l=f.filter(l,r)}return f.grep(a,function(q){return f.inArray(q,l)>=0===n})};f.fn.extend({find:function(a){for(var l=this.pushStack("","find",a),n=0,r=0,q=this.length;r<q;r++){n=l.length;f.find(a,this[r],l);if(r>0)for(var C=n;C<l.length;C++)for(var D=0;D<n;D++)if(l[D]===l[C]){l.splice(C--,1);break}}return l},has:function(a){var l=f(a);return this.filter(function(){for(var n=0,r=l.length;n<r;n++)if(f.contains(this,
l[n]))return true})},not:function(a){return this.pushStack(Sa(this,a,false),"not",a)},filter:function(a){return this.pushStack(Sa(this,a,true),"filter",a)},is:function(a){return!!a&&f.filter(a,this).length>0},closest:function(a,l){if(f.isArray(a)){var n=[],r=this[0],q,C={},D;if(r&&a.length){q=0;for(var L=a.length;q<L;q++){D=a[q];C[D]||(C[D]=f.expr.match.POS.test(D)?f(D,l||this.context):D)}for(;r&&r.ownerDocument&&r!==l;){for(D in C){q=C[D];if(q.jquery?q.index(r)>-1:f(r).is(q)){n.push({selector:D,
elem:r});delete C[D]}}r=r.parentNode}}return n}var H=f.expr.match.POS.test(a)?f(a,l||this.context):null;return this.map(function(K,R){for(;R&&R.ownerDocument&&R!==l;){if(H?H.index(R)>-1:f(R).is(a))return R;R=R.parentNode}return null})},index:function(a){if(!a||typeof a==="string")return f.inArray(this[0],a?f(a):this.parent().children());return f.inArray(a.jquery?a[0]:a,this)},add:function(a,l){a=typeof a==="string"?f(a,l||this.context):f.makeArray(a);l=f.merge(this.get(),a);return this.pushStack(j(a[0])||
j(l[0])?l:f.unique(l))},andSelf:function(){return this.add(this.prevObject)}});f.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,l,n){return f.dir(a,"parentNode",n)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,l,n){return f.dir(a,
"nextSibling",n)},prevUntil:function(a,l,n){return f.dir(a,"previousSibling",n)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,l){f.fn[a]=function(n,r){var q=f.map(this,l,n);eb.test(a)||(r=n);if(r&&typeof r==="string")q=f.filter(r,q);q=this.length>1?f.unique(q):q;if((this.length>1||gb.test(r))&&
fb.test(a))q=q.reverse();return this.pushStack(q,a,oa.call(arguments).join(","))}});f.extend({filter:function(a,l,n){if(n)a=":not("+a+")";return f.find.matches(a,l)},dir:function(a,l,n){var r=[];for(a=a[l];a&&a.nodeType!==9&&(n===undefined||a.nodeType!==1||!f(a).is(n));){a.nodeType===1&&r.push(a);a=a[l]}return r},nth:function(a,l,n){l=l||1;for(var r=0;a;a=a[n])if(a.nodeType===1&&++r===l)break;return a},sibling:function(a,l){for(var n=[];a;a=a.nextSibling)a.nodeType===1&&a!==l&&n.push(a);return n}});
var Ta=/ jQuery\d+="(?:\d+|null)"/g,xa=/^\s+/,Ua=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,Va=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,Ia=/<script|<object|<embed|<option|<style/i,Ja=/checked\s*(?:[^=]|=\s*.checked.)/i,Wa=function(a,l,n){return hb.test(n)?a:l+"></"+n+">"},la={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>",
"</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};la.optgroup=la.option;la.tbody=la.tfoot=la.colgroup=la.caption=la.thead;la.th=la.td;if(!f.support.htmlSerialize)la._default=[1,"div<div>","</div>"];f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(l){var n=f(this);n.text(a.call(this,l,n.text()))});if(typeof a!=="object"&&a!==undefined)return this.empty().append((this[0]&&this[0].ownerDocument||
p).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(n){f(this).wrapAll(a.call(this,n))});if(this[0]){var l=f(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&l.insertBefore(this[0]);l.map(function(){for(var n=this;n.firstChild&&n.firstChild.nodeType===1;)n=n.firstChild;return n}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(l){f(this).wrapInner(a.call(this,l))});return this.each(function(){var l=
f(this),n=l.contents();n.length?n.wrapAll(a):l.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&
this[0].parentNode)return this.domManip(arguments,false,function(l){this.parentNode.insertBefore(l,this)});else if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(l){this.parentNode.insertBefore(l,this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},
remove:function(a,l){for(var n=0,r;(r=this[n])!=null;n++)if(!a||f.filter(a,[r]).length){if(!l&&r.nodeType===1){f.cleanData(r.getElementsByTagName("*"));f.cleanData([r])}r.parentNode&&r.parentNode.removeChild(r)}return this},empty:function(){for(var a=0,l;(l=this[a])!=null;a++)for(l.nodeType===1&&f.cleanData(l.getElementsByTagName("*"));l.firstChild;)l.removeChild(l.firstChild);return this},clone:function(a){var l=this.map(function(){if(!f.support.noCloneEvent&&!f.isXMLDoc(this)){var n=this.outerHTML,
r=this.ownerDocument;if(!n){n=r.createElement("div");n.appendChild(this.cloneNode(true));n=n.innerHTML}return f.clean([n.replace(Ta,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(xa,"")],r)[0]}else return this.cloneNode(true)});if(a===true){m(this,l);m(this.find("*"),l.find("*"))}return l},html:function(a){if(a===undefined)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ta,""):null;else if(typeof a==="string"&&!Ia.test(a)&&(f.support.leadingWhitespace||!xa.test(a))&&!la[(Va.exec(a)||
["",""])[1].toLowerCase()]){a=a.replace(Ua,Wa);try{for(var l=0,n=this.length;l<n;l++)if(this[l].nodeType===1){f.cleanData(this[l].getElementsByTagName("*"));this[l].innerHTML=a}}catch(r){this.empty().append(a)}}else f.isFunction(a)?this.each(function(q){var C=f(this),D=C.html();C.empty().append(function(){return a.call(this,q,D)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(l){var n=f(this),r=n.html();n.replaceWith(a.call(this,
l,r))});if(typeof a!=="string")a=f(a).detach();return this.each(function(){var l=this.nextSibling,n=this.parentNode;f(this).remove();l?f(l).before(a):f(n).append(a)})}else return this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,l,n){function r(V){return f.nodeName(V,"table")?V.getElementsByTagName("tbody")[0]||V.appendChild(V.ownerDocument.createElement("tbody")):V}var q,C,D=a[0],L=[],H;if(!f.support.checkClone&&arguments.length===
3&&typeof D==="string"&&Ja.test(D))return this.each(function(){f(this).domManip(a,l,n,true)});if(f.isFunction(D))return this.each(function(V){var ca=f(this);a[0]=D.call(this,V,l?ca.html():undefined);ca.domManip(a,l,n)});if(this[0]){q=D&&D.parentNode;q=f.support.parentNode&&q&&q.nodeType===11&&q.childNodes.length===this.length?{fragment:q}:o(a,this,L);H=q.fragment;if(C=H.childNodes.length===1?(H=H.firstChild):H.firstChild){l=l&&f.nodeName(C,"tr");for(var K=0,R=this.length;K<R;K++)n.call(l?r(this[K],
C):this[K],K>0||q.cacheable||this.length>1?H.cloneNode(true):H)}L.length&&f.each(L,s)}return this}});f.fragments={};f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,l){f.fn[a]=function(n){var r=[];n=f(n);var q=this.length===1&&this[0].parentNode;if(q&&q.nodeType===11&&q.childNodes.length===1&&n.length===1){n[l](this[0]);return this}else{q=0;for(var C=n.length;q<C;q++){var D=(q>0?this.clone(true):this).get();f.fn[l].apply(f(n[q]),
D);r=r.concat(D)}return this.pushStack(r,a,n.selector)}}});f.extend({clean:function(a,l,n,r){l=l||p;if(typeof l.createElement==="undefined")l=l.ownerDocument||l[0]&&l[0].ownerDocument||p;for(var q=[],C=0,D;(D=a[C])!=null;C++){if(typeof D==="number")D+="";if(D){if(typeof D==="string"&&!jb.test(D))D=l.createTextNode(D);else if(typeof D==="string"){D=D.replace(Ua,Wa);var L=(Va.exec(D)||["",""])[1].toLowerCase(),H=la[L]||la._default,K=H[0],R=l.createElement("div");for(R.innerHTML=H[1]+D+H[2];K--;)R=R.lastChild;
if(!f.support.tbody){K=ib.test(D);L=L==="table"&&!K?R.firstChild&&R.firstChild.childNodes:H[1]==="<table>"&&!K?R.childNodes:[];for(H=L.length-1;H>=0;--H)f.nodeName(L[H],"tbody")&&!L[H].childNodes.length&&L[H].parentNode.removeChild(L[H])}!f.support.leadingWhitespace&&xa.test(D)&&R.insertBefore(l.createTextNode(xa.exec(D)[0]),R.firstChild);D=R.childNodes}if(D.nodeType)q.push(D);else q=f.merge(q,D)}}if(n)for(C=0;q[C];C++)if(r&&f.nodeName(q[C],"script")&&(!q[C].type||q[C].type.toLowerCase()==="text/javascript"))r.push(q[C].parentNode?
q[C].parentNode.removeChild(q[C]):q[C]);else{q[C].nodeType===1&&q.splice.apply(q,[C+1,0].concat(f.makeArray(q[C].getElementsByTagName("script"))));n.appendChild(q[C])}return q},cleanData:function(a){for(var l,n,r=f.cache,q=f.event.special,C=f.support.deleteExpando,D=0,L;(L=a[D])!=null;D++)if(n=L[f.expando]){l=r[n];if(l.events)for(var H in l.events)q[H]?f.event.remove(L,H):Ma(L,H,l.handle);if(C)delete L[f.expando];else L.removeAttribute&&L.removeAttribute(f.expando);delete r[n]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,
Xa=/alpha\([^)]*\)/,Ya=/opacity=([^)]*)/,Da=/float/i,Ea=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=p.defaultView&&p.defaultView.getComputedStyle,Za=f.support.cssFloat?"cssFloat":"styleFloat",Fa=function(a,l){return l.toUpperCase()};f.fn.css=function(a,l){return g(this,a,l,true,function(n,r,q){if(q===undefined)return f.curCSS(n,r);if(typeof q==="number"&&!kb.test(r))q+="px";f.style(n,
r,q)})};f.extend({style:function(a,l,n){if(!(!a||a.nodeType===3||a.nodeType===8)){if((l==="width"||l==="height")&&parseFloat(n)<0)n=undefined;var r=a.style||a,q=n!==undefined;if(!f.support.opacity&&l==="opacity"){if(q){r.zoom=1;l=parseInt(n,10)+""==="NaN"?"":"alpha(opacity="+n*100+")";a=r.filter||f.curCSS(a,"filter")||"";r.filter=Xa.test(a)?a.replace(Xa,l):l}return r.filter&&r.filter.indexOf("opacity=")>=0?parseFloat(Ya.exec(r.filter)[1])/100+"":""}if(Da.test(l))l=Za;l=l.replace(Ea,Fa);if(q)r[l]=
n;return r[l]}},css:function(a,l,n,r){if(l==="width"||l==="height"){var q,C=l==="width"?pb:qb;n=function(){q=l==="width"?a.offsetWidth:a.offsetHeight;r!=="border"&&f.each(C,function(){r||(q-=parseFloat(f.curCSS(a,"padding"+this,true))||0);if(r==="margin")q+=parseFloat(f.curCSS(a,"margin"+this,true))||0;else q-=parseFloat(f.curCSS(a,"border"+this+"Width",true))||0})};a.offsetWidth!==0?n():f.swap(a,ob,n);return Math.max(0,Math.round(q))}return f.curCSS(a,l,n)},curCSS:function(a,l,n){var r,q=a.style;
if(!f.support.opacity&&l==="opacity"&&a.currentStyle){r=Ya.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return r===""?"1":r}if(Da.test(l))l=Za;if(!n&&q&&q[l])r=q[l];else if(rb){if(Da.test(l))l="float";l=l.replace(lb,"-$1").toLowerCase();q=a.ownerDocument.defaultView;if(!q)return null;if(a=q.getComputedStyle(a,null))r=a.getPropertyValue(l);if(l==="opacity"&&r==="")r="1"}else if(a.currentStyle){n=l.replace(Ea,Fa);r=a.currentStyle[l]||a.currentStyle[n];if(!mb.test(r)&&nb.test(r)){l=
q.left;var C=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;q.left=n==="fontSize"?"1em":r||0;r=q.pixelLeft+"px";q.left=l;a.runtimeStyle.left=C}}return r},swap:function(a,l,n){var r={};for(var q in l){r[q]=a.style[q];a.style[q]=l[q]}n.call(a);for(q in l)a.style[q]=r[q]}});if(f.expr&&f.expr.filters){f.expr.filters.hidden=function(a){var l=a.offsetWidth,n=a.offsetHeight,r=a.nodeName.toLowerCase()==="tr";return l===0&&n===0&&!r?true:l>0&&n>0&&!r?false:f.curCSS(a,"display")==="none"};f.expr.filters.visible=
function(a){return!f.expr.filters.hidden(a)}}var sb=e(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,sa=/=\?(&|$)/,Ga=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=f.fn.load;f.fn.extend({load:function(a,l,n){if(typeof a!=="string")return zb.call(this,a);else if(!this.length)return this;var r=a.indexOf(" ");if(r>=0){var q=a.slice(r,a.length);a=a.slice(0,r)}r="GET";if(l)if(f.isFunction(l)){n=
l;l=null}else if(typeof l==="object"){l=f.param(l,f.ajaxSettings.traditional);r="POST"}var C=this;f.ajax({url:a,type:r,dataType:"html",data:l,complete:function(D,L){if(L==="success"||L==="notmodified")C.html(q?f("<div />").append(D.responseText.replace(tb,"")).find(q):D.responseText);n&&C.each(n,[D.responseText,L,D])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&
!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,l){a=f(this).val();return a==null?null:f.isArray(a)?f.map(a,function(n){return{name:l.name,value:n}}):{name:l.name,value:a}}).get()}});f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,l){f.fn[l]=function(n){return this.bind(l,n)}});f.extend({get:function(a,l,n,r){if(f.isFunction(l)){r=r||n;n=l;l=null}return f.ajax({type:"GET",url:a,data:l,success:n,dataType:r})},
getScript:function(a,l){return f.get(a,null,l,"script")},getJSON:function(a,l,n){return f.get(a,l,n,"json")},post:function(a,l,n,r){if(f.isFunction(l)){r=r||n;n=l;l={}}return f.ajax({type:"POST",url:a,data:l,success:n,dataType:r})},ajaxSetup:function(a){f.extend(f.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:
function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function l(){q.success&&q.success.call(H,L,D,Z);q.global&&r("ajaxSuccess",[Z,q])}function n(){q.complete&&q.complete.call(H,Z,D);q.global&&r("ajaxComplete",[Z,q]);q.global&&!--f.active&&f.event.trigger("ajaxStop")}
function r(P,O){(q.context?f(q.context):f.event).trigger(P,O)}var q=f.extend(true,{},f.ajaxSettings,a),C,D,L,H=a&&a.context||q,K=q.type.toUpperCase();if(q.data&&q.processData&&typeof q.data!=="string")q.data=f.param(q.data,q.traditional);if(q.dataType==="jsonp"){if(K==="GET")sa.test(q.url)||(q.url+=(Ga.test(q.url)?"&":"?")+(q.jsonp||"callback")+"=?");else if(!q.data||!sa.test(q.data))q.data=(q.data?q.data+"&":"")+(q.jsonp||"callback")+"=?";q.dataType="json"}if(q.dataType==="json"&&(q.data&&sa.test(q.data)||
sa.test(q.url))){C=q.jsonpCallback||"jsonp"+sb++;if(q.data)q.data=(q.data+"").replace(sa,"="+C+"$1");q.url=q.url.replace(sa,"="+C+"$1");q.dataType="script";window[C]=window[C]||function(P){L=P;l();n();window[C]=undefined;try{delete window[C]}catch(O){}ca&&ca.removeChild(ga)}}if(q.dataType==="script"&&q.cache===null)q.cache=false;if(q.cache===false&&K==="GET"){var R=e(),V=q.url.replace(wb,"$1_="+R+"$2");q.url=V+(V===q.url?(Ga.test(q.url)?"&":"?")+"_="+R:"")}if(q.data&&K==="GET")q.url+=(Ga.test(q.url)?
"&":"?")+q.data;q.global&&!f.active++&&f.event.trigger("ajaxStart");R=(R=xb.exec(q.url))&&(R[1]&&R[1]!==location.protocol||R[2]!==location.host);if(q.dataType==="script"&&K==="GET"&&R){var ca=p.getElementsByTagName("head")[0]||p.documentElement,ga=p.createElement("script");ga.src=q.url;if(q.scriptCharset)ga.charset=q.scriptCharset;if(!C){var fa=false;ga.onload=ga.onreadystatechange=function(){if(!fa&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){fa=true;l();n();ga.onload=
ga.onreadystatechange=null;ca&&ga.parentNode&&ca.removeChild(ga)}}}ca.insertBefore(ga,ca.firstChild)}else{var ka=false,Z=q.xhr();if(Z){q.username?Z.open(K,q.url,q.async,q.username,q.password):Z.open(K,q.url,q.async);try{if(q.data||a&&a.contentType)Z.setRequestHeader("Content-Type",q.contentType);if(q.ifModified){f.lastModified[q.url]&&Z.setRequestHeader("If-Modified-Since",f.lastModified[q.url]);f.etag[q.url]&&Z.setRequestHeader("If-None-Match",f.etag[q.url])}R||Z.setRequestHeader("X-Requested-With",
"XMLHttpRequest");Z.setRequestHeader("Accept",q.dataType&&q.accepts[q.dataType]?q.accepts[q.dataType]+", */*":q.accepts._default)}catch(Ca){}if(q.beforeSend&&q.beforeSend.call(H,Z,q)===false){q.global&&!--f.active&&f.event.trigger("ajaxStop");Z.abort();return false}q.global&&r("ajaxSend",[Z,q]);var w=Z.onreadystatechange=function(P){if(!Z||Z.readyState===0||P==="abort"){ka||n();ka=true;if(Z)Z.onreadystatechange=f.noop}else if(!ka&&Z&&(Z.readyState===4||P==="timeout")){ka=true;Z.onreadystatechange=
f.noop;D=P==="timeout"?"timeout":!f.httpSuccess(Z)?"error":q.ifModified&&f.httpNotModified(Z,q.url)?"notmodified":"success";var O;if(D==="success")try{L=f.httpData(Z,q.dataType,q)}catch(X){D="parsererror";O=X}if(D==="success"||D==="notmodified")C||l();else f.handleError(q,Z,D,O);n();P==="timeout"&&Z.abort();if(q.async)Z=null}};try{var B=Z.abort;Z.abort=function(){Z&&B.call(Z);w("abort")}}catch(I){}q.async&&q.timeout>0&&setTimeout(function(){Z&&!ka&&w("timeout")},q.timeout);try{Z.send(K==="POST"||
K==="PUT"||K==="DELETE"?q.data:null)}catch(J){f.handleError(q,Z,null,J);n()}q.async||w();return Z}}},handleError:function(a,l,n,r){if(a.error)a.error.call(a.context||a,l,n,r);if(a.global)(a.context?f(a.context):f.event).trigger("ajaxError",[l,a,r])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223||a.status===0}catch(l){}return false},httpNotModified:function(a,l){var n=a.getResponseHeader("Last-Modified"),
r=a.getResponseHeader("Etag");if(n)f.lastModified[l]=n;if(r)f.etag[l]=r;return a.status===304||a.status===0},httpData:function(a,l,n){var r=a.getResponseHeader("content-type")||"",q=l==="xml"||!l&&r.indexOf("xml")>=0;a=q?a.responseXML:a.responseText;q&&a.documentElement.nodeName==="parsererror"&&f.error("parsererror");if(n&&n.dataFilter)a=n.dataFilter(a,l);if(typeof a==="string")if(l==="json"||!l&&r.indexOf("json")>=0)a=f.parseJSON(a);else if(l==="script"||!l&&r.indexOf("javascript")>=0)f.globalEval(a);
return a},param:function(a,l){function n(D,L){if(f.isArray(L))f.each(L,function(H,K){l||/\[\]$/.test(D)?r(D,K):n(D+"["+(typeof K==="object"||f.isArray(K)?H:"")+"]",K)});else!l&&L!=null&&typeof L==="object"?f.each(L,function(H,K){n(D+"["+H+"]",K)}):r(D,L)}function r(D,L){L=f.isFunction(L)?L():L;q[q.length]=encodeURIComponent(D)+"="+encodeURIComponent(L)}var q=[];if(l===undefined)l=f.ajaxSettings.traditional;if(f.isArray(a)||a.jquery)f.each(a,function(){r(this.name,this.value)});else for(var C in a)n(C,
a[C]);return q.join("&").replace(yb,"+")}});var Ha={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,ya,Ka=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];f.fn.extend({show:function(a,l){if(a||a===0)return this.animate(x("show",3),a,l);else{a=0;for(l=this.length;a<l;a++){var n=f.data(this[a],"olddisplay");this[a].style.display=n||"";if(f.css(this[a],"display")==="none"){n=this[a].nodeName;var r;
if(Ha[n])r=Ha[n];else{var q=f("<"+n+" />").appendTo("body");r=q.css("display");if(r==="none")r="block";q.remove();Ha[n]=r}f.data(this[a],"olddisplay",r)}}a=0;for(l=this.length;a<l;a++)this[a].style.display=f.data(this[a],"olddisplay")||"";return this}},hide:function(a,l){if(a||a===0)return this.animate(x("hide",3),a,l);else{a=0;for(l=this.length;a<l;a++){var n=f.data(this[a],"olddisplay");!n&&n!=="none"&&f.data(this[a],"olddisplay",f.css(this[a],"display"))}a=0;for(l=this.length;a<l;a++)this[a].style.display=
"none";return this}},_toggle:f.fn.toggle,toggle:function(a,l){var n=typeof a==="boolean";if(f.isFunction(a)&&f.isFunction(l))this._toggle.apply(this,arguments);else a==null||n?this.each(function(){var r=n?a:f(this).is(":hidden");f(this)[r?"show":"hide"]()}):this.animate(x("toggle",3),a,l);return this},fadeTo:function(a,l,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:l},a,n)},animate:function(a,l,n,r){var q=f.speed(l,n,r);if(f.isEmptyObject(a))return this.each(q.complete);
return this[q.queue===false?"each":"queue"](function(){var C=f.extend({},q),D,L=this.nodeType===1&&f(this).is(":hidden"),H=this;for(D in a){var K=D.replace(Ea,Fa);if(D!==K){a[K]=a[D];delete a[D];D=K}if(a[D]==="hide"&&L||a[D]==="show"&&!L)return C.complete.call(this);if((D==="height"||D==="width")&&this.style){C.display=f.css(this,"display");C.overflow=this.style.overflow}if(f.isArray(a[D])){(C.specialEasing=C.specialEasing||{})[D]=a[D][1];a[D]=a[D][0]}}if(C.overflow!=null)this.style.overflow="hidden";
C.curAnim=f.extend({},a);f.each(a,function(R,V){var ca=new f.fx(H,C,R);if(Ab.test(V))ca[V==="toggle"?L?"show":"hide":V](a);else{var ga=Bb.exec(V),fa=ca.cur(true)||0;if(ga){V=parseFloat(ga[2]);var ka=ga[3]||"px";if(ka!=="px"){H.style[R]=(V||1)+ka;fa=(V||1)/ca.cur(true)*fa;H.style[R]=fa+ka}if(ga[1])V=(ga[1]==="-="?-1:1)*V+fa;ca.custom(fa,V,ka)}else ca.custom(fa,V,"")}});return true})},stop:function(a,l){var n=f.timers;a&&this.queue([]);this.each(function(){for(var r=n.length-1;r>=0;r--)if(n[r].elem===
this){l&&n[r](true);n.splice(r,1)}});l||this.dequeue();return this}});f.each({slideDown:x("show",1),slideUp:x("hide",1),slideToggle:x("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,l){f.fn[a]=function(n,r){return this.animate(l,n,r)}});f.extend({speed:function(a,l,n){var r=a&&typeof a==="object"?a:{complete:n||!n&&l||f.isFunction(a)&&a,duration:a,easing:n&&l||l&&!f.isFunction(l)&&l};r.duration=f.fx.off?0:typeof r.duration==="number"?r.duration:f.fx.speeds[r.duration]||f.fx.speeds._default;
r.old=r.complete;r.complete=function(){r.queue!==false&&f(this).dequeue();f.isFunction(r.old)&&r.old.call(this)};return r},easing:{linear:function(a,l,n,r){return n+r*a},swing:function(a,l,n,r){return(-Math.cos(a*Math.PI)/2+0.5)*r+n}},timers:[],fx:function(a,l,n){this.options=l;this.elem=a;this.prop=n;if(!l.orig)l.orig={}}});f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(f.fx.step[this.prop]||f.fx.step._default)(this);if((this.prop==="height"||
this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(f.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(f.curCSS(this.elem,this.prop))||0},custom:function(a,l,n){function r(C){return q.step(C)}this.startTime=e();this.start=a;this.end=l;this.unit=n||this.unit||"px";this.now=this.start;this.pos=this.state=0;var q=this;r.elem=this.elem;
if(r()&&f.timers.push(r)&&!ya)ya=setInterval(f.fx.tick,13)},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var l=e(),n=true;if(a||l>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();
this.options.curAnim[this.prop]=true;for(var r in this.options.curAnim)if(this.options.curAnim[r]!==true)n=false;if(n){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=f.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(f.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&f(this.elem).hide();if(this.options.hide||this.options.show)for(var q in this.options.curAnim)f.style(this.elem,q,this.options.orig[q]);
this.options.complete.call(this.elem)}return false}else{q=l-this.startTime;this.state=q/this.options.duration;a=this.options.easing||(f.easing.swing?"swing":"linear");this.pos=f.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,q,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};f.extend(f.fx,{tick:function(){for(var a=f.timers,l=0;l<a.length;l++)a[l]()||a.splice(l--,1);a.length||f.fx.stop()},stop:function(){clearInterval(ya);
ya=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(f.expr&&f.expr.filters)f.expr.filters.animated=function(a){return f.grep(f.timers,function(l){return a===l.elem}).length};f.fn.offset="getBoundingClientRect"in p.documentElement?function(a){var l=this[0];if(a)return this.each(function(q){f.offset.setOffset(this,
a,q)});if(!l||!l.ownerDocument)return null;if(l===l.ownerDocument.body)return f.offset.bodyOffset(l);var n=l.getBoundingClientRect(),r=l.ownerDocument;l=r.body;r=r.documentElement;return{top:n.top+(self.pageYOffset||f.support.boxModel&&r.scrollTop||l.scrollTop)-(r.clientTop||l.clientTop||0),left:n.left+(self.pageXOffset||f.support.boxModel&&r.scrollLeft||l.scrollLeft)-(r.clientLeft||l.clientLeft||0)}}:function(a){var l=this[0];if(a)return this.each(function(R){f.offset.setOffset(this,a,R)});if(!l||
!l.ownerDocument)return null;if(l===l.ownerDocument.body)return f.offset.bodyOffset(l);f.offset.initialize();var n=l.offsetParent,r=l,q=l.ownerDocument,C,D=q.documentElement,L=q.body;r=(q=q.defaultView)?q.getComputedStyle(l,null):l.currentStyle;for(var H=l.offsetTop,K=l.offsetLeft;(l=l.parentNode)&&l!==L&&l!==D;){if(f.offset.supportsFixedPosition&&r.position==="fixed")break;C=q?q.getComputedStyle(l,null):l.currentStyle;H-=l.scrollTop;K-=l.scrollLeft;if(l===n){H+=l.offsetTop;K+=l.offsetLeft;if(f.offset.doesNotAddBorder&&
!(f.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(l.nodeName))){H+=parseFloat(C.borderTopWidth)||0;K+=parseFloat(C.borderLeftWidth)||0}r=n;n=l.offsetParent}if(f.offset.subtractsBorderForOverflowNotVisible&&C.overflow!=="visible"){H+=parseFloat(C.borderTopWidth)||0;K+=parseFloat(C.borderLeftWidth)||0}r=C}if(r.position==="relative"||r.position==="static"){H+=L.offsetTop;K+=L.offsetLeft}if(f.offset.supportsFixedPosition&&r.position==="fixed"){H+=Math.max(D.scrollTop,L.scrollTop);K+=Math.max(D.scrollLeft,
L.scrollLeft)}return{top:H,left:K}};f.offset={initialize:function(){var a=p.body,l=p.createElement("div"),n,r,q,C=parseFloat(f.curCSS(a,"marginTop",true))||0;f.extend(l.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});l.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";
a.insertBefore(l,a.firstChild);n=l.firstChild;r=n.firstChild;q=n.nextSibling.firstChild.firstChild;this.doesNotAddBorder=r.offsetTop!==5;this.doesAddBorderForTableAndCells=q.offsetTop===5;r.style.position="fixed";r.style.top="20px";this.supportsFixedPosition=r.offsetTop===20||r.offsetTop===15;r.style.position=r.style.top="";n.style.overflow="hidden";n.style.position="relative";this.subtractsBorderForOverflowNotVisible=r.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==C;a.removeChild(l);
f.offset.initialize=f.noop},bodyOffset:function(a){var l=a.offsetTop,n=a.offsetLeft;f.offset.initialize();if(f.offset.doesNotIncludeMarginInBodyOffset){l+=parseFloat(f.curCSS(a,"marginTop",true))||0;n+=parseFloat(f.curCSS(a,"marginLeft",true))||0}return{top:l,left:n}},setOffset:function(a,l,n){if(/static/.test(f.curCSS(a,"position")))a.style.position="relative";var r=f(a),q=r.offset(),C=parseInt(f.curCSS(a,"top",true),10)||0,D=parseInt(f.curCSS(a,"left",true),10)||0;if(f.isFunction(l))l=l.call(a,
n,q);n={top:l.top-q.top+C,left:l.left-q.left+D};"using"in l?l.using.call(a,n):r.css(n)}};f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],l=this.offsetParent(),n=this.offset(),r=/^body|html$/i.test(l[0].nodeName)?{top:0,left:0}:l.offset();n.top-=parseFloat(f.curCSS(a,"marginTop",true))||0;n.left-=parseFloat(f.curCSS(a,"marginLeft",true))||0;r.top+=parseFloat(f.curCSS(l[0],"borderTopWidth",true))||0;r.left+=parseFloat(f.curCSS(l[0],"borderLeftWidth",true))||0;return{top:n.top-
r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||p.body;a&&!/^body|html$/i.test(a.nodeName)&&f.css(a,"position")==="static";)a=a.offsetParent;return a})}});f.each(["Left","Top"],function(a,l){var n="scroll"+l;f.fn[n]=function(r){var q=this[0],C;if(!q)return null;if(r!==undefined)return this.each(function(){if(C=u(this))C.scrollTo(!a?r:f(C).scrollLeft(),a?r:f(C).scrollTop());else this[n]=r});else return(C=u(q))?"pageXOffset"in C?C[a?"pageYOffset":
"pageXOffset"]:f.support.boxModel&&C.document.documentElement[n]||C.document.body[n]:q[n]}});f.each(["Height","Width"],function(a,l){var n=l.toLowerCase();f.fn["inner"+l]=function(){return this[0]?f.css(this[0],n,false,"padding"):null};f.fn["outer"+l]=function(r){return this[0]?f.css(this[0],n,false,r?"margin":"border"):null};f.fn[n]=function(r){var q=this[0];if(!q)return r==null?null:this;if(f.isFunction(r))return this.each(function(C){var D=f(this);D[n](r.call(this,C,D[n]()))});return"scrollTo"in
q&&q.document?q.document.compatMode==="CSS1Compat"&&q.document.documentElement["client"+l]||q.document.body["client"+l]:q.nodeType===9?Math.max(q.documentElement["client"+l],q.body["scroll"+l],q.documentElement["scroll"+l],q.body["offset"+l],q.documentElement["offset"+l]):r===undefined?f.css(q,n):this.css(n,typeof r==="string"?r:r+"px")}});t.$=t.jQuery=f});
bespin.tiki.register("::embedded",{name:"embedded",dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"}});bespin.tiki.module("embedded:index",function(){});bespin.tiki.register("::appconfig",{name:"appconfig",dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("appconfig:index",function(y,t){var v=y("jquery").$;y("underscore");var s=y("settings").settings,g=y("bespin:promise").group,e=y("bespin:promise").Promise,b=y("bespin:console").console,d=y("bespin:util/stacktrace").Trace,k=y("bespin:util/util"),h=true;t.launch=function(m){var o=new e;v("#_bespin_loading").remove();var x;if(h){x=bespin.tiki.require;h=false}else x=(new (bespin.tiki.require("bespin:sandbox").Sandbox)).createRequire({id:"index",ownerPackage:bespin.tiki.loader.anonymousPackage});
var u=x("bespin:plugins").catalog;m=m||{};t.normalizeConfig(u,m);var f=m.objects;for(var A in f)u.registerObject(A,f[A]);for(var F in m.settings)s.set(F,m.settings[F]);var p=function(){var E=x("environment").env,G=E.editor;if(G){m.lineNumber&&G.setLineNumber(m.lineNumber);if(m.stealFocus)G.focus=true;if(m.readOnly)G.readOnly=m.readOnly;if(m.syntax)G.syntax=m.syntax}if(G=u.getObject("commandLine"))E.commandLine=G;u.publish(this,"appLaunched");o.resolve(E)}.bind(this),z=new e;z.then(function(){f.loginController?
u.createObject("loginController").then(function(E){E.showLogin().then(function(G){m.objects.session.arguments.push(G);t.launchEditor(u,m).then(p,o.reject.bind(o))})}):t.launchEditor(u,m).then(p,o.reject.bind(o))},function(E){o.reject(E)});u.plugins.theme_manager?bespin.tiki.require.ensurePackage("::theme_manager",function(){var E=x("theme_manager");m.theme.basePlugin&&E.setBasePlugin(m.theme.basePlugin);m.theme.standard&&E.setStandardTheme(m.theme.standard);E.startParsing().then(function(){z.resolve()},
function(G){z.reject(G)})}):z.resolve();return o};t.normalizeConfig=function(m,o){if(o.objects===undefined)o.objects={};if(o.autoload===undefined)o.autoload=[];if(o.theme===undefined)o.theme={};if(!o.theme.basePlugin&&m.plugins.screen_theme)o.theme.basePlugin="screen_theme";if(!o.initialContent)o.initialContent="";if(!o.settings)o.settings={};if(!o.objects.notifier&&m.plugins.notifier)o.objects.notifier={};if(!o.objects.loginController&&m.plugins.userident)o.objects.loginController={};if(!o.objects.fileHistory&&
m.plugins.file_history)o.objects.fileHistory={factory:"file_history",arguments:["session"],objects:{"0":"session"}};if(!o.objects.server&&m.plugins.bespin_server){o.objects.server={factory:"bespin_server"};o.objects.filesource={factory:"bespin_filesource",arguments:["server"],objects:{"0":"server"}}}if(!o.objects.files&&m.plugins.filesystem&&o.objects.filesource)o.objects.files={arguments:["filesource"],objects:{"0":"filesource"}};if(!o.objects.editor)o.objects.editor={factory:"text_editor",arguments:[o.initialContent]};
if(!o.objects.session)o.objects.session={arguments:["editor"],objects:{"0":"editor"}};if(!o.objects.commandLine&&m.plugins.command_line)o.objects.commandLine={};if(!o.objects.toolbar&&m.plugins.toolbar)o.objects.toolbar={};if(o.gui===undefined)o.gui={};m={};for(var x in o.gui){var u=o.gui[x];if(u.component)m[u.component]=true}if(!o.gui.north&&o.objects.toolbar&&!m.toolbar)o.gui.north={component:"toolbar"};if(!o.gui.center&&o.objects.editor&&!m.editor)o.gui.center={component:"editor"};if(!o.gui.south&&
o.objects.commandLine&&!m.commandLine)o.gui.south={component:"commandLine"}};t.launchEditor=function(m,o){var x=new e;if(o===null){b.error("Cannot start editor without a configuration!");x.reject("Cannot start editor without a configuration!");return x}i(m,o).then(function(){j(m,o,x)},function(u){b.error("Error while creating objects");(new d(u)).log();x.reject(u)});return x};var i=function(m,o){var x=[];for(var u in o.objects)x.push(m.createObject(u));return g(x)},j=function(m,o,x){var u=document.createElement("div");
u.setAttribute("class","container");var f=document.createElement("div");f.setAttribute("class","center-container");var A=false,F=o.element||document.body;k.addClass(F,"bespin");F.appendChild(u);try{["north","west","center","east","south"].forEach(function(z){var E=o.gui[z];if(E){var G=m.getObject(E.component);if(!G)throw"Cannot find object "+E.component+" to attach to the Bespin UI";F=G.element;if(!F)throw"Component "+E.component+' does not have an "element" attribute to attach to the Bespin UI';
v(F).addClass(z);if(z=="west"||z=="east"||z=="center"){if(!A){u.appendChild(f);A=true}f.appendChild(F)}else u.appendChild(F)}});["north","west","east","south","center"].forEach(function(z){if(z=o.gui[z]){z=m.getObject(z.component);z.elementAppended!=null&&z.elementAppended()}});x.resolve()}catch(p){b.error(p);x.reject(p)}}});bespin.tiki.register("::events",{name:"events",dependencies:{traits:"0.0.0"}});
bespin.tiki.module("events:index",function(y,t){t.Event=function(){var v=[],s=function(){var g=arguments;v.forEach(function(e){e.func.apply(null,g)})};s.add=function(){arguments.length==1?v.push({ref:arguments[0],func:arguments[0]}):v.push({ref:arguments[0],func:arguments[1]})};s.remove=function(g){v=v.filter(function(e){return g!==e.ref})};s.removeAll=function(){v=[]};return s}});bespin.tiki.register("::uicommands",{name:"uicommands",dependencies:{}});
bespin.tiki.module("uicommands:index",function(y,t){var v=y("environment").env;y("bespin:plugins");t.jumpCommandLine=function(){v.commandLine.focus()};t.jumpEditor=function(){v.view.focus()}});bespin.tiki.register("::screen_theme",{name:"screen_theme",dependencies:{theme_manager:"0.0.0"}});bespin.tiki.module("screen_theme:index",function(){});
(function(){var y=bespin.tiki.require("jquery").$;y(document).ready(function(){bespin.tiki.require("bespin:plugins").catalog.registerMetadata({text_editor:{resourceURL:"resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"},testmodules:["tests/utils/testRect",
"tests/testScratchcanvas","tests/models/testTextstorage","tests/controllers/testLayoutmanager"],provides:[{action:"new",pointer:"views/editor#EditorView",ep:"factory",name:"text_editor"},{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",key:"ctrl_d",predicates:{isTextView:true},
pointer:"commands/editing#deleteLines",ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{description:"Join the current line with the following",key:"ctrl_shift_j",predicates:{isTextView:true},pointer:"commands/editing#joinLines",ep:"command",name:"joinline"},{params:[{defaultValue:"",type:"text",name:"text",description:"The text to insert"}],
pointer:"commands/editing#insertText",ep:"command",name:"insertText"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},pointer:"commands/editing#untab",ep:"command",key:"shift_tab",name:"untab"},{predicates:{isTextView:true},ep:"command",name:"move"},{description:"Repeat the last search (forward)",
pointer:"commands/editor#findNextCommand",ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},{predicates:{isTextView:true},pointer:"commands/movement#moveRight",
ep:"command",key:"right",name:"move right"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",
ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",
ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home","ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",
ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",
ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},
pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",
description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",
params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",
ep:"command",key:["ctrl_z"],name:"undo"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",
defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"},{defaultValue:{color:"#e5c138",paddingLeft:5,backgroundColor:"#4c4a41",paddingRight:10},ep:"themevariable",name:"gutter"},{defaultValue:{color:"#e6e6e6",selectedTextBackgroundColor:"#526da5",backgroundColor:"#2a211c",cursorColor:"#879aff",unfocusedCursorBackgroundColor:"#73171e",unfocusedCursorColor:"#ff0033"},ep:"themevariable",name:"editor"},{defaultValue:{comment:"#666666",directive:"#999999",keyword:"#42A8ED",
addition:"#FFFFFF",plain:"#e6e6e6",module:"#BA4946",specialmodule:"#C741BB",builtin:"#307BAD",deletion:"#FFFFFF",error:"#ff0000",operator:"#88BBFF",identifier:"#D841FF",string:"#039A0A"},ep:"themevariable",name:"highlighterFG"},{defaultValue:{addition:"#008000",deletion:"#800000"},ep:"themevariable",name:"highlighterBG"},{defaultValue:{nibStrokeStyle:"rgb(150, 150, 150)",fullAlpha:1,barFillStyle:"rgb(0, 0, 0)",particalAlpha:0.3,barFillGradientBottomStop:"rgb(44, 44, 44)",backgroundStyle:"#2A211C",
thickness:17,padding:5,trackStrokeStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",barFillGradientBottomStart:"rgb(22, 22, 22)",barFillGradientTopStop:"rgb(40, 40, 40)",barFillGradientTopStart:"rgb(90, 90, 90)",nibStyle:"rgb(100, 100, 100)",trackFillStyle:"rgba(50, 50, 50, 0.8)"},ep:"themevariable",name:"scroller"},{description:"Event: Notify when something within the editor changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever a change happened."}],
ep:"extensionpoint",name:"editorChange"},{description:"Decoration for the gutter",ep:"extensionpoint",name:"gutterDecoration"},{description:"Line number decoration for the gutter",pointer:"views/gutter#lineNumbers",ep:"gutterDecoration",name:"lineNumbers"}],type:"plugins/supported",name:"text_editor"},less:{resourceURL:"resources/less/",description:"Leaner CSS",contributors:[],author:"Alexis Sellier <self@cloudhead.net>",url:"http://lesscss.org",version:"1.0.11",dependencies:{},testmodules:[],provides:[],
keywords:["css","parser","lesscss","browser"],type:"plugins/thirdparty",name:"less"},theme_manager_base:{resourceURL:"resources/theme_manager_base/",name:"theme_manager_base",share:true,environments:{main:true},dependencies:{},testmodules:[],provides:[{description:"(Less)files holding the CSS style information for the UI.",params:[{required:true,name:"url",description:"Name of the ThemeStylesFile - can also be an array of files."}],ep:"extensionpoint",name:"themestyles"},{description:"Event: Notify when the theme(styles) changed.",
params:[{required:true,name:"pointer",description:"Function that is called whenever the theme is changed."}],ep:"extensionpoint",name:"themeChange"},{indexOn:"name",description:"A theme is a way change the look of the application.",params:[{required:false,name:"url",description:"Name of a ThemeStylesFile that holds theme specific CSS rules - can also be an array of files."},{required:true,name:"pointer",description:"Function that returns the ThemeData"}],ep:"extensionpoint",name:"theme"}],type:"plugins/supported",
description:"Defines extension points required for theming"},canon:{resourceURL:"resources/canon/",name:"canon",environments:{main:true,worker:false},dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",ep:"extensionpoint",name:"command"},{description:"An extension point to be called whenever a new command begins output.",
ep:"extensionpoint",name:"addedRequestOutput"},{description:"A dimensionsChanged is a way to be notified of changes to the dimension of Bespin",ep:"extensionpoint",name:"dimensionsChanged"},{description:"How many typed commands do we recall for reference?",defaultValue:50,type:"number",ep:"setting",name:"historyLength"},{action:"create",pointer:"history#InMemoryHistory",ep:"factory",name:"history"}],type:"plugins/supported",description:"Manages commands"},traits:{resourceURL:"resources/traits/",description:"Traits library, traitsjs.org",
dependencies:{},testmodules:[],provides:[],type:"plugins/thirdparty",name:"traits"},keyboard:{resourceURL:"resources/keyboard/",description:"Keyboard shortcuts",dependencies:{canon:"0.0",settings:"0.0"},testmodules:["tests/testKeyboard"],provides:[{description:"A keymapping defines how keystrokes are interpreted.",params:[{required:true,name:"states",description:"Holds the states and all the informations about the keymapping. See docs: pluginguide/keymapping"}],ep:"extensionpoint",name:"keymapping"}],
type:"plugins/supported",name:"keyboard"},worker_manager:{resourceURL:"resources/worker_manager/",description:"Manages a web worker on the browser side",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{description:"Low-level web worker control (for plugin development)",ep:"command",name:"worker"},{description:"Restarts all web workers (for plugin development)",pointer:"#workerRestartCommand",ep:"command",name:"worker restart"}],type:"plugins/supported",name:"worker_manager"},
diff:{testmodules:[],type:"plugins/thirdparty",resourceURL:"resources/diff/",description:"Diff/Match/Patch module (support code, no UI)",name:"diff"},edit_session:{resourceURL:"resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{events:"0.0.0"},testmodules:["tests/testSession"],provides:[{action:"call",pointer:"#createSession",ep:"factory",name:"session"}],type:"plugins/supported",name:"edit_session"},syntax_manager:{resourceURL:"resources/syntax_manager/",
name:"syntax_manager",environments:{main:true,worker:false},dependencies:{worker_manager:"0.0.0",syntax_directory:"0.0.0",events:"0.0.0",underscore:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[],type:"plugins/supported",description:"Provides syntax highlighting services for the editor"},completion:{resourceURL:"resources/completion/",description:"Code completion support",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{indexOn:"name",
description:"Code completion support for specific languages",ep:"extensionpoint",name:"completion"},{description:"Accept the chosen completion",key:["return","tab"],predicates:{completing:true},pointer:"controller#completeCommand",ep:"command",name:"complete"},{description:"Abandon the completion",key:"escape",predicates:{completing:true},pointer:"controller#completeCancelCommand",ep:"command",name:"complete cancel"},{description:"Choose the completion below",key:"down",predicates:{completing:true},
pointer:"controller#completeDownCommand",ep:"command",name:"complete down"},{description:"Choose the completion above",key:"up",predicates:{completing:true},pointer:"controller#completeUpCommand",ep:"command",name:"complete up"}],type:"plugins/supported",name:"completion"},environment:{testmodules:[],dependencies:{settings:"0.0.0"},resourceURL:"resources/environment/",name:"environment",type:"plugins/supported"},undomanager:{resourceURL:"resources/undomanager/",description:"Manages undoable events",
testmodules:["tests/testUndomanager"],provides:[{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins/supported",name:"undomanager"},command_line:{resourceURL:"resources/command_line/",description:"Provides the command line user interface",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"},
testmodules:["tests/testInput"],provides:[{url:["article.less","cli.less","menu.less","requestOutput.less","global.less"],ep:"themestyles"},{defaultValue:"@global_container_background",ep:"themevariable",name:"bg"},{defaultValue:"@global_container_background + #090807",ep:"themevariable",name:"input_bg_light"},{defaultValue:"@global_container_background - #030303",ep:"themevariable",name:"input_bg"},{defaultValue:"@global_container_background - #050506",ep:"themevariable",name:"input_bg2"},{defaultValue:"@global_menu_inset_color_top_left",
ep:"themevariable",name:"border_fg"},{defaultValue:"@global_menu_inset_color_right",ep:"themevariable",name:"border_fg2"},{defaultValue:"@global_menu_background",ep:"themevariable",name:"menu_bg"},{defaultValue:"@global_menu_border_color",ep:"themevariable",name:"border_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"text"},{defaultValue:"@global_header_color",ep:"themevariable",name:"hi_text"},{defaultValue:"@global_hint_color",ep:"themevariable",name:"lo_text"},{defaultValue:"@global_hint_color",
ep:"themevariable",name:"lo_text2"},{defaultValue:"@global_link_color",ep:"themevariable",name:"link_text"},{defaultValue:"@global_error_color",ep:"themevariable",name:"error_text"},{defaultValue:"@global_selectable_hover_background",ep:"themevariable",name:"theme_text"},{comment:"#FFCE00",defaultValue:"rgb(255,206,0)",ep:"themevariable",name:"theme_text_light"},{defaultValue:"@global_selectable_hover_background - #222000",ep:"themevariable",name:"theme_text_dark"},{defaultValue:"@global_accelerator_color",
ep:"themevariable",name:"theme_text_dark2"},{comment:"#0E0906",defaultValue:"rgb(14,9,6)",ep:"themevariable",name:"input_submenu"},{defaultValue:"@global_font",ep:"themevariable",name:"fonts"},{defaultValue:"@global_selectable_hover_color",ep:"themevariable",name:"li_hover_color"},{defaultValue:"@global_hint_hover_color",ep:"themevariable",name:"li_hint_hover_color"},{defaultValue:"@global_accelerator_hover_color",ep:"themevariable",name:"li_accelerator_hover_color"},{action:"new",pointer:"views/cli#CliInputView",
ep:"factory",name:"commandLine"},{description:"Display number|date|none next to each historical instruction",defaultValue:"none",type:{data:["number","date","none"],name:"selection"},ep:"setting",name:"historyTimeMode"},{description:"The maximum size (in pixels) for the command line output area",defaultValue:0,type:"number",ep:"setting",name:"minConsoleHeight"},{description:"The minimum size (in pixels) for the command line output area",defaultValue:300,type:"number",ep:"setting",name:"maxConsoleHeight"},
{predicates:{isKeyUp:false,isCommandLine:true},pointer:"commands/simple#completeCommand",ep:"command",key:"tab",name:"complete"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_2",name:"menu2"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},
{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_3",name:"menu3"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_4",name:"menu4"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_5",name:"menu5"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_6",name:"menu6"},{predicates:{isKeyUp:true,
isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_7",name:"menu7"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_8",name:"menu8"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_9",name:"menu9"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_0",name:"menu0"},{pointer:"commands/simple#helpCommand",
description:"Get help on the available commands.",params:[{defaultValue:null,type:"text",name:"search",description:"Search string to narrow the output."}],ep:"command",name:"help"},{pointer:"commands/simple#aliasCommand",description:"define and show aliases for commands",params:[{defaultValue:null,type:"text",name:"alias",description:"optionally, your alias name"},{defaultValue:null,type:"text",name:"command",description:"optionally, the command name"}],ep:"command",name:"alias"},{description:"evals given js code and show the result",
params:[{type:"text",name:"javascript",description:"The JavaScript to evaluate"}],hidden:true,pointer:"commands/basic#evalCommand",ep:"command",name:"eval"},{description:"show the Bespin version",hidden:true,pointer:"commands/basic#versionCommand",ep:"command",name:"version"},{description:"has",hidden:true,pointer:"commands/basic#bespinCommand",ep:"command",name:"bespin"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyPreviousCommand",ep:"command",key:"up",name:"historyPrevious"},
{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyNextCommand",ep:"command",key:"down",name:"historyNext"},{params:[],description:"Show history of the commands",pointer:"commands/history#historyCommand",ep:"command",name:"history"},{pointer:"commands/history#addedRequestOutput",ep:"addedRequestOutput"},{indexOn:"name",description:"A function to allow the command line to show a hint to the user on how they should finish what they're typing",ep:"extensionpoint",name:"typehint"},
{description:"A UI for string that is constrained to be one of a number of pre-defined values",pointer:"views/basic#selection",ep:"typehint",name:"selection"},{description:"A UI for a boolean",pointer:"views/basic#bool",ep:"typehint",name:"boolean"}],type:"plugins/supported",name:"command_line"},editing_commands:{resourceURL:"resources/editing_commands/",description:"Provides higher level commands for working with the text.",objects:["commandLine"],testmodules:[],provides:[{description:"Search for text within this buffer",
params:[{type:"text",name:"value",description:"string to search for"}],key:"ctrl_f",pointer:"#findCommand",ep:"command",name:"find"},{description:"move it! make the editor head to a line number.",params:[{type:"text",name:"line",description:"add the line number to move to in the file"}],key:"ctrl_l",pointer:"#gotoCommand",ep:"command",name:"goto"}],type:"plugins/supported",name:"editing_commands"},rangeutils:{testmodules:["tests/test"],type:"plugins/supported",resourceURL:"resources/rangeutils/",
description:"Utility functions for dealing with ranges of text",name:"rangeutils"},stylesheet:{resourceURL:"resources/stylesheet/",name:"stylesheet",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#CSSSyntax",ep:"syntax",fileexts:["css","less"],name:"css"}],type:"plugins/supported",description:"CSS syntax highlighter"},html:{resourceURL:"resources/html/",name:"html",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],
provides:[{pointer:"#HTMLSyntax",ep:"syntax",fileexts:["htm","html"],name:"html"}],type:"plugins/supported",description:"HTML syntax highlighter"},js_syntax:{resourceURL:"resources/js_syntax/",name:"js_syntax",environments:{worker:true},dependencies:{standard_syntax:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{settings:["specialmodules"],pointer:"#JSSyntax",ep:"syntax",fileexts:["js","json"],name:"js"},{description:"Regex that matches special modules",defaultValue:"^jetpack\\.[^\"']+",type:"text",
ep:"setting",name:"specialmodules"}],type:"plugins/supported",description:"JavaScript syntax highlighter"},ctags:{resourceURL:"resources/ctags/",description:"Reads and writes tag files",dependencies:{traits:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"ctags"},events:{resourceURL:"resources/events/",description:"Dead simple event implementation",dependencies:{traits:"0.0"},testmodules:["tests/test"],provides:[],type:"plugins/supported",name:"events"},templater:{testmodules:[],
resourceURL:"resources/templater/",name:"templater",type:"plugins/supported"},matcher:{resourceURL:"resources/matcher/",description:"Provides various routines to match items in a list",dependencies:{},testmodules:["tests/testQuick","tests/testIndex","tests/testPrefix"],type:"plugins/supported",name:"matcher"},c_cpp_syntax:{resourceURL:"resources/c_cpp_syntax/",name:"c_cpp_syntax",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#C_CPPSyntax",ep:"syntax",
fileexts:["c","cpp"],name:"c_cpp"}],type:"plugins/thirdparty",description:"C/C++ syntax highlighter"},theme_manager:{resourceURL:"resources/theme_manager/",name:"theme_manager",share:true,environments:{main:true,worker:false},dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"},testmodules:[],provides:[{unregister:"themestyles#unregisterThemeStyles",register:"themestyles#registerThemeStyles",ep:"extensionhandler",name:"themestyles"},{unregister:"index#unregisterTheme",
register:"index#registerTheme",ep:"extensionhandler",name:"theme"},{defaultValue:"standard",description:"The theme plugin's name to use. If set to 'standard' no theme will be used",type:"text",ep:"setting",name:"theme"},{pointer:"#appLaunched",ep:"appLaunched"}],type:"plugins/supported",description:"Handles colors in Bespin"},standard_syntax:{resourceURL:"resources/standard_syntax/",description:"Easy-to-use basis for syntax engines",environments:{worker:true},dependencies:{syntax_worker:"0.0.0",syntax_directory:"0.0.0",
underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"standard_syntax"},jquery:{testmodules:[],resourceURL:"resources/jquery/",name:"jquery",type:"plugins/thirdparty"},embedded:{testmodules:[],dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"},resourceURL:"resources/embedded/",name:"embedded",type:"plugins/supported"},appconfig:{resourceURL:"resources/appconfig/",description:"Instantiates components and displays the GUI based on configuration.",
dependencies:{jquery:"0.0.0",canon:"0.0.0",underscore:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{description:"Event: Fired when the app is completely launched.",ep:"extensionpoint",name:"appLaunched"}],type:"plugins/supported",name:"appconfig"},syntax_worker:{resourceURL:"resources/syntax_worker/",description:"Coordinates multiple syntax engines",environments:{worker:true},dependencies:{syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"syntax_worker"},
uicommands:{resourceURL:"resources/uicommands/",description:"Commands for working with the Bespin user interface beyond the editor",testmodules:[],provides:[{predicates:{isTextView:true},pointer:"#jumpCommandLine",ep:"command",key:"ctrl_j",name:"jump-commandline"},{predicates:{isKeyUp:false,isCommandLine:true},pointer:"#jumpEditor",ep:"command",key:"ctrl_j",name:"jump-editor"}],type:"plugins/supported",name:"uicommands"},screen_theme:{resourceURL:"resources/screen_theme/",description:"Bespins standard theme basePlugin",
dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],ep:"themestyles"},{defaultValue:"@global_font",ep:"themevariable",name:"container_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"container_font_size"},{defaultValue:"@global_container_background",ep:"themevariable",name:"container_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"container_color"},{defaultValue:"@global_line_height",ep:"themevariable",name:"container_line_height"},{defaultValue:"@global_pane_background",
ep:"themevariable",name:"pane_bg"},{defaultValue:"@global_pane_border_radius",ep:"themevariable",name:"pane_border_radius"},{defaultValue:"@global_form_font",ep:"themevariable",name:"form_font"},{defaultValue:"@global_form_font_size",ep:"themevariable",name:"form_font_size"},{defaultValue:"@global_form_line_height",ep:"themevariable",name:"form_line_height"},{defaultValue:"@global_form_color",ep:"themevariable",name:"form_color"},{defaultValue:"@global_form_text_shadow",ep:"themevariable",name:"form_text_shadow"},
{defaultValue:"@global_pane_link_color",ep:"themevariable",name:"pane_a_color"},{defaultValue:"@global_font",ep:"themevariable",name:"pane_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"pane_font_size"},{defaultValue:"@global_pane_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_pane_h1_font",ep:"themevariable",name:"pane_h1_font"},{defaultValue:"@global_pane_h1_font_size",ep:"themevariable",name:"pane_h1_font_size"},{defaultValue:"@global_pane_h1_color",
ep:"themevariable",name:"pane_h1_color"},{defaultValue:"@global_font_size * 1.8",ep:"themevariable",name:"pane_line_height"},{defaultValue:"@global_pane_color",ep:"themevariable",name:"pane_color"},{defaultValue:"@global_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_font",ep:"themevariable",name:"button_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"button_font_size"},{defaultValue:"@global_button_color",ep:"themevariable",name:"button_color"},
{defaultValue:"@global_button_background",ep:"themevariable",name:"button_bg"},{defaultValue:"@button_bg - #063A27",ep:"themevariable",name:"button_bg2"},{defaultValue:"@button_bg - #194A5E",ep:"themevariable",name:"button_border"},{defaultValue:"@global_control_background",ep:"themevariable",name:"control_bg"},{defaultValue:"@global_control_color",ep:"themevariable",name:"control_color"},{defaultValue:"@global_control_border",ep:"themevariable",name:"control_border"},{defaultValue:"@global_control_border_radius",
ep:"themevariable",name:"control_border_radius"},{defaultValue:"@global_control_active_background",ep:"themevariable",name:"control_active_bg"},{defaultValue:"@global_control_active_border",ep:"themevariable",name:"control_active_border"},{defaultValue:"@global_control_active_color",ep:"themevariable",name:"control_active_color"},{defaultValue:"@global_control_active_inset_color",ep:"themevariable",name:"control_active_inset_color"}],type:"plugins/supported",name:"screen_theme"}})})})();
(function(){var y=bespin.tiki.require("bespin:promise").Promise,t=bespin.tiki.require("bespin:promise").group,v=bespin.tiki.require("jquery").$;bespin.loaded=new y;bespin.initialized=new y;var s=function(g,e,b){g=g.style[b]||document.defaultView.getComputedStyle(g,"").getPropertyValue(b);if(!g||g=="auto"||g=="intrinsic")g=e.style[b];return g};bespin.useBespin=function(g,e){var b=bespin.tiki.require("bespin:util/util"),d={},k=d.settings;e=e||{};for(var h in e)d[h]=e[h];e=d.settings;if(k!==undefined)for(h in k)if(e[h]===
undefined)d.settings[h]=k[h];var i=null,j=new y;bespin.tiki.require.ensurePackage("::appconfig",function(){var m=bespin.tiki.require("appconfig");if(b.isString(g))g=document.getElementById(g);if(b.none(d.initialContent))d.initialContent=g.value||g.innerHTML;g.innerHTML="";if(g.type=="textarea"){var o=g.parentNode,x=document.createElement("div"),u=function(){var A="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(z){A+=z+":"+s(g,x,z)+";"});var F=s(g,
x,"width"),p=s(g,x,"height");A+="height:"+p+";width:"+F+";";A+="display:inline-block;";x.setAttribute("style",A)};window.addEventListener("resize",u,false);u();for(g.nextSibling?o.insertBefore(x,g.nextSibling):o.appendChild(x);o!==document;){if(o.tagName.toUpperCase()==="FORM"){var f=o.onsubmit;o.onsubmit=function(A){g.value=i.editor.value;g.innerHTML=i.editor.value;f&&f.call(this,A)};break}o=o.parentNode}g.style.display="none";d.element=x;if(!b.none(g.getAttribute("readonly")))d.readOnly=true}else d.element=
g;m.launch(d).then(function(A){i=A;j.resolve(A)})});return j};v(document).ready(function(){bespin.loaded.resolve();for(var g=[],e=document.querySelectorAll(".bespin"),b=0;b<e.length;b++){var d=e[b],k=d.getAttribute("data-bespinoptions")||"{}";k=bespin.useBespin(d,JSON.parse(k));k.then(function(h){d.bespin=h},function(h){throw new Error("Launch failed: "+h);});g.push(k)}t(g).then(function(){bespin.initialized.resolve();window.onBespinLoad&&window.onBespinLoad()},function(h){bespin.initialized.reject("At least one Bespin failed to launch!"+
h)})})})();
